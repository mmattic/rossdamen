/* checkout-ui - v5.16.7 */(function(){var Router,ShippingDataWrapper,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Router=function(){function Router(){this.isStepBefore=__bind(this.isStepBefore,this),this.validateAllSteps=__bind(this.validateAllSteps,this),this.parseHash=__bind(this.parseHash,this),this.setHash=__bind(this.setHash,this),this.stateChangeHandler=__bind(this.stateChangeHandler,this),this.orderformRoute=__bind(this.orderformRoute,this),this.paymentRoute=__bind(this.paymentRoute,this),this.shippingRoute=__bind(this.shippingRoute,this),this.profileRoute=__bind(this.profileRoute,this),this.emailRoute=__bind(this.emailRoute,this),this.cartRoute=__bind(this.cartRoute,this),this.defaultRoute=__bind(this.defaultRoute,this),this.initializeRouter=__bind(this.initializeRouter,this);var _this=this;this.state=ko.observable(),this.inCart=ko.computed(function(){return"cart"===_this.state()}),this.inOrderForm=ko.computed(function(){return"orderform"===_this.state()}),this.state.subscribe(this.stateChangeHandler),this.sac={isActive:ko.observable(!1),reason:null,state:null,hasLoaded:!1,parsedRoute:!1},this.sac.isActive.subscribe(function(isActive){return $(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/SACModeChange.vtex",[isActive])}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/orderFormUpdated.vtex",function(event,orderForm){var _ref;return _this.sac.isActive(null!=(null!=orderForm&&null!=(_ref=orderForm.commercialConditionData)?_ref.parentOrderId:void 0))}),this.parsingHash=!1,this.steps=["profile","shipping","payment"],this.shippingData=new ShippingDataWrapper("#shipping-data"),this.hashForStep=function(hash){switch(hash){case"profile":return window.clientProfileData;case"shipping":return _this.shippingData;case"payment":return window.paymentData;default:return void 0}},this.view={clientProfileDataVisited:ko.observable(),shippingDataVisited:ko.observable(),paymentDataVisited:ko.observable()},this.validationResults={payment:!0},crossroads.addRoute("",this.defaultRoute),crossroads.addRoute("cart",this.cartRoute),crossroads.addRoute("email",this.emailRoute),crossroads.addRoute("profile",this.profileRoute),crossroads.addRoute("shipping",this.shippingRoute),crossroads.addRoute("payment",this.paymentRoute),crossroads.addRoute("orderform",this.orderformRoute),$("#client-profile-data").on("https://io.vtex.com.br/checkout-ui/5.16.7/script/componentValidated.vtex",function(e,results){return _this.validationResults.profile=_.all(results,function(val){return val.result===!0})}),$("#shipping-data").on("https://io.vtex.com.br/checkout-ui/5.16.7/script/componentValidated.vtex",function(e,results){return _this.validationResults.shipping=results===!0||0===results.length}),$("#payment-data").on("https://io.vtex.com.br/checkout-ui/5.16.7/script/componentValidated.vtex",function(e,results){return _this.validationResults.payment=_.all(results,function(val){return val.result===!0})}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/componentDone.vtex",function(){return _this.parsingHash?void 0:_this.validateAllSteps()})}return Router.prototype.initializeRouter=function(){var step,stepId,_i,_len,_ref;for(_ref=this.steps,_i=0,_len=_ref.length;_len>_i;_i++)stepId=_ref[_i],step=this.hashForStep(stepId),this.validationResults[stepId]&&step.visited(!0);return hasher.initialized.add(this.parseHash),hasher.changed.add(this.parseHash),hasher.init()},Router.prototype.defaultRoute=function(){return hasher.setHash("cart")},Router.prototype.cartRoute=function(){return radio("paymentData.isVisible").broadcast(!1),this.state("cart")},Router.prototype.emailRoute=function(){return radio("paymentData.isVisible").broadcast(!1),0===cart.filteredItems().length?hasher.replaceHash("cart"):checkout.canEditData()?this.hashForStep("profile").showEmailForm()?(this.state("orderform"),this.hashForStep("profile").enable()):hasher.replaceHash("profile"):hasher.replaceHash("orderform")},Router.prototype.profileRoute=function(){return radio("paymentData.isVisible").broadcast(!1),0===cart.filteredItems().length?hasher.replaceHash("cart"):checkout.canEditData()?(this.state("orderform"),this.hashForStep("profile").enable()):hasher.replaceHash("orderform")},Router.prototype.shippingRoute=function(){return radio("paymentData.isVisible").broadcast(!1),0===cart.filteredItems().length?hasher.replaceHash("cart"):(this.state("orderform"),this.hashForStep("shipping").enable(),this.view.shippingDataVisited(!0))},Router.prototype.paymentRoute=function(){var unavailableItems;return unavailableItems=cart.unavailableItems(),unavailableItems.length>0?(vtex.checkout.MessageUtils.showUnavailableMessage(),cart.unavailableItemsCannotBeDelivered()?hasher.setHash("shipping"):hasher.setHash("cart")):0===cart.availableItems().length?hasher.setHash("cart"):(radio("paymentData.isVisible").broadcast(!0),this.state("orderform"),this.hashForStep("payment").enable())},Router.prototype.orderformRoute=function(){return cart.filteredItems().length>0?this.validateAllSteps(!0):hasher.replaceHash("cart")},Router.prototype.stateChangeHandler=function(state){return $(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/stateUpdated.vtex",[state]),"orderform"===state?$(document).off("https://io.vtex.com.br/checkout-ui/5.16.7/script/focusin.cart",".orderform-template :visible"):"cart"===state?($(".cart-template.full-cart").focus(),$(document).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/focusin.cart",".orderform-template :visible",function(e){return $(e.target).blur(),$(".cart-template.full-cart a.btn-success:last-child:visible").focus(),!1}),radio("checkout.shippingData.clearUnselectedLogisticsInfo").broadcast(!0)):void 0},Router.prototype.setHash=function(hash){return hasher.setHash(hash)},Router.prototype.parseHash=function(newHash,oldHash){var newHashFiltered,oldHashFiltered,oldStep,_ref;if(null!=oldHash&&oldHash!==newHash&&$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/removeAllMessages.vtex"),this.parsingHash=!0,null!=(_ref=window.vtex.checkout.analytics)&&_ref.sendEvent(newHash,{type:"step",hash:newHash}),oldHash&&oldHash===newHash||window.logSplunk&&window.logSplunk({level:"Info",type:"Debug",workflowType:"checkout-ui",workflowInstance:"step",event:{hash:newHash},account:vtex.accountName}),this.sac.isActive()&&this.sac.hasLoaded&&!this.sac.parsedRoute)return this.sac.parsedRoute=!0,this.parsingHash=!1;if(this.sac.isActive()&&!this.sac.hasLoaded)return this.sac.hasLoaded=!0,hasher.setHash(this.sac.state),crossroads.parse(this.sac.state),this.parsingHash=!1;if(oldHashFiltered=null!=oldHash?oldHash.replace(/\/|\?/g,"").toLowerCase().replace("email","profile"):void 0,newHashFiltered=null!=newHash?newHash.replace(/\/|\?/g,"").toLowerCase():void 0,oldStep=this.hashForStep(oldHashFiltered)){if(!this.validationResults[oldHashFiltered]&&!this.isStepBefore(newHashFiltered,oldHashFiltered))return hasher.setHash(oldHashFiltered),this.parsingHash=!1;oldStep.disable()}else if(""!==newHashFiltered&&"cart"!==newHashFiltered)return crossroads.parse(this.validateAllSteps()),this.parsingHash=!1;return crossroads.parse(newHashFiltered),this.parsingHash=!1},Router.prototype.validateAllSteps=function(replaceHash){var step,stepId,stepIsValid,_i,_len,_ref;for(null==replaceHash&&(replaceHash=!1),_ref=this.steps,_i=0,_len=_ref.length;_len>_i&&(stepId=_ref[_i],step=this.hashForStep(stepId),stepIsValid=this.validationResults[stepId],stepIsValid);_i++)step.visited(!0),step.active()&&"payment"!==stepId&&step.disable();return"profile"===stepId&&step.showEmailForm()&&(stepId="email"),replaceHash?hasher.replaceHash(stepId):hasher.setHash(stepId),stepId},Router.prototype.isStepBefore=function(a,b){return _(this.steps).indexOf(a)<_(this.steps).indexOf(b)},Router}(),ShippingDataWrapper=function(){function ShippingDataWrapper(selector){this.disable=__bind(this.disable,this),this.enable=__bind(this.enable,this),this.active=__bind(this.active,this),this.visited=__bind(this.visited,this),this.el=$(selector)}return ShippingDataWrapper.prototype.visited=function(){},ShippingDataWrapper.prototype.active=function(){return this.el.find(".step").hasClass("active")},ShippingDataWrapper.prototype.enable=function(){return this.el.trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/enable.vtex")},ShippingDataWrapper.prototype.disable=function(){return this.el.trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/disable.vtex")},ShippingDataWrapper}(),vtex.checkout.Router=Router}).call(this),function(){var CheckoutModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};CheckoutModel=function(){function CheckoutModel(){this.login=__bind(this.login,this),this.removeGiftRegistry=__bind(this.removeGiftRegistry,this),this.noteSubmitHandler=__bind(this.noteSubmitHandler,this),this.paymentSubmitHandler=__bind(this.paymentSubmitHandler,this),this.logTransaction=__bind(this.logTransaction,this),this.giftCardSubmitHandler=__bind(this.giftCardSubmitHandler,this),this.billingAddressSubmitHandler=__bind(this.billingAddressSubmitHandler,this),this.shippingDataSubmitHandler=__bind(this.shippingDataSubmitHandler,this),this.addressSubmitHandler=__bind(this.addressSubmitHandler,this),this.parseOrderFormResponse=__bind(this.parseOrderFormResponse,this),this.toJSON=__bind(this.toJSON,this),this.parseLogisticsInfo=__bind(this.parseLogisticsInfo,this),this.parseShippingData=__bind(this.parseShippingData,this),this.update=__bind(this.update,this),this.goToFirstInvalidStep=__bind(this.goToFirstInvalidStep,this),this.killCookiePCI=__bind(this.killCookiePCI,this),this.cookiePCIExists=__bind(this.cookiePCIExists,this);var _ref,_this=this;this.isTotem=ko.observable(null!=(_ref=vtex.totem)?_ref:!1),this.cookiePCI=_.readCookie("CheckoutNewInstallments"),this.locale=ko.observable(""),this.localeSetByAPI=!1,this.originalLocale=ko.observable($("html").attr("lang")),this.setup=!0,this.countryCode=ko.observable("BRA"),this.userProfileId=void 0,this.hasShippingPreview=ko.observable(!0),this.renderLoaded=ko.observable(!1),this.saveData=ko.observable(!0),this.optinNewsLetter=ko.observable(!0),this.savedOptinNewsLetter=ko.observable(null),this.unsetNewsletterIfNotSaved=ko.computed(function(){return _this.saveData()===!1?_this.optinNewsLetter(!1):void 0}),this.canEditData=ko.observable(!0),this.userType=ko.observable(null),this.loggedIn=ko.observable(!1),this.salesChannel=ko.observable(1),this.isUsingGiftRegistry=ko.observable(!1),this.giftRegistryId=ko.observable(null),this.giftRegistryDescription=ko.observable(null),this.giftRegistryAddressId=ko.observable(null),this.isUsingGiftRegistryAddress=ko.observable(!1),this.isNoteSaved=!1,this.isSavingNote=null,this.isUsingNote=ko.observable(!1),this.setUsingNote=function(){return _this.isUsingNote(!0),$("#cart-note").focus()},this.note=ko.observable(null),this.oldNote=ko.observable(),this.newNote=ko.computed(function(){return _this.oldNote()!==_this.note()&&(_this.isNoteSaved=!1),_this.note()?_this.isUsingNote(!0):_this.isUsingNote(!1),vtex.i18n.translateHtml(".summary-note")}),this.noteAutoSave=ko.computed(function(){var note;return note=_this.note(),_this.isNoteSaved||_this.isSavingNote!==!1?void 0:_this.noteSubmitHandler(note)}).extend({throttle:700}),this.postalCodeMask=ko.observable(),this.phoneMask=ko.observable(),this.documentMask=ko.observable(),this.corporateDocumentMask=ko.observable(),this.postalCodeForgottenURL=ko.observable(this.getForgottenPostalCodeURL(this.countryCode())),this.defaultDocumentType=ko.observable(),this.adjustLocaleForCountryCode=function(newValue){var countryToKey;return window.vtex.i18n.setCountryCode(newValue),countryToKey=vtex.validation.countryToKey[newValue],_this.postalCodeForgottenURL(_this.getForgottenPostalCodeURL(newValue)),countryToKey?(_this.postalCodeMask(vtex.validation.masks[countryToKey.postalCode]),_this.phoneMask(vtex.validation.masks[countryToKey.phone]),_this.documentMask(vtex.validation.masks[countryToKey.documentKey]),_this.corporateDocumentMask(vtex.validation.masks[countryToKey.corporateDocument]),_this.defaultDocumentType(vtex.validation.countryToKey[newValue].document),vtex.ko.validation.regex.document=vtex.ko.validation.regex[countryToKey.documentKey],vtex.ko.validation.regex.phone=vtex.ko.validation.regex[countryToKey.phone],vtex.ko.validation.regex.postalCode=vtex.ko.validation.regex[countryToKey.postalCode]):void _this.defaultDocumentType("document")},this.countryCode.subscribe(this.adjustLocaleForCountryCode),this.currencyCode=ko.observable("BRL"),this.deliveryCountries=ko.observableArray(["BRA"]),this.campaignName=ko.observable(),this.campaignSource=ko.observable(),this.campaignMedium=ko.observable(),this.loading=ko.observable(!0),this.disableInputs=ko.observable(!1),this.backgroundLoading=ko.observable(!1),this.implementedCountries=["ARG","BOL","BRA","CAN","CHL","COL","CRI","ECU","ESP","FRA","ITA","MEX","PAN","PER","PRY","PRT","URY","USA","VEN"],this.countriesWithPostalCode=["ARG","BRA","CAN","ESP","FRA","ITA","MEX","PRT","URY","USA"],this.countriesWithNoPostalCode=["BOL","CHL","COL","CRI","ECU","GTM","PAN","PER","PRY","VEN"],this.countriesWithPostalCodeAccordingToCity=["CHL","COL","PRY"],this.isUsingPostalCode=ko.computed(function(){var _ref1,_ref2;return _ref1=_this.countryCode(),__indexOf.call(_this.countriesWithNoPostalCode,_ref1)<0&&(_ref2=_this.countryCode(),__indexOf.call(_this.countriesWithPostalCode,_ref2)>=0)}),this.isPostalCodeAccordingToCity=ko.computed(function(){var _ref1;return _ref1=_this.countryCode(),__indexOf.call(_this.countriesWithPostalCodeAccordingToCity,_ref1)>=0}),this.disablePaymentButton=ko.computed({read:function(){return window.cart.unavailableItems().length>0||_this.backgroundLoading()||window.paymentData.isEditingSensitiveField()},deferEvaluation:!0}),this.hasSelectableGifts=ko.observable(!1),this.alertPCICookieMessage=ko.computed(function(){return _this.locale(),i18n.t("cookiePCIMessage")}),this.alertPCICookieClick=ko.computed(function(){return _this.locale(),i18n.t("cookiePCIClick")}),this.alertPCICookieClickInfo=ko.computed(function(){return _this.locale(),i18n.t("cookiePCIClickInfo")}),radio("checkout.disableInputs").subscribe(this.disableInputs),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/renderLoaderReady.vtex",function(){return _this.renderLoaded(!0)}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/checkoutRequestBegin.vtex",function(e,options){return _this.backgroundLoading(!0)}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/orderFormUpdated.vtex",function(e,orderForm){return _this.backgroundLoading(!1),_this.parseOrderFormResponse(orderForm)}),radio("vtex.i18n.update").subscribe(function(data){return data!==_this.locale()?(vtex.ko.validation.options.locale=data,_this.locale(data),_this.localeSetByAPI?void(_this.localeSetByAPI=!1):($(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/localeSelected.vtex",[data]),API.sendLocale(data))):void 0}),radio("vtex.countryCode.update").subscribe(this.countryCode),radio("checkout.item.new.bundleItem").subscribe(this.newItemWithBundleItem),radio("checkout.shipping.create").subscribe(this.parseOrderFormResponse),radio("checkout.shippingData.shippingAddress.submit").subscribe(this.addressSubmitHandler),radio("checkout.paymentData.billingAddress.submit").subscribe(this.billingAddressSubmitHandler),radio("checkout.shippingData.submit").subscribe(this.shippingDataSubmitHandler),radio("checkout.paymentData.submit").subscribe(this.paymentSubmitHandler),radio("checkout.giftcard.submit").subscribe(this.giftCardSubmitHandler),radio("checkout.openTextField").subscribe(this.note)}var getCookie,getMacId,getSessionId,getVtexFingerPrint;return CheckoutModel.prototype.cookiePCIExists=function(){return"__cart_use_new_installments=True"===this.cookiePCI?!0:!1},CheckoutModel.prototype.killCookiePCI=function(){return document.cookie="CheckoutNewInstallments=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/;domain="+document.domain,location.reload()},CheckoutModel.prototype.goToFirstInvalidStep=function(){var _ref;return null!=(_ref=window.router)?_ref.validateAllSteps(!0):void 0},CheckoutModel.prototype.update=function(){return API.getOrderForm()},CheckoutModel.prototype.parseShippingData=function(shippingData){return shippingData.logisticsInfo?this.parseLogisticsInfo(shippingData.logisticsInfo):void 0},CheckoutModel.prototype.parseLogisticsInfo=function(jsonArray){var countryCode,deliveryCountries,li,_i,_j,_len,_len1,_ref;if(void 0!==jsonArray&&0!==jsonArray.length){for(deliveryCountries=[],_i=0,_len=jsonArray.length;_len>_i;_i++)if(li=jsonArray[_i],li.shipsTo)for(_ref=li.shipsTo,_j=0,_len1=_ref.length;_len1>_j;_j++)countryCode=_ref[_j],_(deliveryCountries).contains(countryCode)||deliveryCountries.push(countryCode);return deliveryCountries.length>0?_.isEqual(deliveryCountries,this.deliveryCountries())?void 0:this.deliveryCountries(deliveryCountries):this.deliveryCountries([this.countryCode()])}},CheckoutModel.prototype.toJSON=function(){var _ref;return JSON.stringify({items:ko.toJSON(window.cart.items()),gifts:ko.toJSON(window.cart.gifts()),clientProfileData:clientProfileData.toJSON(),shippingData:shippingData.toJSON(),paymentData:{payments:paymentData.getAllPayments(!0),giftCards:(null!=(_ref=paymentData.paymentGroups.giftCardPaymentGroup)?_ref.getGiftCardsJSON():void 0)||[]},coupon:ko.toJSON(summary.coupon),clientPreferencesData:{optinNewsLetter:this.optinNewsLetter(),locale:vtex.i18n.locale}})},CheckoutModel.prototype.parseOrderFormResponse=function(json){var currentCurrency,locale,reason,state,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;return this.userProfileId=json.userProfileId,this.canEditData(json.canEditData),this.loggedIn(json.loggedIn),json.salesChannel&&this.salesChannel(json.salesChannel),0===(null!=(_ref=json.items)?_ref.length:void 0)&&router.setHash("cart"),json.clientPreferencesData&&null!==json.clientPreferencesData.optinNewsLetter&&(this.savedOptinNewsLetter(json.clientPreferencesData.optinNewsLetter),this.optinNewsLetter(json.clientPreferencesData.optinNewsLetter)),(null!=(_ref1=json.shippingData)&&null!=(_ref2=_ref1.address)?_ref2.addressType:void 0)&&this.isUsingGiftRegistryAddress("giftRegistry"===json.shippingData.address.addressType),null!=(null!=(_ref3=json.clientPreferencesData)?_ref3.locale:void 0)&&this.originalLocale(json.clientPreferencesData.locale),json.clientPreferencesData&&json.clientPreferencesData.locale&&(json.items&&json.items.length>0||json.loggedIn===!0)?(this.localeSetByAPI=!0,locale=json.clientPreferencesData.locale.match("es-")?"es":json.clientPreferencesData.locale.match("en-")?"en":json.clientPreferencesData.locale.match("fr-")?"fr":json.clientPreferencesData.locale.match("ca-")?"ca":json.clientPreferencesData.locale.match("ro-")?"ro":json.clientPreferencesData.locale,this.locale()!==locale&&(vtex.i18n.setLocale(locale),null!=(null!=(_ref4=vtex.renderRuntime)?_ref4.emitter:void 0)&&vtex.renderRuntime.emitter.emit("localesChanged",json.clientPreferencesData.locale))):this.setup&&$("html").attr("lang")&&(this.localeSetByAPI=!0,vtex.i18n.setLocale($("html").attr("lang"))),json.storePreferencesData&&(json.storePreferencesData.countryCode&&(this.countryCode()!==json.storePreferencesData.countryCode?radio("vtex.countryCode.update").broadcast(json.storePreferencesData.countryCode):"BRA"===this.countryCode()&&this.setup&&this.adjustLocaleForCountryCode("BRA")),json.storePreferencesData.currencyCode&&this.currencyCode(json.storePreferencesData.currencyCode),json.storePreferencesData.currencySymbol?vtex.i18n.setCurrency(json.storePreferencesData.currencySymbol):(currentCurrency=function(){switch(this.countryCode()){case"BRA":return"R$";case"PRY":return"Gs";case"PER":return"S/.";case"URY":return"USD";case"VEN":return"Bs. F.";default:return"$"}}.call(this),vtex.i18n.setCurrency(currentCurrency)),json.storePreferencesData.currencyFormatInfo&&(vtex.i18n.setThousandsSeparator(json.storePreferencesData.currencyFormatInfo.currencyGroupSeparator),vtex.i18n.setDecimalSeparator(json.storePreferencesData.currencyFormatInfo.currencyDecimalSeparator),vtex.i18n.setDecimalDigits(json.storePreferencesData.currencyFormatInfo.currencyDecimalDigits),vtex.i18n.setStartsWithCurrency(json.storePreferencesData.currencyFormatInfo.startsWithCurrencySymbol)),!this.setup||null==json.storePreferencesData.saveUserData&&null==json.storePreferencesData.checkToSavePersonDataByDefault||this.saveData(!!json.storePreferencesData.saveUserData||!!json.storePreferencesData.checkToSavePersonDataByDefault),this.setup&&null!=(null!=(_ref5=json.commercialConditionData)?_ref5.parentOrderId:void 0)&&(reason=json.commercialConditionData.reason,"shipping"===reason||"address"===reason?state="shipping":"payment"===reason?state="payment":"profile"===reason?state="profile":"sku"===reason&&(state="cart"),router.sac.isActive(!0),router.sac.reason=reason,router.sac.state=state)),null!=json.items&&this.hasSelectableGifts((null!=(_ref6=json.selectableGifts)?_ref6.length:void 0)>0),null!=json.giftRegistryData?(this.isUsingGiftRegistry(!0),radio("checkout.giftRegistry").broadcast(!0),this.giftRegistryId(json.giftRegistryData.giftRegistryId),this.giftRegistryDescription(json.giftRegistryData.description),this.giftRegistryAddressId(json.giftRegistryData.addressId)):(this.isUsingGiftRegistry(!1),radio("checkout.giftRegistry").broadcast(!1),this.giftRegistryId(void 0),this.giftRegistryDescription(void 0),this.giftRegistryAddressId(void 0)),json.ratesAndBenefitsData&&radio("checkout.ratesAndBenefitsData.create").broadcast(json.ratesAndBenefitsData),void 0!==json.marketingData&&(radio("checkout.marketingData.create").broadcast(json.marketingData),this.campaignName(null!=(_ref7=json.marketingData)?_ref7.utmCampaign:void 0),this.campaignSource(null!=(_ref8=json.marketingData)?_ref8.utmSource:void 0),this.campaignMedium(null!=(_ref9=json.marketingData)?_ref9.utmMedium:void 0)),json.openTextField?null!==json.openTextField.value?(this.oldNote(json.openTextField.value),this.isNoteSaved=!0,this.isSavingNote=!1,this.note(json.openTextField.value),this.isUsingNote(!0)):(this.isSavingNote=!1,this.isUsingNote(!1),this.note(null)):this.isSavingNote=!1,json.shippingData&&this.parseShippingData(json.shippingData),null!=json.userType&&this.userType(json.userType),this.setup=!1,json.messages?vtex.checkout.MessageUtils.showMessagesFromOrderForm(json.messages):void 0},CheckoutModel.prototype.addressSubmitHandler=function(address){var xhr,_this=this;return xhr=API.getAddressInformation(address),xhr.done(function(address){return _this.parseShippingData({address:address})}),xhr.always(function(){return _this.shippingDataSubmitHandler({address:address,clearAddressIfPostalCodeNotFound:address.clearAddressIfPostalCodeNotFound})})},CheckoutModel.prototype.shippingDataSubmitHandler=function(shippingData){var attachment,attachmentId,jqxhr;return attachmentId="shippingData",attachment=shippingData,jqxhr=API.sendAttachment(attachmentId,attachment),jqxhr.fail(function(){return router.setHash("shipping")})},CheckoutModel.prototype.billingAddressSubmitHandler=function(billingAddress){var jqXHR;return jqXHR=API.getAddressInformation(billingAddress),jqXHR.done(function(address){var apiAddress;return apiAddress=address,radio("checkout.paymentData.billingAddress.commit").broadcast({postalCode:apiAddress.postalCode,addressType:0,addressId:(new Date).getTime().toString(),street:apiAddress.street,neighborhood:apiAddress.neighborhood,city:apiAddress.city,state:apiAddress.state,number:apiAddress.number,country:apiAddress.country})}),jqXHR.fail(function(){return radio("checkout.paymentData.billingAddress.commit").broadcast({postalCode:billingAddress.postalCode,country:billingAddress.country})})},CheckoutModel.prototype.giftCardSubmitHandler=function(attachmentId,attachment){var jqXHR;return jqXHR=API.sendAttachment(attachmentId,attachment),jqXHR.fail(function(){return window.paymentData.paymentGroups.giftCardPaymentGroup.loadingGiftCard(!1)})},CheckoutModel.prototype.logTransaction=function(value,referenceValue,payments,isIFrame){var error,paymentsStr;if(window.logSplunk){paymentsStr="";try{paymentsStr=JSON.stringify(payments)}catch(_error){error=_error,paymentsStr="Error transforming payments to string"}window.logSplunk({level:"Info",type:"Debug",workflowType:"checkout-ui",workflowInstance:"start-transaction",event:{value:value,referenceValue:referenceValue,payments:paymentsStr,isIFrame:isIFrame},account:vtex.accountName})}},CheckoutModel.prototype.paymentSubmitHandler=function(value,referenceValue,payments,isIFrame){var doBefore,interestValue,payment,savingNote,_i,_len,_this=this;if(this.isFinishingOrder)return window.checkoutLogger&&window.checkoutLogger({name:"lock",data:{}}),void console.log("Already finishing order");for(this.isFinishingOrder=!0,vtex.checkout.MessageUtils.showPaymentMessage(),interestValue=0,_i=0,_len=payments.length;_len>_i;_i++)payment=payments[_i],interestValue+=payment.value-payment.referenceValue;return doBefore=$.Deferred(),savingNote=!1,!this.isUsingNote()||this.isNoteSaved||this.isSavingNote||(savingNote=!0,doBefore=this.noteSubmitHandler(this.note())),doBefore.done(function(){var jqxhr;return _this.logTransaction(value,referenceValue,payments,isIFrame),jqxhr=API.startTransaction(value,referenceValue,interestValue,_this.saveData(),_this.optinNewsLetter()),jqxhr.fail(function(response,textStatus,error){var errorData,errorObject;return _this.isFinishingOrder=!1,vtex.checkout.MessageUtils.hidePaymentMessage(),errorData={status:null!=response?response.status:void 0,responseText:null!=response?response.responseText:void 0,textStatus:textStatus,error:error},radio("https://io.vtex.com.br/checkout-ui/5.16.7/script/checkout.paymentData.submit.fail").broadcast(errorData),_this.backgroundLoading(!1),errorObject={name:"transactionError",data:errorData},console.log("Error while trying to start transaction",errorObject),window.checkoutLogger&&window.checkoutLogger(errorObject),window.logSplunk?window.logSplunk({level:"Error",type:"Critical",workflowType:"checkout-ui",workflowInstance:"start-transaction-error",event:{status:null!=response?response.status:void 0,responseText:null!=response?response.responseText:void 0,textStatus:textStatus},account:vtex.accountName}):void 0}),jqxhr.done(function(transactionResponse){var deviceFingerprint,extraData,gatewayUrl,giftPayment,giftPayments,i,j,macId,merchant,merchantId,merchantTransactions,newPayment,paymentsArray,paymentsJSON,sessionId,transaction,transactionID,transactionPayment,transactionPayments,transactionURL,vtexFingerprint,_j,_k,_l,_len1,_len2,_len3,_len4,_m,_ref,_ref1,_ref2,_ref3,_ref4;if(transactionID=transactionResponse.id,transactionURL=transactionResponse.receiverUri,merchantTransactions=transactionResponse.merchantTransactions,transactionPayments=transactionResponse.paymentData.payments,transactionID&&window.logSplunk&&window.logSplunk({level:"Info",type:"Debug",workflowType:"checkout-ui",workflowInstance:"start-transaction-success",event:{transactionID:transactionID},account:vtex.accountName}),radio("checkout.paymentData.submit.success").broadcast(),null!=merchantTransactions&&merchantTransactions.length>0){for(paymentsArray=[],giftPayments=_.filter(payments,function(p){return"giftCardPaymentGroup"===p.group}),_j=0,_len1=giftPayments.length;_len1>_j;_j++)giftPayment=giftPayments[_j],giftPayment.transaction={id:merchantTransactions[0].transactionId,merchantName:merchantTransactions[0].merchantName};for(i=_k=0,_len2=payments.length;_len2>_k;i=++_k)for(payment=payments[i],j=_l=0,_len3=transactionPayments.length;_len3>_l;j=++_l)if(transactionPayment=transactionPayments[j],i===j)for(_ref=transactionPayment.merchantSellerPayments,_m=0,_len4=_ref.length;_len4>_m;_m++)merchant=_ref[_m],newPayment=_.clone(payment),_.extend(newPayment,merchant),merchantId=newPayment.id,transaction=_.find(merchantTransactions,function(m){return m.id.toLowerCase()===merchantId.toLowerCase()}),transaction&&(newPayment.transaction={id:transaction.transactionId,merchantName:transaction.merchantName},window.vtex.deviceFingerprintMap&&(null!=(_ref1=window.vtex.deviceFingerprintMap[transaction.id])&&"function"==typeof _ref1.toString?_ref1.toString():void 0)?(deviceFingerprint=null!=(_ref2=window.vtex.deviceFingerprintMap[transaction.id])&&"function"==typeof _ref2.toString?_ref2.toString():void 0,newPayment.fields||(newPayment.fields={}),newPayment.fields.deviceFingerprint=deviceFingerprint):(null!=(_ref3=window.vtex.deviceFingerprint)&&"function"==typeof _ref3.toString?_ref3.toString():void 0)&&(deviceFingerprint=null!=(_ref4=window.vtex.deviceFingerprint)&&"function"==typeof _ref4.toString?_ref4.toString():void 0,newPayment.fields||(newPayment.fields={}),newPayment.fields.deviceFingerprint=deviceFingerprint),vtexFingerprint=getVtexFingerPrint(),vtexFingerprint&&(newPayment.fields||(newPayment.fields={}),newPayment.fields.vtexFingerprint=vtexFingerprint),newPayment.installmentsValue=newPayment.installmentValue,newPayment.currencyCode=_this.currencyCode(),newPayment.originalPaymentIndex=i,paymentsArray.push(newPayment))}return sessionId=getSessionId(),macId=getMacId(),null==transactionURL?(_this.isFinishingOrder=!1,vtex.checkout.MessageUtils.hidePaymentMessage(),radio("https://io.vtex.com.br/checkout-ui/5.16.7/script/checkout.paymentData.submit.fail").broadcast("transactionUrl"),_this.goToFirstInvalidStep()):"NO-PAYMENT"===transactionID?window.location.href=transactionURL:(paymentsArray=giftPayments.concat(paymentsArray),isIFrame?(extraData={sessionId:sessionId,macId:macId},radio("paymentData.paymentGroup.iFrame."+isIFrame+".sendPayments").broadcast(paymentsArray,transactionResponse,extraData)):(paymentsJSON=JSON.stringify(paymentsArray),$("#sendPayments").attr("action",transactionURL),$("#paymentsArray").val(paymentsJSON),$("#sessionId").val(sessionId),$("#macId").val(macId),transactionResponse.gatewayCallbackTemplatePath&&(gatewayUrl=location.protocol+"//"+location.host+transactionResponse.gatewayCallbackTemplatePath,$("#callbackURL").val(gatewayUrl)),$("#sendPayments").submit()))})}),savingNote?void 0:doBefore.resolve()},getCookie=function(cookieName){return("; "+document.cookie).split("; "+cookieName+"=").pop().split(";").shift()},getSessionId=function(){return getCookie("VtexRCSessionIdv7")},getMacId=function(){return getCookie("VtexRCMacIdv7")},getVtexFingerPrint=function(){return getCookie("VtexFingerPrint")},CheckoutModel.prototype.noteSubmitHandler=function(value){var attachment,sendAttachmentXHR,_this=this;return""===value&&(value=null),attachment={value:value},this.isSavingNote=!0,sendAttachmentXHR=API.sendAttachment("openTextField",attachment),sendAttachmentXHR.done(function(data){return _this.isSavingNote=!1,_this.noteSaved=!0,_this.oldNote(_this.note())}),sendAttachmentXHR.fail(function(){return this.isSavingNote=!1,this.noteSaved=!1})},CheckoutModel.prototype.removeGiftRegistry=function(){var xhr,_this=this;return this.loading(!0),xhr=window.API.removeGiftRegistry(),xhr.done(function(data){return $.get("/no-cache/giftlistv2/cookiemanage")}),xhr.always(function(){return _this.loading(!1)})},CheckoutModel.prototype.login=function(){return vtexid.start({returnUrl:window.location.href,userEmail:window.clientProfileData.email(),locale:this.locale()})},CheckoutModel.prototype.getStates=function(country){return null==country&&(country="BRA"),"BRA"===country||"USA"===country||"CAN"===country?vtex.localeUtils[country].states:vtex.localeUtils[country]?vtex.localeUtils[country].map?(vtex.localeUtils[country].states||(vtex.localeUtils[country].states=_.map(vtex.localeUtils[country].map,function(k,v){return v})),vtex.localeUtils[country].states):_.map(vtex.localeUtils[country].states,function(v,k){return k}):void 0},CheckoutModel.prototype.getForgottenPostalCodeURL=function(country){switch(null==country&&(country="BRA"),country){case"BRA":return"http://www.buscacep.correios.com.br/servicos/dnec/index.do";case"ARG":return"http://www.correoargentino.com.ar/formularios/cpa";case"MEX":return"https://www.correosdemexico.gob.mx/SSLServicios/ConsultaCP/Descarga.aspx";case"URY":return"http://geo.correo.com.uy/IsisBusquedaDireccionPlugin/cp.jsp";case"PRT":return"https://www.ctt.pt/feapl_2/app/open/postalCodeSearch/postalCodeSearch.jspx";case"USA":return"https://tools.usps.com/go/ZipLookupAction_input";default:return"#"}},CheckoutModel}(),vtex.checkout.CheckoutModel=CheckoutModel}.call(this),function(){window.vtex||(window.vtex={}),vtex.checkout||(vtex.checkout={}),vtex.checkout.Module={moduleId:"",_cache:{},serializableProperties:function(){return[]},commit:function(){return this._cache=this.toJSON()},revert:function(){return this.update(this._cache)},update:function(data){
return ko.utils.extendObservable(this,data),this.commit(),this},submit:function(){return radio("checkout."+this.moduleId+".submit").broadcast(this.toJSON())},toJSON:function(){var attr,json,key,_i,_len,_ref;for(json={},_ref=this.serializableProperties(),_i=0,_len=_ref.length;_len>_i;_i++)key=_ref[_i],attr=ko.toJS(this[key]),json[key]=attr;return json},applyModuleSubscriptions:function(){return radio("checkout."+this.moduleId+".update").subscribe([this.update,this]),radio("checkout."+this.moduleId+".commit").subscribe([this.commit,this])},removeModuleSubscriptions:function(){return radio("checkout."+this.moduleId+".update").unsubscribe(this.update),radio("checkout."+this.moduleId+".commit").unsubscribe(this.commit)},destroy:function(){return this.removeModuleSubscriptions()},isDirty:function(){return!_.isEqual(this._cache,this.toJSON())}}}.call(this),function(){var TotalizerViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};TotalizerViewModel=function(){function TotalizerViewModel(data){this.removeListeners=__bind(this.removeListeners,this),this.shippingAddressRemoveHandler=__bind(this.shippingAddressRemoveHandler,this),this.shippingAddressChangeHandler=__bind(this.shippingAddressChangeHandler,this),this.handleOrderFormChange=__bind(this.handleOrderFormChange,this),this.isFree=__bind(this.isFree,this),this.isVisibleInit=__bind(this.isVisibleInit,this),this.isShipping=__bind(this.isShipping,this),this.isTax=__bind(this.isTax,this),this.isItems=__bind(this.isItems,this),this.update=__bind(this.update,this);var _this=this;this.id=ko.observable(),this.name=ko.observable(),this.value=ko.observable(),this.update(data),this.visible=ko.observable(this.isVisibleInit()),this.lowestPrice=ko.observable(null),this.valueLabel=ko.computed(function(){var label,lowestPrice,price;return lowestPrice=_this.lowestPrice(),lowestPrice?(label=i18n.t("totalizers.priceFrom"),price=_.intAsCurrency(lowestPrice),label+" "+price):_this.isFree()?i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.free"):_.intAsCurrency(_this.value())}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/orderFormUpdated.vtex",this.handleOrderFormChange)}return TotalizerViewModel.prototype.update=function(data){return this.id(data.id),this.name(data.name),this.value(data.value)},TotalizerViewModel.prototype.isItems=function(){return"Items"===this.id()},TotalizerViewModel.prototype.isTax=function(){return"Tax"===this.id()},TotalizerViewModel.prototype.isShipping=function(){return"Shipping"===this.id()},TotalizerViewModel.prototype.isVisibleInit=function(){return!(this.isTax()&&this.isFree())},TotalizerViewModel.prototype.isFree=function(){return 0===this.value()},TotalizerViewModel.prototype.handleOrderFormChange=function(e,orderForm){var _ref;return null!=(null!=(_ref=orderForm.shippingData)?_ref.address:void 0)?this.shippingAddressChangeHandler(orderForm.shippingData.address):this.shippingAddressRemoveHandler()},TotalizerViewModel.prototype.shippingAddressChangeHandler=function(address){return(!this.isShipping()||address)&&this.visible(!0),this.isTax()&&this.isFree()?this.visible(!1):void 0},TotalizerViewModel.prototype.shippingAddressRemoveHandler=function(){return this.shippingAddressChangeHandler()},TotalizerViewModel.prototype.removeListeners=function(){return $(window).off("https://io.vtex.com.br/checkout-ui/5.16.7/script/orderFormUpdated.vtex",this.handleOrderFormChange)},TotalizerViewModel}(),vtex.checkout.TotalizerViewModel=TotalizerViewModel}.call(this),function(){var SummaryViewModel,getLowestPrice,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};SummaryViewModel=function(){function SummaryViewModel(checkoutModel){this.goToFirstInvalidStep=__bind(this.goToFirstInvalidStep,this),this.deliverySelectedHandler=__bind(this.deliverySelectedHandler,this),this.deliveryEstimateAddressSubmitHandler=__bind(this.deliveryEstimateAddressSubmitHandler,this),this.logisticsInfoChangeHandler=__bind(this.logisticsInfoChangeHandler,this),this.usePostalCode=__bind(this.usePostalCode,this),this.resetShipping=__bind(this.resetShipping,this),this.calculateShipping=__bind(this.calculateShipping,this),this.shippingValueLabel=__bind(this.shippingValueLabel,this),this.newRatesAndBenefitsData=__bind(this.newRatesAndBenefitsData,this),this.addInterest=__bind(this.addInterest,this),this.newTotalizers=__bind(this.newTotalizers,this),this.addressRemoveHandler=__bind(this.addressRemoveHandler,this),this.addressChangeHandler=__bind(this.addressChangeHandler,this),this.update=__bind(this.update,this),this.subscriptions=__bind(this.subscriptions,this);var _this=this;this.totalizers=ko.observableArray([]),this.discounts=ko.observableArray([]),this.sellers=ko.observableArray([]),this.logisticsInfoArray=[],this.logisticsInfo=ko.observableArray([]),this.loading=checkoutModel.loading,this.isGiftRegistryAddress=ko.observable(!1),this.giftRegistryData=ko.observable(null),this.items=null,this.coupon=new vtex.checkout.CouponViewModel,this.slasForSellerViewModelArray=ko.observableArray(),this.interestValue=ko.observable(0),this.total=ko.computed(function(){var total,totalizer,_i,_len,_ref;for(total=0,_ref=_this.totalizers(),_i=0,_len=_ref.length;_len>_i;_i++)totalizer=_ref[_i],"interest"!==totalizer.id()&&totalizer.visible()&&(total+=totalizer.value());return total}),this.hasTotal=ko.computed(function(){var _ref;return(null!=(_ref=_this.totalizers())?_ref.length:void 0)>0}),this.totalLabel=ko.computed(function(){var hasTotal,total;return hasTotal=_this.hasTotal(),total=_this.total(),0===total?hasTotal?i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.free"):i18n.t("totalizers.toBeCalculated"):-1===_this.total()?i18n.t("totalizers.toBeCalculated"):_.intAsCurrency(_this.total()+_this.interestValue())}),this.isShippingKnown=ko.observable(!1),this.isUsingPostalCode=ko.observable(!1),this.postalCodeKey=ko.computed(function(){var _ref;return null!=(_ref=vtex.validation.countryToKey[checkout.countryCode()])?_ref.postalCode:void 0}),this.loadingPostalCode=ko.observable(!1),this.postalCode=ko.observable(),this.maskedPostalCode=ko.computed({read:function(){var masked,postalCode,_ref;return postalCode=_this.postalCode(),_this.isGiftRegistryAddress()?(null!=(_ref=_this.giftRegistryData())?_ref.description:void 0)||"":(masked=_.maskInfo(postalCode),masked===postalCode&&checkout.postalCodeMask()?_.maskString(postalCode,checkout.postalCodeMask()):masked)}}),this.deliveryCountry=ko.computed(function(){return checkout.countryCode()}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/orderFormUpdated.vtex",function(e,orderForm){return _this.update(orderForm)}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/deliverySelected.vtex",_.debounce(this.deliverySelectedHandler,200)),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/stateUpdated.vtex",function(e,state){var attachment,selectedSla,_ref,_ref1,_ref2;return"orderform"===state&&null!=(null!=(_ref=_this.address)?_ref.postalCode:void 0)&&null!=_this.logisticsInfoArray&&(_this.usePostalCode(),_this.isShippingKnown(!0),_this.postalCode(null!=(_ref1=_this.address)?_ref1.postalCode:void 0),selectedSla=null!=(_ref2=_this.logisticsInfo()[0])?_ref2.selectedSla():void 0,_this.previouslySelectedSla&&_this.previouslySelectedSla!==selectedSla)?(attachment={logisticsInfo:_(_this.logisticsInfo()).map(function(li){return _(li.toJSON()).pick("itemIndex","selectedSla","deliveryWindow","tax","selectedDeliveryChannel")}),address:_this.address},API.sendAttachment("shippingData",attachment)):void 0}),this.subscriptions()}return SummaryViewModel.prototype.subscriptions=function(){return radio("checkout.totalizers.interest").subscribe(this.addInterest),radio("checkout.ratesAndBenefitsData.create").subscribe(this.newRatesAndBenefitsData)},SummaryViewModel.prototype.update=function(orderForm){var shouldTranslate,_ref,_ref1;return shouldTranslate=!1,this.items=orderForm.items,orderForm.sellers&&this.sellers(orderForm.sellers),orderForm.totalizers&&(this.newTotalizers(orderForm.totalizers),shouldTranslate=!0),this.giftRegistryData(null!=orderForm?orderForm.giftRegistryData:void 0),null!=(null!=(_ref=orderForm.shippingData)?_ref.address:void 0)?this.addressChangeHandler(orderForm.shippingData.address):this.addressRemoveHandler(),null!=(null!=(_ref1=orderForm.shippingData)?_ref1.logisticsInfo:void 0)&&(this.previouslySelectedSla=null,this.logisticsInfoChangeHandler(orderForm.shippingData.logisticsInfo),shouldTranslate=!0),shouldTranslate?vtex.i18n.translateHtml(".summary"):void 0},SummaryViewModel.prototype.addressChangeHandler=function(address){return this.isGiftRegistryAddress("giftRegistry"===(null!=address?address.addressType:void 0)),this.address=address,this.postalCode(null!=address?address.postalCode:void 0),address?this.isShippingKnown(!0):void 0},SummaryViewModel.prototype.addressRemoveHandler=function(){return this.postalCode(""),this.isShippingKnown(!1)},SummaryViewModel.prototype.newTotalizers=function(totalizers){var tempTotalizers,totalizer,_i,_j,_len,_len1,_ref;for(tempTotalizers=[],_ref=this.totalizers(),_i=0,_len=_ref.length;_len>_i;_i++)totalizer=_ref[_i],totalizer.removeListeners();for(_j=0,_len1=totalizers.length;_len1>_j;_j++)totalizer=totalizers[_j],tempTotalizers.push(new vtex.checkout.TotalizerViewModel(totalizer));return this.totalizers(tempTotalizers)},SummaryViewModel.prototype.addInterest=function(interestValue){var tempTotalizers,totalizer;return tempTotalizers=_.reject(this.totalizers(),function(t){return"interest"===t.id()}),this.interestValue(interestValue),interestValue>0&&(totalizer={id:"interest",name:"interestValue",value:interestValue},tempTotalizers.push(new vtex.checkout.TotalizerViewModel(totalizer))),this.totalizers(tempTotalizers),vtex.i18n.translateHtml(".summary")},SummaryViewModel.prototype.newRatesAndBenefitsData=function(ratesAndBenefitsData){return this.discounts(ratesAndBenefitsData.rateAndBenefitsIdentifiers)},SummaryViewModel.prototype.shippingValueLabel=function(){var totalizer,_i,_len,_ref;for(_ref=this.totalizers(),_i=0,_len=_ref.length;_len>_i;_i++)if(totalizer=_ref[_i],"Shipping"===totalizer.id())return totalizer.valueLabel();return""},SummaryViewModel.prototype.calculateShipping=function(){var postalCodeRegex;return postalCodeRegex=vtex.ko.validation.regex[this.postalCodeKey()],postalCodeRegex.exec(this.postalCode())?this.deliveryEstimateAddressSubmitHandler({postalCode:this.postalCode(),country:this.deliveryCountry()}):void 0},SummaryViewModel.prototype.resetShipping=function(){return $(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/deliveryCleared.vtex"),this.isShippingKnown(!1),this.usePostalCode()},SummaryViewModel.prototype.usePostalCode=function(){return this.isUsingPostalCode(!0),$("#summary-postal-code:visible").focus().removeClass("success error")},SummaryViewModel.prototype.logisticsInfoChangeHandler=function(logisticsInfoArray){var hasOneDeliveryScheduledNotSelected,liGroupedBySeller,lowestPrice,shippingTotalizer,totalDeliveryWindowsValue,totalSLAValue,totalizer,_ref,_this=this;if(this.items)return this.previouslySelectedSla||(this.previouslySelectedSla=null!=(_ref=this.logisticsInfoArray[0])?_ref.selectedSla:void 0),this.logisticsInfoArray=logisticsInfoArray,totalSLAValue=_(logisticsInfoArray).reduce(function(memo,element){var selectedSla,_ref1;return selectedSla=_(element.slas).find(function(s){return s.id===element.selectedSla}),(null!=(_ref1=null!=selectedSla?selectedSla.price:void 0)?_ref1:0)+memo},0),liGroupedBySeller=_.groupBy(logisticsInfoArray,function(li){var item;return item=_this.items[li.itemIndex],null!=item?item.seller:void 0}),lowestPrice=null,hasOneDeliveryScheduledNotSelected=!1,totalDeliveryWindowsValue=_(liGroupedBySeller).reduce(function(memo,liArray){var isDeliveryWindowSelected,isSelectedSlaScheduled,selectedSla;return selectedSla=_(liArray[0].slas).find(function(s){return s.id===liArray[0].selectedSla}),(isSelectedSlaScheduled=(null!=selectedSla?selectedSla.availableDeliveryWindows.length:void 0)>0)?(isDeliveryWindowSelected=null!=selectedSla.deliveryWindow,isDeliveryWindowSelected?memo+selectedSla.deliveryWindow.price:(hasOneDeliveryScheduledNotSelected=!0,lowestPrice+=getLowestPrice(selectedSla.availableDeliveryWindows),memo)):(hasOneDeliveryScheduledNotSelected&&(lowestPrice+=selectedSla.price),memo)},0),shippingTotalizer=function(){var _i,_len,_ref1,_results;for(_ref1=this.totalizers(),_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)totalizer=_ref1[_i],"Shipping"===totalizer.id()&&_results.push(totalizer);return _results}.call(this)[0],null!=shippingTotalizer&&shippingTotalizer.lowestPrice(lowestPrice),null!=shippingTotalizer&&shippingTotalizer.value(totalSLAValue+totalDeliveryWindowsValue),this.logisticsInfo(_(logisticsInfoArray).map(function(li){return new vtex.checkout.LogisticsInfoViewModel(li)})),this.slasForSellerViewModelArray(vtex.checkout.SlasForSellerViewModel.slasGroupedBySeller(this.logisticsInfo()))},SummaryViewModel.prototype.deliveryEstimateAddressSubmitHandler=function(address){var xhr,_this=this;return this.loadingPostalCode(!0),xhr=API.calculateShipping(address),xhr.fail(function(){return $(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/deliveryCleared.vtex")}),xhr.always(function(){return _this.loadingPostalCode(!1)})},SummaryViewModel.prototype.deliverySelectedHandler=function(e,logisticsInfoArray,options){var attachment;return null==options&&(options={}),this.logisticsInfoChangeHandler(logisticsInfoArray),options.skipSendAttachment?void 0:(attachment={logisticsInfo:_(this.logisticsInfo()).map(function(li){return _(li.toJSON()).pick("itemIndex","selectedSla","deliveryWindow","tax","selectedDeliveryChannel")}),address:this.address},API.sendAttachment("shippingData",attachment))},SummaryViewModel.prototype.goToFirstInvalidStep=function(){var _ref;return null!=(_ref=window.router)&&_ref.validateAllSteps(),!1},SummaryViewModel}(),vtex.checkout.SummaryViewModel=SummaryViewModel,getLowestPrice=function(availableDeliveryWindows){var deliveryWindow,lowestPrice,_i,_len;for(lowestPrice=1/0,_i=0,_len=availableDeliveryWindows.length;_len>_i;_i++)deliveryWindow=availableDeliveryWindows[_i],deliveryWindow.price<lowestPrice&&(lowestPrice=deliveryWindow.price);return lowestPrice}}.call(this),function(){var ItemViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};ItemViewModel=function(){function ItemViewModel(json,index,ratesAndBenefitsIdentifiers,logisticsInfoArray,isSACModeActive){this.dispose=__bind(this.dispose,this),this.disposeChildrenViewModels=__bind(this.disposeChildrenViewModels,this),this.unsubscribe=__bind(this.unsubscribe,this),this.subscriptions=__bind(this.subscriptions,this),this.quantityBlurHandler=__bind(this.quantityBlurHandler,this),this.setSeller=__bind(this.setSeller,this),this.updateLogisticsInfo=__bind(this.updateLogisticsInfo,this),this.submit=__bind(this.submit,this),this.toJSON=__bind(this.toJSON,this),this.clone=__bind(this.clone,this),this.remove=__bind(this.remove,this),this.removeOffering=__bind(this.removeOffering,this),this.addOffering=__bind(this.addOffering,this),this.setOptionDisable=__bind(this.setOptionDisable,this),this.addLastItemAttachmentOffering=__bind(this.addLastItemAttachmentOffering,this),this.addSelectedOffering=__bind(this.addSelectedOffering,this),this.addLastAvailableOffering=__bind(this.addLastAvailableOffering,this),this.attachmentName=__bind(this.attachmentName,this),this.replaceSKU=__bind(this.replaceSKU,this),this.toggleSKUSelector=__bind(this.toggleSKUSelector,this),this.closeSKUSelector=__bind(this.closeSKUSelector,this),this.openSKUSelector=__bind(this.openSKUSelector,this),this.setSKUOptions=__bind(this.setSKUOptions,this),this.handleSkusSimulation=__bind(this.handleSkusSimulation,this),this.handleGetProductVariationsSuccess=__bind(this.handleGetProductVariationsSuccess,this),this.getProductVariations=__bind(this.getProductVariations,this),this.getSkusSimulated=__bind(this.getSkusSimulated,this),this.generateImageUrl=__bind(this.generateImageUrl,this),this.update=__bind(this.update,this),this.decrement=__bind(this.decrement,this),this.increment=__bind(this.increment,this),this.setQuantity=__bind(this.setQuantity,this),this.toggleDiscount=__bind(this.toggleDiscount,this),this.handleDeliverySelected=__bind(this.handleDeliverySelected,this),this.removeManualPrice=__bind(this.removeManualPrice,this),this.saveManualPrice=__bind(this.saveManualPrice,this),this.toggleManualPrice=__bind(this.toggleManualPrice,this);var _this=this;this.index=ko.observable(),this.id=ko.observable(),this.productId=ko.observable(),this.detailUrl=ko.observable(),this.imageUrl=ko.observable(),this.name=ko.observable(),this.skuName=ko.observable(),this.skuRefId=ko.observable(),this.sellerId=ko.observable(),this.sellerName=ko.observable(""),this.brand=ko.observable(),this.brandId=ko.observable(),this.category=ko.observable(),this.categoryId=ko.observable(),this.categoryTree=ko.observableArray(),this.categoryIdTree=ko.observableArray(),this.listPrice=ko.observable(),this.price=ko.observable(),this.manualPrice=ko.observable(),this.isManualPriceActive=ko.observable(!1),this.sellingPrice=ko.observable(),this.showDiscount=ko.observable(!1),this.showDiscountButton=ko.observable(!1),this.quantity=ko.observable(),this.offerings=ko.observableArray(),this.components=ko.observableArray(),this.bundleItems=ko.observableArray(),this.seller=new vtex.checkout.SellerViewModel,this.isGift=ko.observable(!1),this.tax=ko.observable(),this.estimateLabel=ko.observable(i18n.t("cart.seller.toBeCalculated")),this.estimateDetailLabel=ko.observable(),this.isSelectedSla=ko.observable(!1),this.measurementUnit=ko.observable(),this.unitMultiplier=ko.observable(),this.priceTags=ko.observableArray(),this.cartLoadingItem=ko.observable(!1),this.productData=ko.observable(),this.skuOptions=ko.observableArray(),this.skuOptionsEnabled=ko.observableArray(),this.isSKUSelectorOpen=ko.observable(!1),this.SKUSelectorLoading=ko.observable(!0),this.isSACModeActive=isSACModeActive,this.productId()&&this.setSKUOptions(this.productId()),this.productId.subscribe(this.setSKUOptions),this.isSACModeActive.subscribe(function(isActive){return isActive&&null!=_this.productId()?_this.setSKUOptions(_this.productId()):void 0}),this.selectedItemAttachmentOffering=ko.observable(),this.itemAttachmentsList=ko.observableArray([]),this._manualPriceInput=ko.observable(),this.shippingPriceLabel=ko.observable(),this.shippingName=ko.observable(),this.availability=ko.observable(),this.selectedOffering=ko.observable(),this.subscriptions(),this.update(json,index,ratesAndBenefitsIdentifiers,logisticsInfoArray)}return ItemViewModel.prototype.toggleManualPrice=function(){return this.isManualPriceActive(!this.isManualPriceActive()),this.isManualPriceActive()?this.manualPriceInput(this.sellingPrice()):void 0},ItemViewModel.prototype.saveManualPrice=function(item,event){var manualPriceInt;return("keyup"===event.type&&13===event.keyCode||"blur"===event.type)&&this.isManualPriceActive?(manualPriceInt=parseInt(this.manualPriceInput().replace(/[\.,]/g,""),10),manualPriceInt>=0&&manualPriceInt!==this.sellingPrice()?(this.manualPrice(manualPriceInt),this.sellingPrice(manualPriceInt),vtexjs.checkout.setManualPrice(item.index(),manualPriceInt)):this.manualPriceInput(""),this.toggleManualPrice()):void 0},ItemViewModel.prototype.removeManualPrice=function(item){return vtexjs.checkout.removeManualPrice(item.index())},ItemViewModel.prototype.handleDeliverySelected=function(e,logisticsInfoArray){var _this=this;return this.updateLogisticsInfo(_.find(logisticsInfoArray,function(li){return li.itemIndex===_this.index()}))},ItemViewModel.prototype.toggleDiscount=function(){return this.showDiscount(!this.showDiscount())},ItemViewModel.prototype.setQuantity=function(value){return this.quantity(value)},ItemViewModel.prototype.increment=function(){return this.quantity(this.quantity()+1)},ItemViewModel.prototype.decrement=function(){return this.quantity()>1?this.quantity(this.quantity()-1):void 0},ItemViewModel.prototype.update=function(data,index,ratesAndBenefitsIdentifiers,logisticsInfoArray){var attOff,attachment,attachmentsList,bundleItem,c,categoryIds,component,imageUrl,newBundleItem,newComponent,newOffering,offering,relativeOffering,tempBundleItems,tempComponents,tempItemAttachmentsList,tempOfferings,_i,_j,_k,_l,_len,_len1,_len2,_len3,_len4,_m,_ref,_ref1,_ref2,_ref3,_ref4,_this=this;if(null!=data){for(this.index(index),this.productId(data.productId),this.id(data.id),this.detailUrl(data.detailUrl),imageUrl=null!=(_ref=data.imageUrl)?_ref.replace(/http\:|https:/,""):void 0,this.imageUrl(imageUrl),this.name(data.name),this.skuName(data.skuName),this.skuRefId(data.refId),this.sellerId(data.seller),this.brand(data.additionalInfo.brandName),this.brandId(data.additionalInfo.brandId),categoryIds=[],data.productCategoryIds&&(categoryIds=data.productCategoryIds.split("/"),categoryIds=_.reject(categoryIds,function(c){return 0===c.length}),this.categoryId(categoryIds[categoryIds.length-1]),this.category(data.productCategories[this.categoryId()])),this.categoryTree([]),this.categoryIdTree([]),_i=0,_len=categoryIds.length;_len>_i;_i++)c=categoryIds[_i],this.categoryIdTree.push(c),this.categoryTree.push(data.productCategories[c]);for(this.listPrice(data.listPrice),this.price(data.price),this.sellingPrice(data.sellingPrice),this.manualPrice(data.manualPrice),this.setQuantity(data.quantity),this.tax(data.tax),this.isGift(data.isGift),this.availability(data.availability),this.measurementUnit(data.measurementUnit?data.measurementUnit:"un"),this.unitMultiplier(data.unitMultiplier?data.unitMultiplier:1),this.priceTags(data.priceTags),this.disposeChildrenViewModels(),tempItemAttachmentsList=[],data.attachmentOfferings||(data.attachmentOfferings=[]),_ref1=data.attachmentOfferings,_j=0,_len1=_ref1.length;_len1>_j;_j++)attOff=_ref1[_j],attachmentsList=new vtex.checkout.ItemAttachmentListViewModel(index),attachment=_.find(data.attachments,function(att){return att.name===attOff.name}),attachmentsList.update(attOff,attachment),tempItemAttachmentsList.push(attachmentsList);for(this.itemAttachmentsList=ko.observableArray(tempItemAttachmentsList),tempComponents=[],_ref2=data.components,_k=0,_len2=_ref2.length;_len2>_k;_k++)component=_ref2[_k],newComponent=new vtex.checkout.ItemViewModel(component,index,ratesAndBenefitsIdentifiers,logisticsInfoArray,this.isSACModeActive),tempComponents.push(newComponent);for(this.components=ko.observableArray(tempComponents),tempOfferings=[],_ref3=data.offerings,_l=0,_len3=_ref3.length;_len3>_l;_l++)offering=_ref3[_l],newOffering=new vtex.checkout.OfferingViewModel(index,!0).update(offering),tempOfferings.push(newOffering);for(this.offerings=ko.observableArray(tempOfferings),tempBundleItems=[],_ref4=data.bundleItems,_m=0,_len4=_ref4.length;_len4>_m;_m++)bundleItem=_ref4[_m],relativeOffering=_.find(data.offerings,function(o){return bundleItem.id===o.id}),newBundleItem=new vtex.checkout.OfferingViewModel(index,!1).update(bundleItem,relativeOffering),tempBundleItems.push(newBundleItem);return this.bundleItems=ko.observableArray(tempBundleItems),this.seller=new vtex.checkout.SellerViewModel(data.sellerId),this.disposables=[this.manualPriceInput=ko.computed({read:function(){return _this._manualPriceInput()},write:function(value){var intValue;return value=value.toString().replace(/\D/g,""),_this._manualPriceInput(value),""===value&&(value=0),intValue=parseInt(value,10),_this._manualPriceInput(_.formatCurrency(intValue/100))}}),this.itemAttachments=ko.computed(function(){return _.filter(_this.itemAttachmentsList(),function(it){return it.isUsingAttachment()})}),this.itemAttachmentOfferings=ko.computed(function(){var offerings;return offerings=_.filter(_this.itemAttachmentsList(),function(it){return!it.isUsingAttachment()})}),this.addSelectedItemAttachmentOffering=ko.computed(function(){var it,selectedItemAttachmentOffering;return selectedItemAttachmentOffering=_this.selectedItemAttachmentOffering(),null!=selectedItemAttachmentOffering?(it=_.find(_this.itemAttachmentOfferings(),function(it){return it.name()===selectedItemAttachmentOffering.name()}),it.isUsingAttachment(!0),selectedItemAttachmentOffering.saveAttachment(),_this.selectedItemAttachmentOffering(null)):void 0}),this.selectItemAttachmentOfferingLabel=ko.computed(function(){return checkout.locale(),i18n.t("cart.addInfo")}),this.selectCloneItemLabel=ko.computed(function(){return checkout.locale(),i18n.t("cart.cloneItem")}),this.lastItemAttachmentOfferingLabel=ko.computed(function(){return null!=_this.itemAttachmentOfferings()[0]?i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.add")+" "+_this.attachmentName(_this.itemAttachmentOfferings()[0]):void 0}),this.unitLabel=ko.computed(function(){var multiplier,quantity,unit;return multiplier=_this.unitMultiplier(),unit=_this.measurementUnit(),quantity=_this.quantity(),"un"!==unit?""+parseFloat(multiplier*quantity).toFixed(2)+" "+unit:void 0}),this.quantityLabel=ko.computed(function(){return _this.unitLabel()||_this.quantity()}),this.multiplierLabel=ko.computed(function(){var multiplier,unit;return multiplier=_this.unitMultiplier(),unit=_this.measurementUnit(),1*multiplier!==1?"x "+parseFloat(multiplier).toFixed(2)+" "+unit:void 0}),this.unavailableForDelivery=ko.computed(function(){var _ref5;return"cannotBeDelivered"===(_ref5=_this.availability())}),this.available=ko.computed(function(){var _ref5;return"available"===(_ref5=_this.availability())||null===_ref5||void 0===_ref5}),this.isPriceVisible=ko.computed(function(){var _ref5;return _this.available()||!("cannotBeDelivered"===(_ref5=_this.availability())||"withoutStock"===_ref5)}),this.canChangeQty=ko.computed(function(){var availability,available,loading,_ref5;return loading=_this.cartLoadingItem(),available=_this.available(),availability="cannotBeDelivered"===(_ref5=_this.availability()),loading?!1:available||availability}),this.priceLabel=ko.computed(function(){return 0===_this.price()?i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.free"):null===_this.price()?"-":_.intAsCurrency(Math.floor(_this.price()*_this.unitMultiplier()))}),this.sellingPriceLabel=ko.computed(function(){return 0===_this.sellingPrice()?i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.free"):null===_this.price()?"-":_.intAsCurrency(_this.sellingPrice())}),this.priceLabelPerUnit=ko.computed(function(){return 0!==_this.price()&&"un"!==_this.measurementUnit()?_.intAsCurrency(_this.price())+" / "+_this.measurementUnit():""}),this.valueLabel=ko.computed(function(){var total;return 0===_this.sellingPrice()?i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.free"):null===_this.sellingPrice()?"-":""===_this.quantity()||0===_this.quantity()?_.intAsCurrency(0):(total=_this.sellingPrice()*_this.quantity(),_.intAsCurrency(total))}),this.priceValueLabel=ko.computed(function(){var total;return 0===_this.price()?i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.free"):null===_this.price()?"-":""===_this.quantity()||0===_this.quantity()?_.intAsCurrency(0):(total=Math.floor(_this.price()*_this.unitMultiplier()*_this.quantity()),_.intAsCurrency(total))}),this.listPriceLabel=ko.computed(function(){return _this.listPrice()<=_this.sellingPrice()?void 0:0===_this.listPrice()?i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.free"):_.intAsCurrency(_this.listPrice())}),this.discount=ko.computed(function(){return _this.price()>_this.sellingPrice()&&_this.showDiscountButton(!0),_.intAsCurrency(_this.price()-_this.sellingPrice())}),this.isListPriceVisible=ko.computed(function(){return void 0!==_this.listPriceLabel()}),this.quantityThrottled=ko.computed({read:function(){return _this.quantity()},deferEvaluation:!0}).extend({throttle:500}),this.quantityThrottled.subscribe(function(newValue){return!isNaN(newValue)&&newValue>0?_this.submit():void 0}),this.availableOfferings=ko.computed(function(){var available,offer,sameBundleItem,_len5,_n,_ref5;for(available=[],_ref5=_this.offerings(),_n=0,_len5=_ref5.length;_len5>_n;_n++)offer=_ref5[_n],sameBundleItem=_.find(_this.bundleItems(),function(b){return b.id()===offer.id()||b.type()===offer.type()}),sameBundleItem||available.push(offer);return available})],ratesAndBenefitsIdentifiers?_.each(this.priceTags(),function(pt){return pt.ratesAndBenefitsIdentifier=_.find(ratesAndBenefitsIdentifiers,function(rnbi){return rnbi.id===pt.identifier})}):this.priceTags()&&this.priceTags().length>0&&_.each(this.priceTags(),function(pt){return pt.ratesAndBenefitsIdentifier=null}),logisticsInfoArray&&this.handleDeliverySelected(null,logisticsInfoArray),this}},ItemViewModel.prototype.generateImageUrl=function(sku){var imageUrl,urlParts,_ref;if(null!=(_ref=sku.images)?_ref[0]:void 0)return imageUrl=sku.images[0].imageUrl.replace(/(http|https):\/\//,""),urlParts=imageUrl.split("/"),urlParts[3]+="-55-55",window.location.protocol+"//"+urlParts.join("/")},ItemViewModel.prototype.getSkusSimulated=function(){var items,_this=this;return items=this.skuOptions().map(function(_arg){var itemId;return itemId=_arg.itemId,{id:itemId,quantity:1,seller:_this.seller.id()}}),$.ajax({type:"POST",contentType:"application/json; charset=UTF-8",url:"/api/checkout/pub/orderForms/simulation",data:JSON.stringify({items:items})})},ItemViewModel.prototype.getProductVariations=function(productId){return null==productId&&(productId=this.productId()),$.get("/api/catalog_system/pub/products/search",{fq:"productId:"+productId})},ItemViewModel.prototype.handleGetProductVariationsSuccess=function(res){var _ref,_this=this;return this.productData(res),this.skuOptions(_.chain((null!=(_ref=res[0])?_ref.items:void 0)||[]).filter(function(sku){return _.any(sku.sellers,function(seller){var _ref;return(null!=(_ref=seller.commertialOffer)?_ref.AvailableQuantity:void 0)>0})}).filter(function(sku){return sku.itemId!==_this.id()}).map(function(sku){return _.extend(sku,{imageUrl:_this.generateImageUrl(sku),selectSKU:function(){return _this.replaceSKU(sku)}})}).value())},ItemViewModel.prototype.handleSkusSimulation=function(res){var items,_this=this;return items=res.items,this.skuOptions(this.skuOptions().map(function(sku){return items.forEach(function(skuItem){return skuItem.id===sku.itemId?(sku.rawPrice=skuItem.price,0===skuItem.price?sku.price=i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.free"):sku.price=_.intAsCurrency(skuItem.price)):void 0}),_.extend(sku,{enabled:sku.rawPrice===_this.price()})})),this.skuOptionsEnabled(this.skuOptions().filter(function(sku){return sku.enabled})),this.SKUSelectorLoading(!1)},ItemViewModel.prototype.setSKUOptions=function(productId){return null==productId&&(productId=this.productId()),productId&&this.isSACModeActive()?this.getProductVariations(productId).success(this.handleGetProductVariationsSuccess):void 0},ItemViewModel.prototype.openSKUSelector=function(){return this.isSKUSelectorOpen(!0),this.getSkusSimulated().success(this.handleSkusSimulation),document.addEventListener("click",this.closeSKUSelector,!1)},ItemViewModel.prototype.closeSKUSelector=function(){return this.isSKUSelectorOpen(!1),document.removeEventListener("click",this.closeSKUSelector,!1)},ItemViewModel.prototype.toggleSKUSelector=function(){return this.isSKUSelectorOpen(!this.isSKUSelectorOpen())},ItemViewModel.prototype.replaceSKU=function(newSKU){var items;return radio("checkout.cart.loadingItem").broadcast(!0),items=[{seller:this.sellerId(),quantity:0,index:this.index()},{seller:newSKU.sellers[0].sellerId,quantity:this.quantity(),id:newSKU.itemId}],vtexjs.checkout.replaceSKU(items,null,!1)},ItemViewModel.prototype.attachmentName=function(attachment){var isSubscriptionAttachment;return isSubscriptionAttachment=0===attachment.name().indexOf("vtex.subscription"),isSubscriptionAttachment?i18n.t("subscription.subscription"):attachment.name()},ItemViewModel.prototype.addLastAvailableOffering=function(){return this.addOffering(this.availableOfferings()[0].id())},ItemViewModel.prototype.addSelectedOffering=function(){return this.addOffering(this.selectedOffering().id())},ItemViewModel.prototype.addLastItemAttachmentOffering=function(){var it;return it=this.itemAttachmentOfferings()[0],it.isUsingAttachment(!0)},ItemViewModel.prototype.setOptionDisable=function(option,item){return"undefined"==typeof item&&this.selectedItemAttachmentOffering()?ko.applyBindingsToNode(option,{disable:!0},item):void 0},ItemViewModel.prototype.addOffering=function(offeringId){return radio("checkout.cart.loadingItem").broadcast(!0),radio("checkout.offering.loading").broadcast(!0),API.addOffering(offeringId,this.index()).always(function(){return radio("checkout.cart.loadingItem").broadcast(!1),
radio("checkout.offering.loading").broadcast(!1)})},ItemViewModel.prototype.removeOffering=function(item,offeringId){if(item.index()===this.index())return radio("checkout.cart.loadingItem").broadcast(!0),radio("checkout.offering.loading").broadcast(!0),API.removeOffering(offeringId,this.index()).always(function(){return radio("checkout.cart.loadingItem").broadcast(!1),radio("checkout.offering.loading").broadcast(!1)})},ItemViewModel.prototype.remove=function(){return this.setQuantity(0),this.submit()},ItemViewModel.prototype.clone=function(){var _ref;return radio("checkout.cart.loadingItem").broadcast(!0),API.cloneItem(this.index()).always(function(){return radio("checkout.cart.loadingItem").broadcast(!1)}),null!=(_ref=window.vtex.checkout.analytics)?_ref.removeFromCart([this.toJSON()]):void 0},ItemViewModel.prototype.toJSON=function(){return{seller:this.sellerId(),quantity:this.quantity(),id:this.id(),index:this.index(),hasBundleItems:this.bundleItems().length>0}},ItemViewModel.prototype.submit=function(){return radio("checkout.cart.loadingItem").broadcast(!0),radio("checkout.item.submit").broadcast(this.toJSON())},ItemViewModel.prototype.updateLogisticsInfo=function(logisticInfo){var selectedSla,slaVM;if((null!=logisticInfo?logisticInfo.itemIndex:void 0)===this.index())return selectedSla=_(logisticInfo.slas).find(function(s){return s.id===logisticInfo.selectedSla}),selectedSla?(this.isSelectedSla(!0),slaVM=new vtex.checkout.SlaViewModel(selectedSla),slaVM.isScheduled?null==slaVM.deliveryWindow()?void console.log("WARN: Got deliverySelected with scheduledSLA and no delivery window"):(this.estimateLabel(_.dateFormat(slaVM.deliveryWindow().endDate)),this.estimateDetailLabel(slaVM.deliveryWindow().timeLabel),this.shippingPriceLabel(slaVM.valueLabel),this.shippingName(slaVM.pickupPointName||slaVM.name)):(this.estimateLabel(slaVM.estimateLabel),this.estimateDetailLabel(null),this.shippingPriceLabel(slaVM.valueLabel),this.shippingName(slaVM.pickupPointName||slaVM.name))):(this.isSelectedSla(!1),this.estimateLabel(i18n.t("cart.seller.toBeCalculated")))},ItemViewModel.prototype.setSeller=function(data){return data.id===this.sellerId()?(this.seller.update(data),this.sellerName(data.name),vtex.i18n.translateHtml(".product-item .seller")):void 0},ItemViewModel.prototype.quantityBlurHandler=function(){var qty;return qty=parseInt(this.quantity(),10),0===qty||isNaN(qty)?this.quantity(1):void 0},ItemViewModel.prototype.translateBundleItems=function(){return vtex.i18n.translateHtml(".item-service")},ItemViewModel.prototype.subscriptions=function(){radio("checkout.offering.remove").subscribe(this.removeOffering),radio("checkout.sellers.create").subscribe(this.setSeller),radio("checkout.cart.loadingItem").subscribe(this.cartLoadingItem),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/deliverySelected.vtex",this.handleDeliverySelected)},ItemViewModel.prototype.unsubscribe=function(){radio("checkout.offering.remove").unsubscribe(this.removeOffering),radio("checkout.sellers.create").unsubscribe(this.setSeller),radio("checkout.cart.loadingItem").unsubscribe(this.cartLoadingItem),$(window).off("https://io.vtex.com.br/checkout-ui/5.16.7/script/deliverySelected.vtex",this.handleDeliverySelected)},ko.bindingHandlers.inputNumber={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var observable;return observable=valueAccessor(),$(element).inputNumber(),$(element).change(function(){return observable($(this).val())})}},ItemViewModel.prototype.disposeChildrenViewModels=function(){var item,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3,_results;for(_ref=this.itemAttachmentsList.removeAll(),_i=0,_len=_ref.length;_len>_i;_i++)item=_ref[_i],item.dispose();for(_ref1=this.components.removeAll(),_j=0,_len1=_ref1.length;_len1>_j;_j++)item=_ref1[_j],item.dispose();for(_ref2=this.offerings.removeAll(),_k=0,_len2=_ref2.length;_len2>_k;_k++)item=_ref2[_k],item.dispose();for(_ref3=this.bundleItems.removeAll(),_results=[],_l=0,_len3=_ref3.length;_len3>_l;_l++)item=_ref3[_l],_results.push(item.dispose());return _results},ItemViewModel.prototype.dispose=function(){var disposable,_i,_len,_ref,_results;for(radio("checkout.offering.remove").unsubscribe(this.removeOffering),radio("checkout.sellers.create").unsubscribe(this.setSeller),radio("checkout.cart.loadingItem").unsubscribe(this.cartLoadingItem),$(window).off("https://io.vtex.com.br/checkout-ui/5.16.7/script/deliverySelected.vtex",this.handleDeliverySelected),this.disposeChildrenViewModels(),_ref=this.disposables,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)disposable=_ref[_i],_results.push(disposable.dispose());return _results},ItemViewModel}(),vtex.checkout.ItemViewModel=ItemViewModel}.call(this),function(){var OfferingViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};OfferingViewModel=function(){function OfferingViewModel(itemIndex,isOffering){this.dispose=__bind(this.dispose,this),this.disposeChildrenViewModels=__bind(this.disposeChildrenViewModels,this),this.addLastItemAttachmentOffering=__bind(this.addLastItemAttachmentOffering,this),this.setOptionDisable=__bind(this.setOptionDisable,this),this.handleFail=__bind(this.handleFail,this),this.setLoading=__bind(this.setLoading,this),this.remove=__bind(this.remove,this),this.isFree=__bind(this.isFree,this),this.update=__bind(this.update,this);var _this=this;this.index=ko.observable(itemIndex),this.isOffering=isOffering,this.id=ko.observable(),this.name=ko.observable(),this.price=ko.observable(),this.tax=ko.observable(0),this.type=ko.observable(),this.selectedItemAttachmentOffering=ko.observable(),this.itemAttachmentsList=ko.observableArray([]),this.allowGiftMessage=ko.observable(!1),this.loading=ko.observable(!1),this.disposables=[this.itemAttachments=ko.computed(function(){return _.filter(_this.itemAttachmentsList(),function(it){return it.isUsingAttachment()})}),this.itemAttachmentOfferings=ko.computed(function(){var offerings;return offerings=_.filter(_this.itemAttachmentsList(),function(it){return!it.isUsingAttachment()})}),this.addSelectedItemAttachmentOffering=ko.computed(function(){var it;return null!=_this.selectedItemAttachmentOffering()?(it=_.find(_this.itemAttachmentOfferings(),function(it){return it.name()===_this.selectedItemAttachmentOffering().name()}),it.isUsingAttachment(!0),_this.selectedItemAttachmentOffering(null)):void 0}),this.selectItemAttachmentOfferingLabel=ko.computed(function(){return checkout.locale(),i18n.t("cart.addInfo")}),this.lastItemAttachmentOfferingLabel=ko.computed(function(){var isSubscriptionAttachment,name,_ref,_ref1;return name=null!=(_ref=_this.itemAttachmentOfferings()[0])?_ref.name():void 0,isSubscriptionAttachment=name&&0===name.indexOf("vtex.subscription"),isSubscriptionAttachment?i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.add")+" "+i18n.t("subscription.subscription"):i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.add")+" "+(null!=(_ref1=_this.itemAttachmentOfferings()[0])?_ref1.name():void 0)}),this.giftMessageAttachment=ko.computed(function(){var itemAttachmentsList;return itemAttachmentsList=_.find(_this.itemAttachmentsList(),function(att){return"message"===(null!=att?att.name():void 0)})}),this.priceLabel=ko.computed(function(){return _this.isFree()?i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.free"):_.intAsCurrency(_this.price())})],radio("checkout.offering.loading").subscribe(this.setLoading),radio("https://io.vtex.com.br/checkout-ui/5.16.7/script/checkout.offering.fail").subscribe(this.handleFail)}return OfferingViewModel.prototype.update=function(data,relativeOffering){var attOff,attachment,attachmentsList,item,tempItemAttachmentsList,_i,_j,_len,_len1,_ref,_ref1;if(this.id(data.id),this.name(data.name),this.price(data.price),this.type(data.type),data.tax&&this.tax(data.tax),!this.isOffering){for((null!=relativeOffering?relativeOffering.allowGiftMessage:void 0)&&this.allowGiftMessage(relativeOffering.allowGiftMessage),_ref=this.itemAttachmentsList.removeAll(),_i=0,_len=_ref.length;_len>_i;_i++)item=_ref[_i],item.dispose();for(tempItemAttachmentsList=[],_ref1=data.attachmentOfferings,_j=0,_len1=_ref1.length;_len1>_j;_j++)attOff=_ref1[_j],attachmentsList=new vtex.checkout.ItemAttachmentListViewModel(this.index(),this.id()),attachment=_.find(data.attachments,function(att){return att.name===attOff.name}),attachmentsList.update(attOff,attachment),tempItemAttachmentsList.push(attachmentsList);this.itemAttachmentsList(tempItemAttachmentsList)}return vtex.i18n.translateHtml(".item-service"),this},OfferingViewModel.prototype.isFree=function(){return 0===this.price()},OfferingViewModel.prototype.remove=function(parent){return radio("checkout.offering.remove").broadcast(parent,this.id())},OfferingViewModel.prototype.setLoading=function(itemIndex,id,flag){return itemIndex===this.index()&&id===this.id()?this.loading(flag):void 0},OfferingViewModel.prototype.handleFail=function(itemIndex,id,message){itemIndex!==this.index()||id!==this.id()},OfferingViewModel.prototype.setOptionDisable=function(option,item){return"undefined"==typeof item&&this.selectedItemAttachmentOffering()?ko.applyBindingsToNode(option,{disable:!0},item):void 0},OfferingViewModel.prototype.addLastItemAttachmentOffering=function(){var it;return it=this.itemAttachmentOfferings()[0],it.isUsingAttachment(!0)},OfferingViewModel.prototype.disposeChildrenViewModels=function(){var item,_i,_len,_ref,_results;for(_ref=this.itemAttachmentsList.removeAll(),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)item=_ref[_i],_results.push(item.dispose());return _results},OfferingViewModel.prototype.dispose=function(){var disposable,_i,_len,_ref,_results;for(radio("checkout.offering.loading").unsubscribe(this.setLoading),radio("https://io.vtex.com.br/checkout-ui/5.16.7/script/checkout.offering.fail").unsubscribe(this.handleFail),this.disposeChildrenViewModels(),_ref=this.disposables,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)disposable=_ref[_i],_results.push(disposable.dispose());return _results},OfferingViewModel}(),vtex.checkout.OfferingViewModel=OfferingViewModel}.call(this),function(){var SellerViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};SellerViewModel=function(){function SellerViewModel(){this.update=__bind(this.update,this),this.id=ko.observable(),this.name=ko.observable(""),this.logo=ko.observable("")}return SellerViewModel.prototype.update=function(data){return null!=data?(this.id(data.id),this.name(data.name),this.logo(data.logo)):void 0},SellerViewModel}(),vtex.checkout.SellerViewModel=SellerViewModel}.call(this),function(){var CouponViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};CouponViewModel=function(){function CouponViewModel(){this.subscriptions=__bind(this.subscriptions,this),this._APIremoveAndBroadcast=__bind(this._APIremoveAndBroadcast,this),this.removeCoupon=__bind(this.removeCoupon,this),this._APIaddAndBroadcast=__bind(this._APIaddAndBroadcast,this),this.addCoupon=__bind(this.addCoupon,this),this.update=__bind(this.update,this);var _this=this;this.value=ko.observable(""),this.couponCode=ko.observable(),this.isUsingCoupon=ko.observable(!1),this.loadingCoupon=ko.observable(!1),this.subscriptions(),this.isCouponTyped=ko.computed(function(){return""===_this.value()?!1:(_this.isUsingCoupon(!0),!0)})}return CouponViewModel.prototype.update=function(data){return null!=(null!=data?data.coupon:void 0)?this.value(data.coupon):(this.isUsingCoupon(!1),this.couponCode(""),this.value(""))},CouponViewModel.prototype.addCoupon=function(){return this.couponCode()?(radio("checkout.coupon.loading").broadcast(!0),this._APIaddAndBroadcast()):void 0},CouponViewModel.prototype._APIaddAndBroadcast=function(){return API.addDiscountCoupon(this.couponCode()).always(function(){return radio("checkout.coupon.loading").broadcast(!1)})},CouponViewModel.prototype.removeCoupon=function(){return this.couponCode(""),radio("checkout.coupon.loading").broadcast(!0),this._APIremoveAndBroadcast()},CouponViewModel.prototype._APIremoveAndBroadcast=function(){return API.removeDiscountCoupon().always(function(){return radio("checkout.coupon.loading").broadcast(!1)})},CouponViewModel.prototype.subscriptions=function(){return radio("checkout.marketingData.create").subscribe(this.update),radio("checkout.coupon.loading").subscribe(this.loadingCoupon)},CouponViewModel}(),vtex.checkout.CouponViewModel=CouponViewModel}.call(this),function(){var GatewayExceptionMessage,MessageUtils,showUnavailableMessage,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};GatewayExceptionMessage=function(){function GatewayExceptionMessage(json){var _ref,_ref1;this.tidText=ko.observable((null!=(_ref=json.text)?_ref.substr((null!=(_ref1=json.text)?_ref1.indexOf("***"):void 0)+3):void 0).trim()),this.showingTransactionDetails=ko.observable(!1)}return GatewayExceptionMessage.prototype.showTransactionDetails=function(){return this.showingTransactionDetails(!0)},GatewayExceptionMessage}(),showUnavailableMessage=_.throttle(function(){return console.log("-> MessageUtils -> showUnavailableMessage"),$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/addMessage.vtex",{type:"fatal",modalTemplate:".unavailable-modal",id:"unavailable-message-modal"})},2e4,{trailing:!1}),MessageUtils=function(){function MessageUtils(){}return MessageUtils.messages=new window.vtex.Messages.getInstance,MessageUtils.showUnavailableMessage=function(){return showUnavailableMessage()},MessageUtils.showEmailMessage=function(){return console.log("-> MessageUtils -> showEmailMessage"),$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/addMessage.vtex",{type:"fatal",modalTemplate:".modal-email-template",id:"email-message-modal"})},MessageUtils.showPaymentUnauthorizedMessage=function(message){var $paymentUnauthorized;return console.log("-> MessageUtils -> showPaymentUnauthorizedMessage"),null!=message&&($paymentUnauthorized=$(".payment-unauthorized-modal")[0],message=new GatewayExceptionMessage(message),ko.cleanNode($paymentUnauthorized),ko.applyBindings(message,$paymentUnauthorized)),$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/addMessage.vtex",{type:"fatal",modalTemplate:".modal-payment-unauthorized-template",id:"payment-unauthorized-modal"})},MessageUtils.showMaskedInfoMessage=function(){return console.log("-> MessageUtils -> showMaskedInfoMessage"),$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/addMessage.vtex",{type:"fatal",modalTemplate:".modal-masked-info-template",id:"masked-info-modal"})},MessageUtils.showPaymentMessage=function(){return console.log("-> MessageUtils -> showPaymentMessage"),$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/addMessage.vtex",{type:"fatal",modalTemplate:".modal-payment-template",id:"payment-message-modal"})},MessageUtils.hidePaymentMessage=function(){return console.log("-> MessageUtils -> hidePaymentMessage"),$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/removeMessage.vtex","payment-message-modal")},MessageUtils.showGuestLoginMessage=function(){return console.log("-> MessageUtils -> showGuestLoginMessage"),$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/addMessage.vtex",{type:"fatal",modalTemplate:".guest-login-modal",id:"guest-login-modal"})},MessageUtils.hideGuestLoginMessage=function(){return console.log("-> MessageUtils -> hideGuestLoginMessage"),$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/removeMessage.vtex","guest-login-modal")},MessageUtils.messageFromAPIMessage=function(messageFromAPI){var html;return html="fatal"===messageFromAPI.status?!0:!1,{type:messageFromAPI.status,content:{detail:messageFromAPI.text,html:html},close:i18n.t("global.close")}},MessageUtils.showMessagesFromOrderForm=function(messagesJSON){var authorizationErrorCodes,ignoredMessageCodes,message,_i,_len,_ref,_ref1;for(ignoredMessageCodes=["cannotBeDelivered","unavailableItemFulfillment","withoutPrice","withoutPriceRnB","nullPrice"],authorizationErrorCodes=["transactionMissingRequestData","transactionInvalidRequiredParameter","transactionUnauthorized","transactionAuthorizationDenied","transactionNotApproved","transactionAnalyzingRisk","transactionInRiskAnalysis","transactionCannotBeSettled","transactionRejectedByAntifraud","transactionAuthenticationFailed","transactionAuthorizationDeniedWithoutCause","transactionInvalidRequest","gatewayServiceTimeout","gatewayCommunicationError","paymentUnauthorized","paymentPending"],_i=0,_len=messagesJSON.length;_len>_i;_i++)message=messagesJSON[_i],_ref=message.code,__indexOf.call(authorizationErrorCodes,_ref)>=0?this.showPaymentUnauthorizedMessage(message):(_ref1=message.code,__indexOf.call(ignoredMessageCodes,_ref1)<0&&MessageUtils.showMessage(message));return messagesJSON.length>0?API.clearMessages():void 0},MessageUtils.showMessage=function(message){return console.log("-> MessageUtils -> showMessage"),$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/addMessage.vtex",MessageUtils.messageFromAPIMessage(message))},MessageUtils.clear=function(index){return void 0!==index?MessageUtils.messages.messagesArray.splice(index,1):API.clearMessages()},MessageUtils}.call(this),window.vtex.checkout.MessageUtils=MessageUtils,$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/showMessage.vtex",function(ev,message){var capitalizedMessageId,showMesssageFunction,_base;if(message)return capitalizedMessageId=message.charAt(0).toUpperCase()+message.slice(1),showMesssageFunction="show"+capitalizedMessageId+"Message","function"==typeof(_base=window.vtex.checkout.MessageUtils)[showMesssageFunction]?_base[showMesssageFunction]():void 0}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/ajaxRetry.vtex",function(ev,request){return window.logSplunk&&window.logSplunk({level:"Info",type:"Debug",workflowType:"checkout-ui",workflowInstance:"request-retry",event:{details:null!=request?request.responseText:void 0,status:null!=request?request.status:void 0},account:vtex.accountName})}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/ajaxError.vtex",function(ev,request){var globalError,hasStatusCodesToLog,responseObj,_ref;return hasStatusCodesToLog=500===(null!=request?request.status:void 0)||503===(null!=request?request.status:void 0),(null!=request?request.responseText:void 0)&&(responseObj=JSON.parse(request.responseText)),hasStatusCodesToLog?(window.logSplunk&&window.logSplunk({level:"Critical",type:"Error",workflowType:"checkout-ui",workflowInstance:"request-retry-fail",event:{details:null!=request?request.responseText:void 0,status:request.status},account:vtex.accountName}),globalError=""+window.i18n.t("global.error")+'\n<small class="vtex-operation-id-container">\n	(Operation ID <span class="vtex-operation-id">'+(null!=responseObj?responseObj.operationId:void 0)+"</span>)\n</small>",$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/addMessage.vtex",{type:"fatal",content:{title:globalError,detail:null!=responseObj&&null!=(_ref=responseObj.error)?_ref.message:void 0,html:!0},close:window.i18n.t("global.close")})):void 0})}.call(this),function(){var CartViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};CartViewModel=function(){function CartViewModel(checkoutModel){this.afterRenderMiniCart=__bind(this.afterRenderMiniCart,this),this.afterCartRender=__bind(this.afterCartRender,this),this.removeUnavailableProducts=__bind(this.removeUnavailableProducts,this),this.itemSubmitHandler=__bind(this.itemSubmitHandler,this),this.parseOrderFormResponse=__bind(this.parseOrderFormResponse,this),this.handleItemLoading=__bind(this.handleItemLoading,this),this.showMore=__bind(this.showMore,this);var _this=this;this.itemsToShow=ko.observable(20),this.allowManualPrice=ko.observable(!1),this.itemsAndGifts=ko.observableArray([]),this.logisticsInfo=ko.observableArray([]),this.orderFormItems=ko.observableArray([]),this.rateAndBenefitsIdentifiers=ko.observableArray([]),this.translateCart=_.debounce(function(){return vtex.i18n.translateHtml($(".full-cart .cart-items tbody"))},300),this.translateMiniCart=_.debounce(function(){return vtex.i18n.translateHtml($(".mini-cart .cart-items"))},300),this._items=ko.observableArray([]),this.items=ko.computed({read:function(){return _this._items()},write:function(value){return _this._items(value)}}),this.items(_.filter(this.itemsAndGifts(),function(i){return!i.isGift.peek()})),this._filteredItems=ko.observableArray([]),this.filteredItems=ko.computed({read:function(){return _this._filteredItems()},write:function(value){return _this._filteredItems(value)}}),this.gifts=ko.computed(function(){return _.filter(_this.itemsAndGifts(),function(i){return i.isGift.peek()})}),this.hasItems=ko.computed(function(){return _this.items().length>0||_this.filteredItems().length>0}).extend({throttle:100}),this.showShowMoreButton=ko.computed(function(){return _.filter(_this.orderFormItems(),function(i){return i.isGift===!1}).length>=_this.itemsToShow()}).extend({throttle:100}),this.hasItemsAndIsInCart=ko.computed(function(){var isInCart,_ref;return isInCart=(null!=(_ref=window.router)&&"function"==typeof _ref.inCart?_ref.inCart():void 0)?window.router.inCart():!1,_this.hasItems()&&isInCart}),this.availableItems=ko.computed(function(){return _this.items().length>0?_.filter(_this.items(),function(i){return i.available.peek()}):_.filter(_this.filteredItems(),function(i){return i.available})}),this.unavailableItems=ko.computed(function(){return _this.items().length>0?_.filter(_this.items(),function(i){return!i.available.peek()}):_.filter(_this.filteredItems(),function(i){return!i.available})}),this.unavailableItemsCannotBeDelivered=ko.computed(function(){return _.all(_this.unavailableItems(),function(i){return i.unavailableForDelivery.peek()})}),this.loading=checkoutModel.loading,this.loadingItem=ko.observable(!1),this.multipleItems=ko.observable(!1),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/orderFormUpdated.vtex",function(e,orderForm){return _this.parseOrderFormResponse(orderForm)}),radio("checkout.item.submit").subscribe(this.itemSubmitHandler),radio("checkout.cart.loadingItem").subscribe(this.handleItemLoading),this.availableOrdinationOptions=ko.computed(function(){return checkout.locale(),[ordinationOption("add_time",!0),ordinationOption("add_time",!1),ordinationOption("name",!0),ordinationOption("name",!1)]}),this.selectedOrdination=ko.observable(),this.currentOrdination=ko.observable(),this.selectedOrdination.subscribe(function(value){return null==value||null==_this.currentOrdination()||value.criteria===_this.currentOrdination().criteria&&value.ascending===_this.currentOrdination().ascending?void 0:API.changeItemsOrdination(value.criteria,value.ascending)}),this.isSACModeActive=ko.observable(!1),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/SACModeChange.vtex",function(e,isActive){return _this.isSACModeActive(isActive)})}var ordinationOption;return CartViewModel.prototype.showMore=function(){var chunk,chunkSize,chunks,filteredItems,items,tempItemsToShow,_i,_len,_results,_this=this;for(tempItemsToShow=this.itemsToShow(),this.itemsToShow(this.itemsToShow()+30),filteredItems=_.filter(this.orderFormItems(),function(item,index){return index<=_this.itemsToShow()-1}),_.map(filteredItems,function(item,index){return index>tempItemsToShow-1?_this.itemsAndGifts.push(new vtex.checkout.ItemViewModel(item,index,_this.rateAndBenefitsIdentifiers(),_this.logisticsInfo(),_this.isSACModeActive)):void 0}),items=_.filter(this.itemsAndGifts(),function(i){return!i.isGift.peek()}),this.filteredItems(_.filter(this.itemsAndGifts(),function(i,index){return!i.isGift.peek()&&index+1<=_this.itemsToShow()})),items.length>20?(chunkSize=10,chunks=_.chain(items).groupBy(function(element,index){return Math.floor(index/chunkSize)}).toArray().map(function(chunk){return function(){var tempItems;return tempItems=_this.items(),tempItems=tempItems.concat(chunk),_this.items(tempItems)}}).value(),[function(){return _this.items()}].concat(chunks)):chunks=[function(){return _this.items(items)}],_results=[],_i=0,_len=chunks.length;_len>_i;_i++)chunk=chunks[_i],window.requestIdleCallback?_results.push(requestIdleCallback(chunk)):window.requestAnimationFrame?_results.push(requestAnimationFrame(chunk)):_results.push(setTimeout(chunk,300));return _results},CartViewModel.prototype.handleItemsOrdination=function(orderForm){var _ref,_ref1;if(this.currentOrdination((null!=orderForm?orderForm.itemsOrdination:void 0)||{criteria:"add_time",ascending:!0}),(null!=(_ref=this.selectedOrdination())?_ref.criteria:void 0)!==this.currentOrdination().criteria||(null!=(_ref1=this.selectedOrdination())?_ref1.ascending:void 0)!==this.currentOrdination().ascending){if("add_time"===this.currentOrdination().criteria&&this.currentOrdination().ascending===!0)return this.selectedOrdination(this.availableOrdinationOptions()[0]);if("add_time"===this.currentOrdination().criteria&&this.currentOrdination().ascending===!1)return this.selectedOrdination(this.availableOrdinationOptions()[1]);if("name"===this.currentOrdination().criteria&&this.currentOrdination().ascending===!0)return this.selectedOrdination(this.availableOrdinationOptions()[2]);if("name"===this.currentOrdination().criteria&&this.currentOrdination().ascending===!1)return this.selectedOrdination(this.availableOrdinationOptions()[3])}},CartViewModel.prototype.handleItemLoading=function(loading){return this.loadingItem(loading)},CartViewModel.prototype.parseOrderFormResponse=function(orderForm){var chunk,chunkSize,chunks,filteredItems,item,items,seller,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2,_ref3,_ref4,_results,_this=this;if(null!=orderForm.items){for((null!=orderForm&&null!=(_ref=orderForm.items)?_ref.length:void 0)>1?this.multipleItems(!0):this.multipleItems(!1),this.handleItemsOrdination(orderForm),this.allowManualPrice(orderForm.allowManualPrice),this.loadingItem(!1),_ref1=this.itemsAndGifts.removeAll(),_i=0,_len=_ref1.length;_len>_i;_i++)item=_ref1[_i],item.dispose();for(this.orderFormItems(orderForm.items),this.rateAndBenefitsIdentifiers(null!=(_ref2=orderForm.ratesAndBenefitsData)?_ref2.rateAndBenefitsIdentifiers:void 0),this.logisticsInfo(null!=(_ref3=orderForm.shippingData)?_ref3.logisticsInfo:void 0),filteredItems=_.filter(orderForm.items,function(item,index){return index<=_this.itemsToShow()-1}),this.itemsAndGifts(_.map(filteredItems,function(item,index){var _ref4,_ref5;return new vtex.checkout.ItemViewModel(item,index,null!=(_ref4=orderForm.ratesAndBenefitsData)?_ref4.rateAndBenefitsIdentifiers:void 0,null!=(_ref5=orderForm.shippingData)?_ref5.logisticsInfo:void 0,_this.isSACModeActive)})),items=_.filter(this.itemsAndGifts(),function(i){return!i.isGift.peek()}),items.length>20?(chunkSize=10,chunks=_.chain(items).groupBy(function(element,index){return Math.floor(index/chunkSize)}).toArray().map(function(chunk){return function(){var tempItems;return tempItems=_this.items(),tempItems=tempItems.concat(chunk),_this.items(tempItems)}}).value(),[function(){return _this.items()}].concat(chunks)):chunks=[function(){return _this.items(items)}],this.filteredItems(_.filter(this.itemsAndGifts(),function(i){return!i.isGift.peek()})),_j=0,_len1=chunks.length;_len1>_j;_j++)chunk=chunks[_j],window.requestIdleCallback?requestIdleCallback(chunk):window.requestAnimationFrame?requestAnimationFrame(chunk):setTimeout(chunk,300);if(orderForm.sellers){for(_ref4=orderForm.sellers,_results=[],_k=0,_len2=_ref4.length;_len2>_k;_k++)seller=_ref4[_k],_results.push(radio("checkout.sellers.create").broadcast(seller));return _results}}},CartViewModel.prototype.itemSubmitHandler=function(item){return item&&0===item.quantity&&(this.items().splice(item.index,1),this.items.notifySubscribers()),API.updateItems([item],null,item.hasBundleItems)},CartViewModel.prototype.removeUnavailableProducts=function(){var promiseForItemRemove,unavailableItems;return unavailableItems=_.map(ko.toJS(this.unavailableItems()),function(i){return _.pick(i,"index","quantity","sellerId")}),promiseForItemRemove=API.removeItems(unavailableItems),promiseForItemRemove.done(function(){return router.setHash("orderform")}),_.map(this.unavailableItems(),function(item){var _ref;return null!=(_ref=window.vtex.checkout.analytics)?_ref.removeFromCart(item.toJSON()):void 0})},ordinationOption=function(criteria,ascending){var ordination;return ordination={criteria:criteria,ascending:ascending},"add_time"===ordination.criteria&&ordination.ascending===!0?ordination.text=i18n.t("orderBy.addTimeAsc"):"add_time"===ordination.criteria&&ordination.ascending===!1?ordination.text=i18n.t("orderBy.addTimeDesc"):"name"===ordination.criteria&&ordination.ascending===!0?ordination.text=i18n.t("orderBy.nameAsc"):"name"===ordination.criteria&&ordination.ascending===!1&&(ordination.text=i18n.t("orderBy.nameDesc")),ordination},CartViewModel.prototype.afterCartRender=function(){return this.translateCart()},CartViewModel.prototype.afterRenderMiniCart=function(){return this.translateMiniCart()},CartViewModel}(),vtex.checkout.CartViewModel=CartViewModel}.call(this),function(){var ItemAttachmentViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};ItemAttachmentViewModel=function(){function ItemAttachmentViewModel(parent,name,schema,isRequired){this.dispose=__bind(this.dispose,this),this.update=__bind(this.update,this);var defaultValue,hasJustOneOption,isBooleanValue,isSubscriptionAttachment,numberPeriodRegex,options,today,wordlyPeriodRegex,_ref,_this=this;this.name=name,this.nameSlug=_.sanitize(_.spacesToHyphens(name)).replace(/[^-A-z0-9]/,"").toLowerCase(),isSubscriptionAttachment=name&&0===name.indexOf("vtex.subscription"),isSubscriptionAttachment?(this.label=i18n.t(name.replace("vtex.","")),numberPeriodRegex=/([\d]{1,3}) ([A-z]{1,50})/,wordlyPeriodRegex=/([A-z]{1,50})/,this.options=_.map(schema.domain,function(option){var label,result;return numberPeriodRegex.test(option)?(result=numberPeriodRegex.exec(option),label=i18n.t("subscription.periodicity."+result[2],{count:parseInt(result[1],10),defaultValue:option})):wordlyPeriodRegex.test(option)?(result=wordlyPeriodRegex.exec(option),label=i18n.t("subscription.periodicity."+result[1],{defaultValue:option})):label=option,{label:label,value:option}})):(this.label=name,options=_.map(schema.domain||[],function(option){return{label:option,value:option}}),this.options=ko.observableArray(options)),this.maxLength=ko.observable(schema.maxLength||schema.maximumNumberOfCharacters||150),this.domain=schema.domain||[],today=new Date,this.minDate=today.getFullYear()+"-"+_.padStr(today.getMonth(),2,"0")+"-"+_.padStr(today.getDate(),2,"0"),this.isBooleanValue=function(domain){return domain&&2===domain.length&&_.contains(domain,"true")&&_.contains(domain,"false")},hasJustOneOption=1===(null!=(_ref=schema.domain)?_ref.length:void 0),isBooleanValue=this.isBooleanValue(schema.domain),defaultValue="",hasJustOneOption?defaultValue=schema.domain[0]:isBooleanValue&&(defaultValue="false"),this.value=ko.observable(defaultValue),this.oldValue=ko.observable(hasJustOneOption?null:defaultValue),this.isUsingAttachment=ko.observable(isRequired?!0:!1),this.disposables=[this.inputClass=ko.computed(function(){return"vtex.subscription.key.validity.begin"===_this.name||"https://io.vtex.com.br/checkout-ui/5.16.7/script/vtex.subscription.key.validity.end"===_this.name?"input-medium":_this.maxLength()<6?"input-micro":_this.maxLength()<10?"input-mini":_this.maxLength()<18?"input-small":_this.maxLength()<29?"input-medium":_this.maxLength()<60?"input-large":void 0}),this.inputType=ko.computed(function(){var domain;return domain=_this.domain,"vtex.subscription.key.validity.begin"===_this.name||"https://io.vtex.com.br/checkout-ui/5.16.7/script/vtex.subscription.key.validity.end"===_this.name?"date":1===domain.length?"fixed":isBooleanValue?"checkbox":domain.length>0?"select":_this.maxLength()<60?"text":"textarea"}),this.charsTyped=ko.computed(function(){return null!=_this.value()?_this.value().length:0}),this.value.subscribe(function(value){var typesThatDoesntCallSaveOnBlur,_ref1;return typesThatDoesntCallSaveOnBlur=["select","checkbox"],_ref1=_this.inputType(),__indexOf.call(typesThatDoesntCallSaveOnBlur,_ref1)>=0&&_this.isUsingAttachment()?_this.save():void 0})],this.booleanValue=ko.computed({read:function(){return"true"===_this.value()?!0:!1},write:function(value){return value===!0?_this.value("true"):_this.value("false")}}),this.save=_.debounce(function(){return _this.value()!==_this.oldValue()?(_this.oldValue(_this.value()),parent.saveAttachment()):void 0},500),this.changedToUsingAttachment=ko.computed(function(){return _this.isUsingAttachment()&&hasJustOneOption?_this.save():void 0})}return ItemAttachmentViewModel.prototype.update=function(value){return this.oldValue(value),this.value(value)},ItemAttachmentViewModel.prototype.dispose=function(){var disposable,_i,_len,_ref,_results;
for(_ref=this.disposables,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)disposable=_ref[_i],_results.push(disposable.dispose());return _results},ItemAttachmentViewModel}(),vtex.checkout.ItemAttachmentViewModel=ItemAttachmentViewModel}.call(this),function(){var ItemAttachmentListViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};ItemAttachmentListViewModel=function(){function ItemAttachmentListViewModel(itemIndex,bundleItemId){this.handleFail=__bind(this.handleFail,this),this.bundleLoading=__bind(this.bundleLoading,this),this.itemLoading=__bind(this.itemLoading,this),this.removeOfferingAttachmentHandler=__bind(this.removeOfferingAttachmentHandler,this),this.saveOfferingAttachmentHandler=__bind(this.saveOfferingAttachmentHandler,this),this.removeItemAttachmentHandler=__bind(this.removeItemAttachmentHandler,this),this.saveItemAttachmentHandler=__bind(this.saveItemAttachmentHandler,this),this.setLoading=__bind(this.setLoading,this),this.removeSubscriptionsData=__bind(this.removeSubscriptionsData,this),this.saveSubscriptionsData=__bind(this.saveSubscriptionsData,this),this.removeAttachment=__bind(this.removeAttachment,this),this.saveAttachment=__bind(this.saveAttachment,this),this.getContent=__bind(this.getContent,this),this.update=__bind(this.update,this),this.writeValue=__bind(this.writeValue,this),this.dispose=__bind(this.dispose,this),this.clearChildrenViewModels=__bind(this.clearChildrenViewModels,this);var _this=this;this.itemIndex=itemIndex,this.bundleItemId=bundleItemId,this.label="",this.isSubscriptionAttachment=!1,this.name=ko.observable(),this.nameSlug=ko.observable(),this.required=ko.observable(),this.itemAttachments=ko.observableArray([]),this.isUsingAttachment=ko.observable(!1),this.disposables=[this.setIsUsingAttachmentOnChild=ko.computed(function(){var att,isUsing,_i,_len,_ref,_results;for(isUsing=_this.isUsingAttachment(),_ref=_this.itemAttachments(),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)att=_ref[_i],_results.push(att.isUsingAttachment(isUsing));return _results}),this.giftMessageId=ko.computed(function(){return _this.itemIndex+_this.name()}),this.showRemoveAttachment=ko.computed(function(){return!window.cart.loadingItem()&&!_this.required()})],this.giftMessageAttachment=ko.observable(),this.isSaved=ko.observable(!1),this.loading=ko.observable(!1),radio("checkout.offering.loading").subscribe(this.setLoading)}return ItemAttachmentListViewModel.prototype.clearChildrenViewModels=function(){var item,_i,_len,_ref,_results;for(_ref=this.itemAttachments.removeAll(),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)item=_ref[_i],_results.push(item.dispose());return _results},ItemAttachmentListViewModel.prototype.dispose=function(){var disposable,_i,_len,_ref,_results;for(this.clearChildrenViewModels(),radio("checkout.offering.loading").unsubscribe(this.setLoading),_ref=this.disposables,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)disposable=_ref[_i],_results.push(disposable.dispose());return _results},ItemAttachmentListViewModel.prototype.writeValue=function(){return this.isUsingAttachment(!0),$("#gift-message-"+this.giftMessageId()).focus()},ItemAttachmentListViewModel.prototype.update=function(itemAttachmentOffering,attachment){var attachmentName,content,isRequired,item,itemAttachment,schema,tempItemAttachments,value,_i,_len,_ref,_ref1;for(this.isSubscriptionAttachment=0===itemAttachmentOffering.name.indexOf("vtex.subscription"),this.isSubscriptionAttachment?this.label=i18n.t("subscription.subscription"):this.label=itemAttachmentOffering.name,this.name(itemAttachmentOffering.name),this.nameSlug(_.sanitize(_.spacesToHyphens(itemAttachmentOffering.name)).toLowerCase()),isRequired=itemAttachmentOffering.required,this.required(isRequired),this.itemAttachments.removeAll(),isRequired&&this.isUsingAttachment(!0),_ref=this.itemAttachments.removeAll(),_i=0,_len=_ref.length;_len>_i;_i++)item=_ref[_i],item.dispose();tempItemAttachments=[],_ref1=itemAttachmentOffering.schema;for(attachmentName in _ref1)schema=_ref1[attachmentName],itemAttachment=new vtex.checkout.ItemAttachmentViewModel(this,attachmentName,schema),tempItemAttachments.push(itemAttachment);if(this.itemAttachments(tempItemAttachments),attachment){content=attachment.content;for(attachmentName in content)value=content[attachmentName],null!=value&&""!==value&&(this.isUsingAttachment(!0),this.isSaved(!0)),itemAttachment=_.find(this.itemAttachments(),function(att){return att.name===attachmentName}),itemAttachment&&itemAttachment.update(value)}return"message"===this.name()?this.giftMessageAttachment(_.find(this.itemAttachments(),function(att){return"text"===att.name})):void 0},ItemAttachmentListViewModel.prototype.getContent=function(){var data,itemAtt,_i,_len,_ref;for(data={},_ref=this.itemAttachments(),_i=0,_len=_ref.length;_len>_i;_i++)itemAtt=_ref[_i],data[itemAtt.name]=itemAtt.value();return data},ItemAttachmentListViewModel.prototype.saveAttachment=function(){var data,request,_this=this;if(this.isUsingAttachment()!==!1)return data=this.getContent(),this.isSaved()&&_.all(data,function(v){return""===v})?this.removeAttachment(data):(request=this.bundleItemId?this.saveOfferingAttachmentHandler(this.itemIndex,this.bundleItemId,this.name(),data):this.saveItemAttachmentHandler(this.itemIndex,this.name(),data),this.isSubscriptionAttachment&&(request=request.done(function(orderForm){return _this.saveSubscriptionsData(orderForm,_this.itemIndex,data)})),request.done(function(){return _this.isSaved(!0)}))},ItemAttachmentListViewModel.prototype.removeAttachment=function(){var data,request,_this=this;return data=this.getContent(),this.isUsingAttachment(!1),this.isSaved()?(request=this.bundleItemId?this.removeOfferingAttachmentHandler(this.itemIndex,this.bundleItemId,this.name(),data):this.removeItemAttachmentHandler(this.itemIndex,this.name(),data),this.isSubscriptionAttachment&&(request=request.done(function(orderForm){return _this.removeSubscriptionsData(orderForm,_this.itemIndex,data)})),request.done(function(){var itemAtt,_i,_len,_ref,_results;for(_this.isSaved(!1),_ref=_this.itemAttachments(),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)itemAtt=_ref[_i],_results.push(itemAtt.value(""));return _results})):void 0},ItemAttachmentListViewModel.prototype.saveSubscriptionsData=function(orderForm,itemIndex,data){var isUpdating,newSubscriptions,previousSubscriptions,xhr,_ref,_ref1,_this=this;return this.itemLoading(itemIndex,!0),previousSubscriptions=null!=(_ref=null!=(_ref1=orderForm.subscriptionData)?_ref1.subscriptions:void 0)?_ref:[],isUpdating=_.find(previousSubscriptions,function(sub){return sub.itemIndex===itemIndex}),newSubscriptions=isUpdating?previousSubscriptions.map(function(sub){return sub.itemIndex===itemIndex?{itemIndex:itemIndex,plan:_this.createSubscriptionPlan(data)}:sub}):previousSubscriptions.concat({itemIndex:itemIndex,plan:this.createSubscriptionPlan(data)}),xhr=API.sendAttachment("subscriptionData",{subscriptions:newSubscriptions}),xhr.fail(function(response){return _this.handleFail(response.messages,itemIndex)}),xhr.always(function(){return _this.itemLoading(itemIndex,!1)})},ItemAttachmentListViewModel.prototype.createSubscriptionPlan=function(data){var frequency,validity;return frequency=this.createFrequency(data),frequency&&(validity=this.createValidity(data))?{frequency:frequency,validity:validity,type:"RECURRING_PAYMENT"}:void 0},ItemAttachmentListViewModel.prototype.createFrequency=function(data){var frequency,interval,numberPeriodRegex,periodicity,result,wordlyPeriodRegex;if(!data["vtex.subscription.key.frequency"])return void console.warn('Subscription attachment is missing "vtex.subscription.key.frequency" field');if(frequency=data["vtex.subscription.key.frequency"].trim(),numberPeriodRegex=/([\d]{1,3}) ([A-z]{1,50})/,wordlyPeriodRegex=/([A-z]{1,50})/,numberPeriodRegex.test(frequency))result=numberPeriodRegex.exec(frequency),interval=parseInt(result[1],10),periodicity=result[2].toUpperCase();else{if(!wordlyPeriodRegex.test(frequency))return void console.warn('Subscription field "vtex.subscription.key.frequency" has an invalid option');interval=1,periodicity=result[1].toUpperCase()}return{interval:interval,periodicity:periodicity}},ItemAttachmentListViewModel.prototype.createValidity=function(data){var YEARS_FORWARD,begin,end,today;return today=new Date,begin=data["vtex.subscription.key.validity.begin"]?data["vtex.subscription.key.validity.begin"]:today.getFullYear()+"-"+_.padStr(today.getMonth()+1,2,"0")+"-"+_.padStr(today.getDate(),2,"0"),data["https://io.vtex.com.br/checkout-ui/5.16.7/script/vtex.subscription.key.validity.end"]?end=data["https://io.vtex.com.br/checkout-ui/5.16.7/script/vtex.subscription.key.validity.end"]:(YEARS_FORWARD=3,end=today.getFullYear()+YEARS_FORWARD+"-"+_.padStr(today.getMonth()+1,2,"0")+"-"+_.padStr(today.getDate(),2,"0")),{begin:begin,end:end}},ItemAttachmentListViewModel.prototype.removeSubscriptionsData=function(orderForm,itemIndex,data){var newSubscriptions,previousSubscriptions,xhr,_ref,_ref1,_this=this;return this.itemLoading(itemIndex,!0),previousSubscriptions=null!=(_ref=null!=(_ref1=orderForm.subscriptionData)?_ref1.subscriptions:void 0)?_ref:[],newSubscriptions=_.reduce(previousSubscriptions,function(acc,sub){return sub.itemIndex===itemIndex?acc:acc.concat(sub)},[]),xhr=API.sendAttachment("subscriptionData",{subscriptions:newSubscriptions}),xhr.fail(function(response){return _this.handleFail(response.messages,itemIndex)}),xhr.always(function(){return _this.itemLoading(itemIndex,!1)})},ItemAttachmentListViewModel.prototype.setLoading=function(itemIndex,id,flag){return itemIndex===this.itemIndex&&id===this.bundleItemId?this.loading(flag):void 0},ItemAttachmentListViewModel.prototype.saveItemAttachmentHandler=function(itemIndex,attachmentName,attachment){var xhr,_this=this;return this.itemLoading(itemIndex,!0),xhr=API.addItemAttachment(itemIndex,attachmentName,attachment,null,!1),xhr.fail(function(data){return _this.handleFail(data.messages,itemIndex)}),xhr.always(function(){return _this.itemLoading(itemIndex,!1)})},ItemAttachmentListViewModel.prototype.removeItemAttachmentHandler=function(itemIndex,attachmentName,attachment){var xhr,_this=this;return this.itemLoading(itemIndex,!0),xhr=API.removeItemAttachment(itemIndex,attachmentName,attachment),xhr.fail(function(data){return _this.handleFail(data.messages,itemIndex)}),xhr.always(function(){return _this.itemLoading(itemIndex,!1)})},ItemAttachmentListViewModel.prototype.saveOfferingAttachmentHandler=function(itemIndex,bundleItemId,attachmentName,attachment){var xhr,_this=this;return this.bundleLoading(itemIndex,bundleItemId,!0),xhr=API.addBundleItemAttachment(itemIndex,bundleItemId,attachmentName,attachment),xhr.fail(function(data){return _this.handleFail(data.messages,itemIndex,bundleItemId)}),xhr.always(function(){return _this.bundleLoading(itemIndex,bundleItemId,!1)})},ItemAttachmentListViewModel.prototype.removeOfferingAttachmentHandler=function(itemIndex,bundleItemId,attachmentName,attachment){var xhr,_this=this;return this.bundleLoading(itemIndex,bundleItemId,!0),xhr=API.removeBundleItemAttachment(itemIndex,bundleItemId,attachmentName,attachment),xhr.fail(function(data){return _this.handleFail(data.messages,itemIndex,bundleItemId)}),xhr.always(function(){return _this.bundleLoading(itemIndex,bundleItemId,!1)})},ItemAttachmentListViewModel.prototype.itemLoading=function(itemIndex,active){return radio("checkout.item.loading").broadcast(itemIndex,active)},ItemAttachmentListViewModel.prototype.bundleLoading=function(itemIndex,bundleItemId,active){return radio("checkout.offering.loading").broadcast(itemIndex,bundleItemId,active)},ItemAttachmentListViewModel.prototype.handleFail=function(messages,itemIndex,bundleItemId){return messages&&vtex.checkout.MessageUtils.showMessagesFromOrderForm(messages),bundleItemId?radio("https://io.vtex.com.br/checkout-ui/5.16.7/script/checkout.offering.fail").broadcast(itemIndex,bundleItemId):radio("https://io.vtex.com.br/checkout-ui/5.16.7/script/checkout.item.fail").broadcast(itemIndex)},ItemAttachmentListViewModel}(),vtex.checkout.ItemAttachmentListViewModel=ItemAttachmentListViewModel}.call(this),function(){var SlaViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};SlaViewModel=function(){function SlaViewModel(json){this.validateSlaFunction=__bind(this.validateSlaFunction,this),this.getPickadateSelectedDate=__bind(this.getPickadateSelectedDate,this),this.getPickadateOptions=__bind(this.getPickadateOptions,this),this.dateChangedHandler=__bind(this.dateChangedHandler,this),this.update=__bind(this.update,this),this.updateLabelsAndPriceProperties=__bind(this.updateLabelsAndPriceProperties,this);var _this=this;this.name="",this.id="",this.price=0,this.summedPrice=null,this.shippingEstimate=0,this.maxShippingEstimate=void 0,this.availableDeliveryWindows=[],this.tax=0,this.summedTaxes=null,this.pickupStoreInfo=null,this.pickupPointName=null,this.deliveryChannel=null,this.selectedDeliveryDate=ko.observable(),this.deliveryWindowIndex=ko.observable(null),this.deliveryWindow=function(){return _this.availableDeliveryWindows[_this.deliveryWindowIndex()]},this.maxEstimateOptionText=ko.observable(null),this.valueEstimateLabel=ko.observable(null),this.maxEstimateLabel="",this.exactEstimateLabel="",this.deliveryWindowsForDate=ko.computed(function(){var deliveryDate;return deliveryDate=_this.selectedDeliveryDate(),_(_this.availableDeliveryWindows).filter(function(dw){return dw.dateString===SlaViewModel.dateToDateString(deliveryDate)})}),this.deliveryWindowIndex.subscribe(function(dwIndex){var dw,valueLabel;return dw=_this.availableDeliveryWindows[dwIndex],valueLabel=_.intAsCurrency(dw.price+_this.price),_this.maxEstimateOptionText((_this.pickupPointName||_this.name)+" - "+valueLabel+" - "+_.dateFormat(dw.endDate)),_this.updateLabelsAndPriceProperties()}),this.formatDate=function(date){var day,month,year;return year=date.getFullYear(),month=date.getMonth()+1,day=date.getDate(),10>month&&(month="0"+month),"en"===window.vtex.i18n.getLocale()?month+"/"+day+"/"+year:day+"/"+month+"/"+year},this.update(json)}return SlaViewModel.prototype.updateLabelsAndPriceProperties=function(){var cheapestValue,earliestDate,firstDate,from,isFree,maxTime,price,tax,time,_ref,_ref1;return price=null!=(_ref=this.summedPrice)?_ref:this.price,tax=null!=(_ref1=this.summedTaxes)?_ref1:this.tax,this.valueLabel=_.intAsCurrency(price),this.taxValueLabel=tax>0?_.intAsCurrency(tax):i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.free"),void 0===this.maxShippingEstimate||this.isScheduled||(maxTime=this.businessDays?i18n.t("shippingData.workingDay"+(this.maxShippingEstimate>1?"s":"")):this.hours?i18n.t("shippingData.hour"+(this.maxShippingEstimate>1?"s":"")):this.minutes?i18n.t("shippingData.minute"+(this.maxShippingEstimate>1?"s":"")):i18n.t("shippingData.day"+(this.maxShippingEstimate>1?"s":"")),this.maxEstimateLabel=i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/shippingData.upTo")+" ",this.maxEstimateLabel+=this.maxShippingEstimate+" "+maxTime,this.maxEstimateOptionText((this.pickupPointName||this.name)+" - "+this.valueLabel+" - "+this.maxEstimateLabel)),void 0!==this.shippingEstimate&&(time=this.businessDays?i18n.t("shippingData.workingDay"+(this.shippingEstimate>1?"s":"")):this.hours?i18n.t("shippingData.hour"+(this.shippingEstimate>1?"s":"")):this.minutes?i18n.t("shippingData.minute"+(this.shippingEstimate>1?"s":"")):i18n.t("shippingData.day"+(this.shippingEstimate>1?"s":"")),0===this.shippingEstimate?this.estimateLabel=i18n.t("shippingData.sameDay"):this.estimateLabel=this.shippingEstimate+" "+time),this.label=(this.pickupPointName||this.name)+" - "+this.valueLabel,this.valueEstimateLabel(this.valueLabel),this.isScheduled?(this.estimateLabel=i18n.t("shippingData.scheduled"),earliestDate=null,cheapestValue=Number.MAX_VALUE,isFree=!0,_(this.availableDeliveryWindows).each(function(dw,i){var objTranslation;if(dw.index=i,dw.startDate=SlaViewModel.fromApiDate(dw.startDateUtc),dw.endDate=SlaViewModel.fromApiDate(dw.endDateUtc),dw.dateAsArray=SlaViewModel.dateToDateArray(dw.startDate),dw.dateString=SlaViewModel.dateToDateString(dw.startDate),dw.value=dw.price+price,dw.value>0?(dw.valueLabel=_.intAsCurrency(dw.value),isFree=!1):dw.valueLabel=i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.free"),objTranslation={from:SlaViewModel.dateHourMinLabel(dw.startDate),to:SlaViewModel.dateHourMinLabel(dw.endDate)},dw.label=i18n.t("shippingData.fromToHour",objTranslation)+"  - "+dw.valueLabel,dw.timeLabel=i18n.t("shippingData.fromToHour",objTranslation),isNaN(dw.dateAsArray[0]))throw new Error("Datas de entrega agendada apresentam formato incorreto.");return cheapestValue=Math.min(dw.price+price,cheapestValue),null==earliestDate?earliestDate=dw.startDate:dw.startDate<earliestDate?earliestDate=dw.startDate:void 0}),firstDate=i18n.t("shippingData.firstDate"),from=i18n.t("shippingData.priceFrom"),isFree?this.maxEstimateOptionText((this.pickupPointName||this.name)+" - "+i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/global.free")+" - "+firstDate+" "+_.dateFormat(earliestDate)):this.maxEstimateOptionText((this.pickupPointName||this.name)+" - "+from+" "+_.intAsCurrency(cheapestValue)+" - "+firstDate+" "+_.dateFormat(earliestDate)),null===this.deliveryWindowIndex()?this.exactEstimateLabel=i18n.t("shippingData.toSchedule"):(this.exactEstimateLabel=_.dateFormat(this.deliveryWindow().endDate),this.label=(this.pickupPointName||this.name)+" - "+this.deliveryWindow().valueLabel,this.valueEstimateLabel(this.deliveryWindow().valueLabel))):this},SlaViewModel.prototype.update=function(serverJSON){var json,selectedDeliveryWindow,selectedDeliveryWindowIndex,_ref;return json=JSON.parse(JSON.stringify(serverJSON)),this.name=json.name,this.id=json.id,this.pickupStoreInfo=json.pickupStoreInfo,this.pickupPointName=null!=(_ref=json.pickupStoreInfo)?_ref.friendlyName:void 0,this.deliveryChannel=json.deliveryChannel,this.businessDays=void 0===json.businessDays?-1!==(json.shippingEstimate+"").indexOf("bd"):json.businessDays,this.hours=void 0===json.hours?-1!==(json.shippingEstimate+"").indexOf("h"):json.hours,this.minutes=void 0===json.minutes?-1!==(json.shippingEstimate+"").indexOf("m"):json.minutes,this.shippingEstimate=parseInt((json.shippingEstimate+"").replace(/bd|d/,""),10),this.price=json.price,this.tax=json.tax,this.availableDeliveryWindows=json.availableDeliveryWindows,this.isScheduled=this.availableDeliveryWindows&&this.availableDeliveryWindows.length>0,this.updateLabelsAndPriceProperties(),json.deliveryWindow&&(selectedDeliveryWindowIndex=null,_(this.availableDeliveryWindows).each(function(dw,i){var sdw;return sdw=json.deliveryWindow,dw.startDateUtc===sdw.startDateUtc&&dw.endDateUtc===sdw.endDateUtc?selectedDeliveryWindowIndex=i:void 0}),null!=selectedDeliveryWindowIndex&&(this.deliveryWindowIndex(selectedDeliveryWindowIndex),selectedDeliveryWindow=this.deliveryWindow(),selectedDeliveryWindow&&this.selectedDeliveryDate(selectedDeliveryWindow.startDate))),this},SlaViewModel.prototype.toJSON=function(){return{id:this.id,name:this.name,price:this.price,tax:this.tax,shippingEstimate:this.shippingEstimate,businessDays:this.businessDays,hours:this.hours,minutes:this.minutes,pickupStoreInfo:this.pickupStoreInfo,deliveryChannel:this.deliveryChannel,availableDeliveryWindows:_(this.availableDeliveryWindows).map(function(dw){return _(dw).pick("startDateUtc","endDateUtc","price","tax")}),deliveryWindow:this.deliveryWindow()}},SlaViewModel.prototype.dateChangedHandler=function(date){return date.setHours(0,0,0,0)!==this.selectedDeliveryDate().setHours(0,0,0,0)?(this.selectedDeliveryDate(date),this.deliveryWindowIndex(this.deliveryWindowsForDate()[0].index)):void 0},SlaViewModel.prototype.getPickadateOptions=function(){var deliveryDates,slatype;return deliveryDates=[],_.each(this.availableDeliveryWindows,function(dw){var dateAsArray;return dateAsArray=dw.dateAsArray,_.find(deliveryDates,function(d){return d[0]===dateAsArray[0]&&d[1]===dateAsArray[1]&&d[2]===dateAsArray[2]})?void 0:deliveryDates.push(dateAsArray)}),slatype=this,{datesDisabled:[!0].concat(deliveryDates),onSelect:function(){return slatype.dateChangedHandler(this.getDate(!0))}}},SlaViewModel.prototype.getPickadateSelectedDate=function(){return SlaViewModel.dateToDateArray(this.selectedDeliveryDate())},SlaViewModel.prototype.validateSlaFunction=function(value,element){var validation;return validation={result:!1,message:""},this.selectedDeliveryDate.peek()?(validation.applyErrorClass=validation.showErrorMessage=!1,validation.result=!0):(validation.message=i18n.t("shippingData.chooseScheduledDate"),validation.applyErrorClass=validation.showErrorMessage=!0,router.inOrderForm()&&(validation.giveFocus=!0),validation.result=!1),validation},SlaViewModel.dateToDateArray=function(date){return date?[date.getUTCFullYear(),date.getUTCMonth()+1,date.getUTCDate()]:void 0},SlaViewModel.dateToDateString=function(date){return date?date.getUTCFullYear()+"-"+(date.getUTCMonth()+1)+"-"+date.getUTCDate():void 0},SlaViewModel.dateHourMinLabel=function(date){return date?_.pad(date.getUTCHours(),2)+":"+_.pad(date.getUTCMinutes(),2):void 0},SlaViewModel.toTicks=function(tickString){var ticks;return ticks=tickString.split("(")[1].split(")")[0].split("+"),parseInt(ticks[0])},SlaViewModel.fromApiDate=function(apiDate){return-1===apiDate.indexOf("Date")?window.dammitIE?_.dateFromISO8601(apiDate):new Date(apiDate):new Date(SlaViewModel.toTicks(apiDate))},SlaViewModel}(),vtex.checkout.SlaViewModel=SlaViewModel}.call(this),function(){var LogisticsInfoViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};LogisticsInfoViewModel=function(){function LogisticsInfoViewModel(json){this.toJSON=__bind(this.toJSON,this),this.setDeliveryWindow=__bind(this.setDeliveryWindow,this),this.setSelectedSla=__bind(this.setSelectedSla,this),this.update=__bind(this.update,this);var _this=this;this.itemIndex=ko.observable(),this.item={},this.seller={},this.selectedSla=ko.observable(),this.selectedDeliveryChannel=ko.observable(),this.deliveryWindow=ko.observable(),this.slas=ko.observableArray([]),this.selectedSlaVM=ko.computed(function(){return _(_this.slas()).find(function(s){return s.id===_this.selectedSla()})}),this.estimateLabel=ko.computed(function(){var _ref;return null!=(_ref=_this.selectedSlaVM())?_ref.estimateLabel:void 0}),this.slaLabel=ko.computed(function(){var _ref;return null!=(_ref=_this.selectedSlaVM())?_ref.label:void 0}),this.update(json)}return LogisticsInfoViewModel.prototype.update=function(json){var dw,scheduledSla,_ref,_ref1,_ref2,_this=this;return this.itemIndex(json.itemIndex),this.item=null!=(_ref=window.cart)?_ref.itemsAndGifts()[this.itemIndex()]:void 0,this.seller=null!=(_ref1=this.item)?_ref1.seller:void 0,this.slas(_(json.slas).map(function(s){return new vtex.checkout.SlaViewModel(s)})),scheduledSla=_(this.slas()).find(function(sla){return sla.isScheduled}),scheduledSla&&scheduledSla.deliveryWindowIndex.subscribe(function(){return _this.setDeliveryWindow(scheduledSla.deliveryWindow())}),this.selectedSla(json.selectedSla),this.selectedDeliveryChannel(json.selectedDeliveryChannel),dw=null!=(_ref2=this.selectedSlaVM())?_ref2.deliveryWindow():void 0,dw&&this.deliveryWindow(_(dw).pick("startDateUtc","endDateUtc","price","tax")),this},LogisticsInfoViewModel.prototype.setSelectedSla=function(slaName){var sla,_i,_len,_ref,_results;if(this.slas()){for(_ref=this.slas(),_results=[],_i=0,_len=_ref.length;_len>_i;_i++)sla=_ref[_i],sla.name===slaName?(this.selectedSla(sla.id),_results.push(this.selectedDeliveryChannel(sla.deliveryChannel))):_results.push(void 0);return _results}},LogisticsInfoViewModel.prototype.setDeliveryWindow=function(deliveryWindow){return this.deliveryWindow(_(deliveryWindow).pick("startDateUtc","endDateUtc","price","tax"))},LogisticsInfoViewModel.prototype.toJSON=function(){var _ref,_ref1;return{itemIndex:this.itemIndex(),slas:_(this.slas()).map(function(sla){return sla.toJSON()}),selectedSla:this.selectedSla(),selectedDeliveryChannel:this.selectedDeliveryChannel(),deliveryWindow:(null!=(_ref=this.selectedSlaVM())?_ref.isScheduled:void 0)?this.deliveryWindow():void 0,tax:null!=(_ref1=this.selectedSlaVM())?_ref1.tax:void 0}},LogisticsInfoViewModel}(),vtex.checkout.LogisticsInfoViewModel=LogisticsInfoViewModel}.call(this),function(){vtex.checkout.cartFixed=function(){var cart,cartFixedReset,cartFixedScroll,cartItemsHeight,cartWrapper,confirmation,confirmationBottom,confirmationHeight,orderform,payment,paymentButtonPosition,setCartItemsHeight,shipping,sidebar,sidebarTitleHeight,sidebarTop,sidebarWrapper,summary,topDistance,windowWidth;return orderform=null,cart=null,sidebar=null,sidebarWrapper=null,sidebarTop=null,cartWrapper=null,sidebarTitleHeight=null,confirmation=null,confirmationHeight=null,confirmationBottom=null,paymentButtonPosition=null,cartItemsHeight=null,payment=null,shipping=null,summary=null,topDistance=20,setCartItemsHeight=function(sidebarWrapperHeight){var itemsHeight,summaryHeight;return summaryHeight=summary.outerHeight(!0),itemsHeight=paymentData.active()?sidebarWrapperHeight?sidebarWrapperHeight-confirmationHeight-confirmationBottom-summaryHeight-sidebarTitleHeight:sidebarWrapper.height()-confirmationHeight-confirmationBottom-summaryHeight-sidebarTitleHeight:sidebarWrapperHeight-confirmationBottom-summaryHeight-sidebarTitleHeight,cart.outerHeight(!0)>itemsHeight?(cartWrapper.height(itemsHeight),setTimeout(function(){return cartWrapper.addClass("cart-fixed-transition",0)})):(cartWrapper.removeClass("cart-fixed-transition"),cartWrapper.height("auto"))},cartFixedScroll=function(){var paymentHeight,paymentTop,scrollTop,shippingHeight,sidebarWrapperHeight,windowHeight;return sidebarTop=sidebar.offset().top,windowHeight=$(window).height(),scrollTop=document.documentElement&&document.documentElement.scrollTop>0?document.documentElement.scrollTop:$("body").scrollTop(),paymentTop=payment.offset().top,paymentHeight=payment.height(),shippingHeight=shipping.outerHeight(!0),sidebarWrapperHeight=null,sidebarWrapperHeight=paymentData.active()?paymentHeight+paymentTop-scrollTop>windowHeight?sidebarWrapper.hasClass("affix-top")?windowHeight-sidebarTop+scrollTop:windowHeight-topDistance:sidebarWrapper.hasClass("affix-top")?paymentHeight+shippingHeight:paymentHeight+paymentTop-scrollTop-topDistance:sidebarWrapper.hasClass("affix-top")?orderform.outerHeight():orderform.outerHeight()+orderform.offset().top-scrollTop-topDistance,sidebarWrapper.height(sidebarWrapperHeight),setCartItemsHeight(sidebarWrapperHeight)},cartFixedReset=function(){return sidebarWrapper.height("auto"),cartWrapper.height("auto")},sidebar=$(".mini-cart"),sidebar.length>0&&(orderform=$(".orderform-template-holder"),sidebarTop=sidebar.offset().top,sidebarWrapper=$(".cart-fixed"),sidebarTitleHeight=sidebar.find("h2").outerHeight(!0),cart=sidebar.find(".cart"),cartWrapper=sidebar.find(".summary-cart-template-holder"),confirmation=$(".payment-confirmation-wrap"),confirmationHeight=confirmation.outerHeight(!0),confirmationBottom=confirmation.css("bottom")?confirmation.css("bottom").replace("px",""):20,summary=sidebar.find(".summary-template-holder"),payment=$(".payment-data"),shipping=$(".step.shipping-data"),windowWidth=968,$(window).width()>windowWidth?(sidebarWrapper.affix({offset:{top:sidebarTop-topDistance}}),cartFixedScroll()):cartFixedReset(),sidebarWrapper.addClass("cart-fixed-transition"),$(window).on({resize:function(){return $(window).width()>windowWidth?(sidebarTop=sidebar.offset().top,sidebarWrapper.affix({offset:{top:sidebarTop-topDistance}}),cartFixedScroll()):cartFixedReset()},scroll:function(){return $(window).width()>windowWidth?(clearTimeout(paymentButtonPosition),paymentButtonPosition=setTimeout(cartFixedScroll,100)):void 0}})),radio("checkout.fixCart").subscribe(cartFixedScroll)}}.call(this),function(){window.vtex||(window.vtex={}),vtex.checkout||(vtex.checkout={}),vtex.checkout.ObservableStep=function(_this){var self;return self=_this,{stepId:"",active:ko.observable(!1),visited:ko.observable(!1),loading:ko.observable(!1),visitedAndNotActive:ko.computed({read:function(){return self.renderLoaded?self.renderLoaded()&&self.visited()&&!self.active():self.visited()&&!self.active()},deferEvaluation:!0}),notVisitedAndNotActive:ko.computed({read:function(){return!self.visited()&&!self.active()},deferEvaluation:!0}),enable:function(){return self.visited(!0),self.active(!0),self.isValid({giveFocus:!0,showErrorMessage:!1,applyErrorClass:!1})},disable:function(){return self.active(!1)}}}}.call(this),function(){window.vtex||(window.vtex={}),vtex.checkout||(vtex.checkout={}),vtex.checkout.Attachment=function(attachmentId){return null==attachmentId&&(attachmentId=""),{templateOptions:{},attachmentId:attachmentId,validate:function(options){return void 0},isValid:function(){return void 0}}}}.call(this),function(){var ClientProfileDataViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};ClientProfileDataViewModel=function(){function ClientProfileDataViewModel(){this.parseOrderFormResponse=__bind(this.parseOrderFormResponse,this),this.afterRender=__bind(this.afterRender,this),this.submit=__bind(this.submit,this),this.emailSubmitHandler=__bind(this.emailSubmitHandler,this),this.done=__bind(this.done,this),this.toJSON=__bind(this.toJSON,this),this.validateCorporateDocument=__bind(this.validateCorporateDocument,this),this.validateDocument=__bind(this.validateDocument,this),this.validateARGPhone=__bind(this.validateARGPhone,this),this.validateARGPhoneNDC=__bind(this.validateARGPhoneNDC,this),this.validatePhoneNDC=__bind(this.validatePhoneNDC,this),this.validatePhone=__bind(this.validatePhone,this),this.getPhoneValidationResult=__bind(this.getPhoneValidationResult,this),this.submitOptinNewsLetter=__bind(this.submitOptinNewsLetter,this),this.disable=__bind(this.disable,this),this.next=__bind(this.next,this),this.postUpdate=__bind(this.postUpdate,this),this.isServerClientProfileEmpty=__bind(this.isServerClientProfileEmpty,this),this.isValid=__bind(this.isValid,this),this.validate=__bind(this.validate,this),this.blurEmail=__bind(this.blurEmail,this),this.submitFirstEmail=__bind(this.submitFirstEmail,this),this.toggleCorporate=__bind(this.toggleCorporate,this),this.toggleDifferentPhone=__bind(this.toggleDifferentPhone,this),this.toggleDifferentCorporateDocument=__bind(this.toggleDifferentCorporateDocument,this),this.toggleDifferentDocument=__bind(this.toggleDifferentDocument,this),this.update=__bind(this.update,this),this.serializableProperties=__bind(this.serializableProperties,this),this.acceptPhoneSuggestion=__bind(this.acceptPhoneSuggestion,this),this.suggestPhone=__bind(this.suggestPhone,this),this.acceptSuggestion=__bind(this.acceptSuggestion,this),this.handleUserProfileNotFound=__bind(this.handleUserProfileNotFound,this),this.getRule=__bind(this.getRule,this);var _this=this;this.moduleId=this.stepId=this.attachmentId=this.id="clientProfileData",_.extend(ClientProfileDataViewModel.prototype,vtex.checkout.ObservableStep(this)),_.extend(ClientProfileDataViewModel.prototype,vtex.checkout.Attachment(this.id)),_.extend(ClientProfileDataViewModel.prototype,vtex.checkout.Module),this.applyModuleSubscriptions(),this.isCorporate=ko.observable(!1),this.showEmailForm=ko.observable(!0),this.firstName=ko.observable(),this.lastName=ko.observable(),this.fullName=ko.computed(function(){return _this.firstName()+" "+_this.lastName()}),this.fullName.subscribe(function(){return $(window).trigger("profileUpdated",[_this.toJSON()])}),this.oldDocument=ko.observable(),this.document=ko.observable(),this.alternateDocument=ko.observable(),this.oldDocumentType=ko.observable(),this.documentType=ko.observable(checkout.defaultDocumentType()),this.alternateDocumentType=ko.observable(),this.oldCorporateDocument=ko.observable(),this.corporateDocument=ko.observable(),this.alternateCorporateDocument=ko.observable(),this.alternatePhone=ko.observable(),this.hasDifferentDocument=ko.observable(!1),this.hasDifferentPhone=ko.observable(!1),this.hasDifferentCorporateDocument=ko.observable(!1),this.changeDefaultDocumentType=ko.computed(function(){var defaultDocumentType;return defaultDocumentType=checkout.defaultDocumentType(),
_this.hasDifferentDocument()===!1?_this.documentType(defaultDocumentType):void 0}),this.corporateName=ko.observable(),this.tradeName=ko.observable(),this.stateInscription=ko.observable(),this.firstEmail=ko.observable(),this.exempt=ko.observable(!1),this.countryRules={"default":{customPhoneTemplate:!1,twoSeparateFieldsForPhone:!1,documentRequired:!0,documentRequiredForCorporate:!1,tradeNameRequired:!0,stateInscriptionRequired:!1,showDocument:!0,showCorporateTradeName:!0,showCorporateStateInscription:!1,showCorporateExempt:!1,showCorporateDocument:!0,showDocumentInCorporate:!1,companyClientAttributes:["isCorporate","corporateName","tradeName","corporateDocument"],personClientAttributes:["firstEmail","email","firstName","lastName","document","phone","documentType"]},BRA:{stateInscriptionRequired:!0,showCorporateStateInscription:!0,showCorporateExempt:!0,companyClientAttributes:["isCorporate","corporateName","tradeName","corporateDocument","stateInscription"]},ARG:{customPhoneTemplate:!0,twoSeparateFieldsForPhone:!0},CAN:{documentRequired:!1,documentRequiredForCorporate:!1,showCorporateTradeName:!0,showCorporateDocument:!1,companyClientAttributes:["isCorporate","corporateName","tradeName","corporateDocument"]},COL:{stateInscriptionRequired:!0,showCorporateStateInscription:!0,companyClientAttributes:["isCorporate","corporateName","tradeName","corporateDocument","stateInscription"]},CHL:{stateInscriptionRequired:!0,showCorporateStateInscription:!0,showCorporateExempt:!0,companyClientAttributes:["isCorporate","corporateName","tradeName","corporateDocument","stateInscription"]},CRI:{documentRequired:!1,showDocument:!1,showCorporateTradeName:!1,showCorporateDocument:!1},ECU:{stateInscriptionRequired:!0,showCorporateStateInscription:!0,showCorporateExempt:!0,companyClientAttributes:["isCorporate","corporateName","tradeName","corporateDocument","stateInscription"]},ESP:{showDocument:!1,documentRequired:!1},FRA:{showDocument:!1,documentRequired:!1,documentRequiredForCorporate:!1,showCorporateDocument:!1,companyClientAttributes:["isCorporate","corporateName","tradeName","corporateDocument"]},MEX:{documentRequired:!1,documentRequiredForCorporate:!0,showCorporateTradeName:!1,showDocumentInCorporate:!0,tradeNameRequired:!1,companyClientAttributes:["isCorporate","corporateName","tradeName","corporateDocument","document","documentType"],personClientAttributes:["firstEmail","email","firstName","lastName","phone"]},PAN:{stateInscriptionRequired:!0,showCorporateStateInscription:!0,companyClientAttributes:["isCorporate","corporateName","tradeName","corporateDocument","stateInscription"]},PER:{showCorporateTradeName:!1,tradeNameRequired:!1},PRY:{stateInscriptionRequired:!0,showCorporateStateInscription:!0,showCorporateExempt:!0,companyClientAttributes:["isCorporate","corporateName","tradeName","corporateDocument","stateInscription"]},PRT:{documentRequired:!1},ROU:{showDocument:!1,documentRequired:!1},USA:{showDocument:!1,documentRequired:!1,documentRequiredForCorporate:!1,showCorporateDocument:!1,companyClientAttributes:["isCorporate","corporateName","tradeName","corporateDocument"]},GBR:{showDocument:!1,documentRequired:!1,documentRequiredForCorporate:!1,showCorporateDocument:!1,companyClientAttributes:["isCorporate","corporateName","tradeName","corporateDocument"]},ITA:{showDocument:!1,documentRequired:!1,documentRequiredForCorporate:!1,showCorporateDocument:!0,tradeNameRequired:!1,showCorporateTradeName:!1,companyClientAttributes:["isCorporate","corporateName","corporateDocument"]}},this.email=ko.observable(),this.emailSuggestionDomain=ko.observable(),this.emailSuggestionAddress=ko.observable(),this.oldEmail=ko.observable(),this.loadingEmail=ko.observable(!1),this.email.subscribe(function(email){return _this.firstEmail(email)}),this.showPhoneSuggestion=ko.observable(!1),this.phoneSuggestionCodeArea=ko.observable(),this.phoneSuggestionDigits=ko.observable(),this.autoFilled=ko.observable(!1),this.countryName=ko.computed(function(){var countryCode,locale;return countryCode=checkout.countryCode(),locale=checkout.locale(),i18n.t("countries."+countryCode)}),this.documentLabel=ko.computed(function(){var countryCode,locale;return countryCode=checkout.countryCode(),locale=checkout.locale(),i18n.t("clientProfileData.document-"+countryCode,{defaultValue:i18n.t("clientProfileData.document")})}),this.coDocumentLabel=ko.computed(function(){var countryCode,locale;return countryCode=checkout.countryCode(),locale=checkout.locale(),i18n.t("clientProfileData.coDocument-"+countryCode,{defaultValue:i18n.t("clientProfileData.corporateDocument")})}),this.hasDocumentLabel=ko.computed(function(){var locale;return locale=checkout.locale(),i18n.t("clientProfileData.iHaveDocumentFromCountry",{document:_this.documentLabel()})}),this.noDocumentLabel=ko.computed(function(){var locale;return locale=checkout.locale(),i18n.t("clientProfileData.iDontHaveDocumentFromCountry",{document:_this.documentLabel()})}),this.hasPhoneLabel=ko.computed(function(){var locale;return locale=checkout.locale(),i18n.t("clientProfileData.iHavePhoneFromCountry",{country:_this.countryName()})}),this.noPhoneLabel=ko.computed(function(){var locale;return locale=checkout.locale(),i18n.t("clientProfileData.iDontHavePhoneFromCountry",{country:_this.countryName()})}),this.stateInscriptionLabel=ko.computed(function(){var countryCode,locale;return countryCode=checkout.countryCode(),locale=checkout.locale(),i18n.t("clientProfileData.coRegisterNumber-"+countryCode,{defaultValue:i18n.t("clientProfileData.coRegisterNumber")})}),this.noStateInscriptionLabel=ko.computed(function(){var locale;return locale=checkout.locale(),i18n.t("clientProfileData.noStateInscription",{document:_this.stateInscriptionLabel()})}),this.noCorporateDocumentLabel=ko.computed(function(){var locale;return locale=checkout.locale(),i18n.t("clientProfileData.companyNotFromCountry",{country:_this.countryName()})}),this.hasCorporateDocumentLabel=ko.computed(function(){var locale;return locale=checkout.locale(),i18n.t("clientProfileData.companyFromCountry",{country:_this.countryName()})}),this.phonePlaceholder=ko.computed(function(){return vtex.validation.placeholders.phone[checkout.countryCode()]}),this.documentPlaceholder=ko.computed(function(){return vtex.validation.placeholders.document[checkout.countryCode()]}),this.companyDocumentPlaceholder=ko.computed(function(){return vtex.validation.placeholders.companyDocument[checkout.countryCode()]}),this.documentInputType=ko.computed(function(){var documentPlaceholder;return documentPlaceholder=vtex.validation.placeholders.document[checkout.countryCode()],!documentPlaceholder||documentPlaceholder.match(/[a-z]/i)?"text":"tel"}),this.documentAttributeBindings={placeholder:this.documentPlaceholder,type:this.documentInputType},8===window.dammitIE&&(this.documentAttributeBindings={placeholder:this.documentPlaceholder}),this.phonePart1=ko.observable(""),this.phonePart2=ko.observable(""),this.phonePart3=ko.observable(""),this.phoneCountryCode=ko.computed(function(){return vtex.phone.getCountryCodeByNameAbbr(checkout.countryCode())}),this.phoneTemplate=ko.computed(function(){var cc;return cc=checkout.countryCode(),_this.getRule(cc,"customPhoneTemplate")?"orderForm-phone-"+cc+"-template":"orderForm-phone-default-template"}),this.phoneIsMobile=ko.observable(!1),this.phoneIsMobile.subscribe(function(newValue){return"ARG"===checkout.countryCode()?newValue?_this.phonePart2("15"):_this.phonePart2(""):void 0}),this.isNotCorporate=ko.computed(function(){return!_this.isCorporate()}),this.isUsingExistingAccount=ko.computed(function(){return checkout.loggedIn()||!checkout.loggedIn()&&!checkout.canEditData()}),this.anonymousURL=ko.computed(function(){var listenToChanges;return listenToChanges=checkout.loggedIn()||checkout.canEditData(),API.getChangeToAnonymousUserURL()}),this.isDocumentRequired=ko.computed(function(){var country,documentRequired,documentRequiredForCorporate,isCorporate;return country=checkout.countryCode(),isCorporate=_this.isCorporate(),documentRequired=_this.getRule(country,"documentRequired"),documentRequiredForCorporate=_this.getRule(country,"documentRequiredForCorporate"),isCorporate&&documentRequiredForCorporate||!isCorporate&&documentRequired?!0:(setTimeout(function(){var _base;return"function"==typeof(_base=_this.document).validate?_base.validate({silent:!0}):void 0},500),!1)}),this.phone=ko.computed({write:function(value){var cc,hasDifferentPhone,isMobile,part1,part3,serverPhone,twoSeparateFieldsForPhone;return cc=checkout.countryCode(),hasDifferentPhone=_this.hasDifferentPhone(),twoSeparateFieldsForPhone=_this.getRule(cc,"twoSeparateFieldsForPhone"),null!=(null!=value?value.number:void 0)?hasDifferentPhone||!twoSeparateFieldsForPhone?hasDifferentPhone?_this.phonePart1(vtex.phone.format(value,vtex.phone.INTERNATIONAL)):_this.phonePart1(vtex.phone.format(value,vtex.phone.NATIONAL)):(_this.phonePart1(value.nationalDestinationCode),_this.phoneIsMobile(value.isMobile),_this.phonePart3(value.number)):twoSeparateFieldsForPhone&&!hasDifferentPhone?"ARG"===cc?(serverPhone=null!=value?value:"",part1=serverPhone.slice(1,5),part1=vtex.phone.normalize(part1),isMobile="15"===serverPhone.slice(5,7),part3=isMobile?serverPhone.slice(7):serverPhone.slice(5),_this.phonePart1(part1),_this.phoneIsMobile(isMobile),_this.phonePart3(part3)):(_this.phonePart1(""),_this.phonePart3(value)):(null!==value&&_this.phonePart1(value),""===value?_this.showPhoneSuggestion(!1):void 0)},read:function(){var country,phoneNumber,suffix;return country=checkout.countryCode(),suffix="ARG"!==country||_this.hasDifferentPhone()?"":"0",phoneNumber=_this.phonePart1()+_this.phonePart2()+_this.phonePart3(),suffix+phoneNumber}}),this.cleanPhone=ko.computed(function(){var phone,phoneNumber,_ref;return phoneNumber=null!=(_ref=_this.phone())?_ref.replace(/\_/g,""):void 0,_this.hasDifferentPhone()?(phone=vtex.phone.getPhoneInternational(phoneNumber),phone?vtex.phone.format(phone,vtex.phone.INTERNATIONAL):phoneNumber):_this.phoneCountryCode()&&(phone=vtex.phone.getPhoneNational(phoneNumber,_this.phoneCountryCode()))?vtex.phone.format(phone,vtex.phone.NATIONAL):phoneNumber}),this.phoneFocus=ko.observable(),this.documentFocus=ko.observable(),this.validateCNPJ=vtex.validation.validateCNPJ,this.maskedFirstName=ko.computed({read:function(){return maskInfo(_this.firstName())}}),this.maskedLastName=ko.computed({read:function(){return maskInfo(_this.lastName())}}),this.maskedPhone=ko.computed({read:function(){return maskInfo(_this.phone())}}),this.changeStateInscriptionValue=ko.computed(function(){var exempt;return exempt=_this.exempt(),exempt?_this.stateInscription(i18n.t("global.exempt")):_this.stateInscription("")}),this.phonePart1.subscribe(function(newPhone){var hasMaskCharacterInsLastPosition,phoneDigits;if("BRA"!==!checkout.countryCode()&&!_this.hasDifferentPhone())return phoneDigits=null!=newPhone?newPhone.replace(/\D/g,""):void 0,hasMaskCharacterInsLastPosition=10===(null!=phoneDigits?phoneDigits.length:void 0)&&newPhone.indexOf("_")===newPhone.length-1,hasMaskCharacterInsLastPosition?_this.phonePart1(null!=newPhone?newPhone.replace("_",""):void 0):void 0}),this.showDocument=ko.computed(function(){return _this.getRule(checkout.countryCode(),"showDocument")}),this.showCorporateTradeName=ko.computed(function(){return _this.getRule(checkout.countryCode(),"showCorporateTradeName")}),this.showCorporateStateInscription=ko.computed(function(){return _this.getRule(checkout.countryCode(),"showCorporateStateInscription")}),this.showCorporateExempt=ko.computed(function(){return _this.getRule(checkout.countryCode(),"showCorporateExempt")}),this.showDocumentInCorporate=ko.computed(function(){return _this.getRule(checkout.countryCode(),"showDocumentInCorporate")}),this.showCorporateDocument=ko.computed(function(){return _this.getRule(checkout.countryCode(),"showCorporateDocument")}),this.companyClientAttributes=ko.computed(function(){return _this.getRule(checkout.countryCode(),"companyClientAttributes")}),this.personClientAttributes=ko.computed(function(){return _this.getRule(checkout.countryCode(),"personClientAttributes")}),this.requirementDocument=ko.computed(function(){return _this.getRule(checkout.countryCode(),"documentRequired")}),this.requirementTradeName=ko.computed(function(){return _this.getRule(checkout.countryCode(),"tradeNameRequired")}),this.requirementStateInscription=ko.computed(function(){var required;return required=_this.getRule(checkout.countryCode(),"stateInscriptionRequired"),required===!1?!1:!_this.showCorporateExempt()&&_this.isUsingDefaultCorporateDocument()!==!1||_this.exempt()!==!0?!0:!1}),this.isUsingDefaultDocument=ko.computed(function(){return!(_this.alternateDocument()||_this.alternateDocumentType()||_this.hasDifferentDocument())}),this.isUsingDefaultCorporateDocument=ko.computed(function(){return!(_this.alternateCorporateDocument()||_this.hasDifferentCorporateDocument())}),this.isUsingDefaultPhone=ko.computed(function(){return!_this.alternatePhone()}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/orderFormUpdated.vtex",function(e,orderForm){return _this.parseOrderFormResponse(orderForm)})}var maskInfo;return maskInfo=function(info){var maskRegex,maskText;return maskRegex=/\*/g,maskText='<span class="masked-info">*</span>',info?info.replace(maskRegex,maskText):info},ClientProfileDataViewModel.prototype.getRule=function(countryCode,rule){return this.countryRules[countryCode]&&null!=this.countryRules[countryCode][rule]?this.countryRules[countryCode][rule]:this.countryRules["default"][rule]},ClientProfileDataViewModel.prototype.handleUserProfileNotFound=function(){var _this=this;return this.loadingEmail(!1),this.showEmailForm(!1),window.hasher.replaceHash("profile"),Kicksend.mailcheck.run({email:this.email(),suggested:function(suggestion){return _this.emailSuggestionAddress(suggestion.address+"@"),_this.emailSuggestionDomain(suggestion.domain)},empty:function(){return _this.emailSuggestionAddress(void 0),_this.emailSuggestionDomain(void 0)}})},ClientProfileDataViewModel.prototype.acceptSuggestion=function(){return this.email(this.emailSuggestionAddress()+this.emailSuggestionDomain()),this.emailSuggestionDomain(void 0),this.emailSuggestionAddress(void 0),this.blurEmail()},ClientProfileDataViewModel.prototype.suggestPhone=function(validation,phone){var phoneFormatted,phoneObj,suggestedAreaCode;return"COL"===checkout.countryCode()&&null===phone.match(/\(\d{1}\)/)&&(phone=phone.replace(/\D/g,""),7===phone.length&&validation.result===!1&&"3"!==phone[0]?(suggestedAreaCode="(1) ",phoneObj=vtex.phone.getPhoneNational(suggestedAreaCode+phone,this.phoneCountryCode()),phoneFormatted=vtex.phone.format(phoneObj,vtex.phone.LOCAL),this.phoneSuggestionDigits(phoneFormatted),this.phoneSuggestionCodeArea(suggestedAreaCode),this.showPhoneSuggestion(!0),validation.message=""):this.showPhoneSuggestion()&&(this.phoneSuggestionDigits(null),this.phoneSuggestionCodeArea(null),this.showPhoneSuggestion(!1))),validation},ClientProfileDataViewModel.prototype.acceptPhoneSuggestion=function(){return this.phone(this.phoneSuggestionCodeArea()+this.phoneSuggestionDigits()),this.phone.validate(),this.showPhoneSuggestion(!1),this.phoneSuggestionDigits(void 0),this.phoneSuggestionCodeArea(void 0)},ClientProfileDataViewModel.prototype.serializableProperties=function(){return this.personClientAttributes().concat(this.companyClientAttributes())},ClientProfileDataViewModel.prototype.update=function(data){var canEditData,countryCode,countryValidationObject,hasNoDocumentType,isDifferentDocumentType,isInternationalFormat,phone,phoneFromOtherCountry,setDifferentCorporateDocument,setDifferentDocument,showCorporateDocument,storeDefaultDocument,storeExpectedPhoneCountryCode,unexpectedPhone,validationResult;return canEditData=checkout.canEditData(),countryCode=checkout.countryCode(),storeExpectedPhoneCountryCode=this.phoneCountryCode(),data.phone&&canEditData&&storeExpectedPhoneCountryCode&&(isInternationalFormat=0===data.phone.indexOf("+"),phone=isInternationalFormat?vtex.phone.getPhoneInternational(data.phone):vtex.phone.getPhoneNational(data.phone,storeExpectedPhoneCountryCode),unexpectedPhone=!phone,phoneFromOtherCountry=phone&&phone.countryCode!==storeExpectedPhoneCountryCode,unexpectedPhone||phoneFromOtherCountry?(this.hasDifferentPhone(!0),this.alternatePhone(data.phone),this.differentPhoneFlag||(this.differentPhoneFlag=!0)):phone&&(data.phone=phone)),hasNoDocumentType=null===data.documentType||!data.documentType,countryValidationObject=vtex.validation.countryToKey[countryCode],storeDefaultDocument=null!=countryValidationObject?countryValidationObject.document:void 0,isDifferentDocumentType=data.documentType&&countryValidationObject&&countryValidationObject.document.toLowerCase()!==data.documentType.toLowerCase(),hasNoDocumentType&&storeDefaultDocument?data.documentType=storeDefaultDocument:hasNoDocumentType?data.documentType="document":isDifferentDocumentType&&(setDifferentDocument=!0),data.isCorporate&&canEditData&&data.corporateDocument&&(showCorporateDocument=this.getRule(countryCode,"showCorporateDocument"),showCorporateDocument?(validationResult=this.validateCorporateDocument(data.corporateDocument),setDifferentCorporateDocument=!validationResult||validationResult.result===!1):setDifferentCorporateDocument=!0),ko.utils.extendObservable(this,data),setDifferentDocument&&!this.hasDifferentDocument()&&(this.toggleDifferentDocument(),this.alternateDocument(data.document),this.alternateDocumentType(data.documentType)),setDifferentCorporateDocument&&!this.hasDifferentCorporateDocument()&&(this.toggleDifferentCorporateDocument(),this.alternateCorporateDocument(data.corporateDocument)),this.commit(),this},ClientProfileDataViewModel.prototype.toggleDifferentDocument=function(){var hasDifferentDocument,previousHasDifferentDocument;return previousHasDifferentDocument=this.hasDifferentDocument(),hasDifferentDocument=!previousHasDifferentDocument,hasDifferentDocument?(this.oldDocument(this.document()),this.oldDocumentType(this.documentType()),this.document(""),this.documentType(""),this.alternateDocument(""),this.alternateDocumentType("")):(this.alternateDocument(this.document()),this.alternateDocumentType(""),this.document(this.oldDocument()),this.documentType(this.oldDocumentType())),this.hasDifferentDocument(hasDifferentDocument)},ClientProfileDataViewModel.prototype.toggleDifferentCorporateDocument=function(){var hasDifferentCorporateDocument,previousHasDifferentCorporateDocument;return previousHasDifferentCorporateDocument=this.hasDifferentCorporateDocument(),hasDifferentCorporateDocument=!previousHasDifferentCorporateDocument,hasDifferentCorporateDocument?(this.oldCorporateDocument(this.corporateDocument()),this.corporateDocument(""),this.alternateCorporateDocument(""),this.requirementStateInscription()&&this.exempt(!0)):(this.alternateCorporateDocument(this.corporateDocument()),this.corporateDocument(this.oldCorporateDocument()),this.exempt(!1)),this.hasDifferentCorporateDocument(hasDifferentCorporateDocument)},ClientProfileDataViewModel.prototype.toggleDifferentPhone=function(){var hasDifferentPhone,previousHasDifferentPhone;return previousHasDifferentPhone=this.hasDifferentPhone(),hasDifferentPhone=!previousHasDifferentPhone,hasDifferentPhone?(this.phonePart1(""),this.phonePart2(""),this.phonePart3(""),this.alternatePhone(this.phone())):(this.alternatePhone(""),this.phonePart1(""),this.phonePart2(""),this.phonePart3("")),this.hasDifferentPhone(hasDifferentPhone)},ClientProfileDataViewModel.prototype.toggleCorporate=function(){return this.isCorporate(!this.isCorporate())},ClientProfileDataViewModel.prototype.submitFirstEmail=function(){return this.firstEmail.validate({giveFocus:!0}),this.email(this.firstEmail()),this.oldEmail()!==this.email()&&""!==this.email()&&this.email.validate().result!==!1?(this.oldEmail(this.email()),this.loadingEmail(!0),this.emailSubmitHandler(this.toJSON()),this.enable()):void 0},ClientProfileDataViewModel.prototype.blurEmail=function(){return this.oldEmail()!==this.email()&&""!==this.email()&&this.email.validate().result!==!1?(this.oldEmail(this.email()),this.loadingEmail(!0),this.emailSubmitHandler(this.toJSON())):void 0},ClientProfileDataViewModel.prototype.validate=function(options){var cc,fields,hasDifferentPhone,prop,twoSeparateFieldsForPhone,validationResults,_i,_j,_len,_len1,_ref,_ref1;if(window.checkout.canEditData()){for(fields=[],hasDifferentPhone=this.hasDifferentPhone(),cc=checkout.countryCode(),twoSeparateFieldsForPhone=this.getRule(cc,"twoSeparateFieldsForPhone"),_ref=this.personClientAttributes(),_i=0,_len=_ref.length;_len>_i;_i++)prop=_ref[_i],("document"!==prop||this.isUsingDefaultDocument())&&("phone"!==prop||this.isUsingDefaultPhone())&&fields.push(this[prop]);if(this.isCorporate())for(_ref1=this.companyClientAttributes(),_j=0,_len1=_ref1.length;_len1>_j;_j++)prop=_ref1[_j],("corporateDocument"!==prop||this.isUsingDefaultCorporateDocument()&&this.getRule(cc,"showCorporateDocument")!==!1)&&fields.push(this[prop]);!hasDifferentPhone&&twoSeparateFieldsForPhone&&(fields.push(this.phonePart1),fields.push(this.phonePart3)),validationResults=vtex.ko.validation.validateObservables(fields,options),checkout.canEditData()===!0&&checkout.loggedIn()===!1&&this.loadingEmail()===!0&&validationResults.push({result:!1})}else validationResults=[{result:!0}];return $("#client-profile-data").trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/componentValidated.vtex",[validationResults]),validationResults},ClientProfileDataViewModel.prototype.isValid=function(options){var isValid,validationResults;return validationResults=this.validate(options||{giveFocus:!1}),isValid=validationResults.length>0&&_(validationResults).all(function(val){return val.result===!0})},ClientProfileDataViewModel.prototype.isServerClientProfileEmpty=function(){var _ref,_ref1,_ref2;return _.isEmpty(null!=(_ref=window.vtexjs)&&null!=(_ref1=_ref.checkout)&&null!=(_ref2=_ref1.orderForm)?_ref2.clientProfileData:void 0)},ClientProfileDataViewModel.prototype.postUpdate=function(data){var _ref;if(data.email)return this.firstEmail(data.email),this.oldEmail(data.email),void 0!==this.email&&this.showEmailForm(!1),this.loadingEmail(!1),(null!=(_ref=this.stateInscription())?_ref.toLowerCase():void 0)===i18n.t("global.exempt").toLowerCase()&&this.exempt(!0),vtex.checkout.Module.commit.apply(this)},ClientProfileDataViewModel.prototype.next=function(){return this.active()&&this.isValid({giveFocus:!0,showErrorMessage:!0,applyErrorClass:!0})&&this.done(),!1},ClientProfileDataViewModel.prototype.disable=function(){var changedOptinNewsLetter,xhr,_this=this;return this.active()&&checkout.canEditData()&&(xhr=this.isValid()&&(this.isDirty()||this.isServerClientProfileEmpty())?this.submit():$.Deferred().resolve(),changedOptinNewsLetter=checkout.savedOptinNewsLetter()!==checkout.optinNewsLetter(),this.isValid()&&changedOptinNewsLetter&&xhr.done(function(){return _this.submitOptinNewsLetter()})),this.active(!1)},ClientProfileDataViewModel.prototype.submitOptinNewsLetter=function(){return API.sendAttachment("clientPreferencesData",{locale:checkout.originalLocale(),optinNewsLetter:checkout.optinNewsLetter()})},ClientProfileDataViewModel.prototype.getPhoneValidationResult=function(result,options){var validation;return null==options&&(options={}),validation={applyErrorClass:!result,showErrorMessage:!result,applySuccessClass:result,result:result},result||(validation.message=vtex.ko.validation.getValidationMessage("tel",checkout.locale())),_.extend(validation,options),validation},ClientProfileDataViewModel.prototype.validatePhone=function(value,element,options){var phoneResult,validationResult;return this.hasDifferentPhone()?{result:!0,applySuccessClass:!1,showErrorMessage:!1,applyErrorClass:!1}:"ARG"===checkout.countryCode()?this.validateARGPhone(value,element,options):(this.phoneCountryCode()?(phoneResult=vtex.phone.validate(this.phone(),this.phoneCountryCode()),validationResult=this.getPhoneValidationResult(phoneResult,options),validationResult=this.suggestPhone(validationResult,value)):validationResult=this.getPhoneValidationResult(!0,options),validationResult)},ClientProfileDataViewModel.prototype.validatePhoneNDC=function(value,element,options){var countryObj,ndc,result,_i,_len,_ref,_ref1;if(this.hasDifferentPhone())return{result:!0,applySuccessClass:!1,showErrorMessage:!1,applyErrorClass:!1};for(value=value.replace(/\D/g,""),countryObj=vtex.phone.countries[this.phoneCountryCode()],result=!1,_ref=countryObj.nationalDestinationCode,_i=0,_len=_ref.length;_len>_i&&(ndc=_ref[_i],_ref1=vtex.phone.testNDC(ndc,countryObj,value),result=_ref1[0],ndc=_ref1[1],!result);_i++);return this.getPhoneValidationResult(result,options)},ClientProfileDataViewModel.prototype.validateARGPhoneNDC=function(value,element,options){var phoneResult;return this.hasDifferentPhone()?{result:!0,applySuccessClass:!1,showErrorMessage:!1,applyErrorClass:!1}:(phoneResult="9"!==value&&__indexOf.call(vtex.phone.countries[54].nationalDestinationCode,value)>=0,this.getPhoneValidationResult(phoneResult,options))},ClientProfileDataViewModel.prototype.validateARGPhone=function(value,element,options){var phoneResult;return this.hasDifferentPhone()?{result:!0,applySuccessClass:!1,showErrorMessage:!1,applyErrorClass:!1}:(phoneResult=vtex.phone.validate(this.phone(),"54"),this.getPhoneValidationResult(phoneResult,options))},ClientProfileDataViewModel.prototype.validateDocument=function(value,element){return value||this.isDocumentRequired()?this.hasDifferentDocument()?{result:!0,applySuccessClass:!1,showErrorMessage:!1,applyErrorClass:!1}:vtex.validation.validateDocument(value,element):{result:!0,applySuccessClass:!1,showErrorMessage:!1,applyErrorClass:!1}},ClientProfileDataViewModel.prototype.validateCorporateDocument=function(value,element,options){var corporateDocumentKey,countryCode,countryValidationObject,result,validation;switch(countryCode=checkout.countryCode()){case"BRA":return vtex.validation.validateCNPJ(value,element,options);case"PER":return vtex.validation.validateRUCPER(value,element,options)}return countryValidationObject=vtex.validation.countryToKey[countryCode],countryValidationObject?(corporateDocumentKey=countryValidationObject.corporateDocument,result=vtex.validation.regex[corporateDocumentKey]?vtex.validation.regex[corporateDocumentKey].test(value):!0):result=!0,validation={},validation.applyErrorClass=validation.showErrorMessage=!result,validation.applySuccessClass=result,validation.result=result,result===!1&&(validation.message=i18n.t("clientProfileData.invalidDocument")),validation},ClientProfileDataViewModel.prototype.toJSON=function(){var attr,isUsingDefaultCorporateDocument,isUsingDefaultDocument,isUsingDefaultPhone,json,key,phone,_i,_len,_ref;for(json={},isUsingDefaultDocument=this.isUsingDefaultDocument(),isUsingDefaultPhone=this.isUsingDefaultPhone(),isUsingDefaultCorporateDocument=this.isUsingDefaultCorporateDocument(),_ref=this.serializableProperties(),_i=0,_len=_ref.length;_len>_i;_i++)key=_ref[_i],"document"!==key||isUsingDefaultDocument?"documentType"!==key||isUsingDefaultDocument?"corporateDocument"!==key||isUsingDefaultCorporateDocument?"email"===key?(attr=ko.toJS(this.email),null!=(null!=attr&&"function"==typeof attr.toLowerCase?attr.toLowerCase():void 0)&&(attr=attr.toLowerCase())):"phone"===key?(isUsingDefaultPhone?(attr=ko.toJS(this[key]),this.phoneCountryCode()&&(phone=vtex.phone.getPhoneNational(attr,this.phoneCountryCode()),phone||(phone=vtex.phone.getPhoneInternational(attr)))):(attr=ko.toJS(this.alternatePhone),phone=vtex.phone.getPhoneInternational(attr)),phone&&(attr=vtex.phone.format(phone,vtex.phone.INTERNATIONAL))):attr=ko.toJS(this[key]):attr=ko.toJS(this.alternateCorporateDocument):attr=ko.toJS(this.alternateDocumentType):attr=ko.toJS(this.alternateDocument),json[key]=attr;return this.isCorporate()&&(json.corporatePhone=json.phone),json},ClientProfileDataViewModel.prototype.done=function(){return $("#client-profile-data").trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/componentDone.vtex")},ClientProfileDataViewModel.prototype.emailSubmitHandler=function(clientProfileData){var attachment,attachmentId,xhr,_this=this;return attachmentId="clientProfileData",attachment=_(clientProfileData).pick("email"),xhr=API.getProfileByEmail(clientProfileData.email,window.checkout.salesChannel()),xhr.done(function(data){var sendAttachmentXHR;return!data.userProfileId||void 0!==data.hasAddress&&data.hasAddress!==!0?_this.handleUserProfileNotFound():(vtex.checkout.MessageUtils.showEmailMessage(),_this.loading(!0),"function"==typeof vtexid.setEmail&&vtexid.setEmail(clientProfileData.email),sendAttachmentXHR=API.sendAttachment(attachmentId,attachment),sendAttachmentXHR.done(function(data){return $("#shipping-data").one("https://io.vtex.com.br/checkout-ui/5.16.7/script/componentValidated.vtex",function(){return _this.done()})}),sendAttachmentXHR.fail(function(){return _this.handleUserProfileNotFound(),_this.loading(!1),_this.enable()}))}),xhr.fail(this.handleUserProfileNotFound)},ClientProfileDataViewModel.prototype.submit=function(){var attachment,attachmentId,xhr,_this=this;return this.loading(!0),attachmentId="clientProfileData",attachment=this.toJSON(),attachment.documentType!==checkout.defaultDocumentType()&&window.checkoutLogger&&window.checkoutLogger({name:"wrong-document-type",data:{documentType:attachment.documentType}}),xhr=API.sendAttachment(attachmentId,attachment),xhr.fail(function(){return router.setHash("profile"),_this.loading(!1)}),xhr},ClientProfileDataViewModel.prototype.afterRender=function(){return vtex.i18n.translateHtml("#client-profile-data")},ClientProfileDataViewModel.prototype.parseOrderFormResponse=function(orderForm){var clientProfileData,_ref;return clientProfileData=null!=(_ref=_.clone(orderForm.clientProfileData))?_ref:{},"BRA"===window.checkout.countryCode()&&clientProfileData.document&&"cpf"===clientProfileData.documentType&&(clientProfileData.document=_.maskString(clientProfileData.document,vtex.validation.masks.cpf)),this.loading(!1),this.update(clientProfileData),this.postUpdate(clientProfileData),this.validate({dontChangeDOM:!0})},ClientProfileDataViewModel}(),vtex.checkout.ClientProfileDataViewModel=ClientProfileDataViewModel}.call(this),function(){var SlasForSellerViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};SlasForSellerViewModel=function(){function SlasForSellerViewModel(logisticsInfoArray){var _ref,_ref1,_ref2,_ref3,_ref4,_this=this;this.logisticsInfoArray=logisticsInfoArray,this.findScheduledSla=__bind(this.findScheduledSla,this),this.buildSlas=__bind(this.buildSlas,this),this.sellerId=ko.observable(null!=(_ref=this.logisticsInfoArray[0].item)&&null!=(_ref1=_ref.seller)?_ref1.id():void 0),this.sellerName=ko.observable(null!=(_ref2=this.logisticsInfoArray[0].item)&&null!=(_ref3=_ref2.seller)?_ref3.name():void 0),this.slas=ko.observableArray(this.buildSlas()),this.scheduledSla=this.findScheduledSla(),null!=(_ref4=this.scheduledSla)&&_ref4.deliveryWindowIndex.subscribe(function(newValue){var logisticsInfo,scheduledSla,_i,_len,_ref5;for(_ref5=_this.logisticsInfoArray.slice(1),_i=0,_len=_ref5.length;_len>_i;_i++)logisticsInfo=_ref5[_i],scheduledSla=_.find(logisticsInfo.slas(),function(s){var _ref6;return s.name===(null!=(_ref6=_this.scheduledSla)?_ref6.name:void 0)}),null!=scheduledSla&&scheduledSla.deliveryWindowIndex(newValue);return _this.logisticsInfoArray[0].selectedSla.notifySubscribers(),$(".totalizers-list").trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/deliverySelected.vtex",[_.map(_this.logisticsInfoArray,function(li){return li.toJSON()})])}),this.selectedSlaName=ko.computed({read:function(){return _this.logisticsInfoArray[0].selectedSlaVM()?_this.logisticsInfoArray[0].selectedSlaVM().name:void 0},write:function(name){var isNewScheduledSla,logisticsInfo,_i,_len,_ref5,_ref6,_ref7;for(isNewScheduledSla=(null!=(_ref5=_this.scheduledSla)?_ref5.name:void 0)===name&&null===(null!=(_ref6=_this.scheduledSla)?_ref6.deliveryWindowIndex():void 0),_ref7=_this.logisticsInfoArray,_i=0,_len=_ref7.length;_len>_i;_i++)logisticsInfo=_ref7[_i],logisticsInfo.setSelectedSla(name);return $(".totalizers-list").trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/deliverySelected.vtex",[_.map(_this.logisticsInfoArray,function(li){
return li.toJSON()})])}}),this.selectedSlaEstimate=ko.computed(function(){return _this.logisticsInfoArray[0].selectedSlaVM()?_this.logisticsInfoArray[0].selectedSlaVM().maxEstimateLabel?_this.logisticsInfoArray[0].selectedSlaVM().maxEstimateLabel:_this.logisticsInfoArray[0].selectedSlaVM().exactEstimateLabel:void 0}),this.selectedSlaPrice=ko.computed(function(){return _this.logisticsInfoArray[0].selectedSlaVM()?_this.logisticsInfoArray[0].selectedSlaVM().valueLabel:void 0}),this.isSelectedSlaScheduled=ko.computed(function(){return _this.logisticsInfoArray[0].selectedSlaVM()?_this.logisticsInfoArray[0].selectedSlaVM().isScheduled:void 0})}return SlasForSellerViewModel.prototype.buildSlas=function(){var i,logisticsInfo,maxShippingEstimateForSlaName,sla,slas,summedPriceForSlaName,summedTaxesForSlaName,_i,_j,_k,_l,_len,_len1,_len2,_len3,_ref,_ref1,_ref2,_ref3,_this=this;for(summedPriceForSlaName={},summedTaxesForSlaName={},_ref=this.logisticsInfoArray,i=_i=0,_len=_ref.length;_len>_i;i=++_i)for(logisticsInfo=_ref[i],_ref1=logisticsInfo.slas(),_j=0,_len1=_ref1.length;_len1>_j;_j++)sla=_ref1[_j],void 0===summedPriceForSlaName[sla.name]&&(summedPriceForSlaName[sla.name]=0),void 0===summedTaxesForSlaName[sla.name]&&(summedTaxesForSlaName[sla.name]=0),summedPriceForSlaName[sla.name]+=sla.price,summedTaxesForSlaName[sla.name]+=sla.tax;for(maxShippingEstimateForSlaName={},_ref2=this.logisticsInfoArray,i=_k=0,_len2=_ref2.length;_len2>_k;i=++_k)for(logisticsInfo=_ref2[i],_ref3=logisticsInfo.slas(),_l=0,_len3=_ref3.length;_len3>_l;_l++)sla=_ref3[_l],void 0===maxShippingEstimateForSlaName[sla.name]&&(maxShippingEstimateForSlaName[sla.name]=0),sla.shippingEstimate>maxShippingEstimateForSlaName[sla.name]&&(maxShippingEstimateForSlaName[sla.name]=sla.shippingEstimate);return slas=this.logisticsInfoArray[0].slas(),_(slas).each(function(sla){var _ref4;return sla.summedPrice=summedPriceForSlaName[sla.name],sla.summedTaxes=summedTaxesForSlaName[sla.name],sla.maxShippingEstimate=maxShippingEstimateForSlaName[sla.name],sla.updateLabelsAndPriceProperties(),sla.nameAttr=_.plainChars("seller-"+_this.sellerId()),sla.idAttr=_.plainChars(sla.nameAttr+"-sla-"+(null!=(_ref4=sla.id)?_ref4.replace(/\ /g,""):void 0)),sla.hasFocus=ko.observable()}),slas},SlasForSellerViewModel.prototype.findScheduledSla=function(){return _(this.slas()).find(function(sla){return sla.isScheduled})},SlasForSellerViewModel.slasGroupedBySeller=function(logisticsInfo){var logisticsInfoMap,slasForSellerViewModelArray;return logisticsInfo?(logisticsInfoMap=_(logisticsInfo).groupBy(function(li){var _ref;return null!=(_ref=li.seller)?_ref.id():void 0}),slasForSellerViewModelArray=[],_(logisticsInfoMap).each(function(logisticsInfoArray,sellerId){var logisticsInfoWithSlas;return logisticsInfoWithSlas=_.filter(logisticsInfoArray,function(li){var _ref;return(null!=(_ref=li.slas())?_ref.length:void 0)>0}),logisticsInfoWithSlas.length>0?slasForSellerViewModelArray.push(new vtex.checkout.SlasForSellerViewModel(logisticsInfoWithSlas)):void 0}),slasForSellerViewModelArray):[]},SlasForSellerViewModel}(),vtex.checkout.SlasForSellerViewModel=SlasForSellerViewModel}.call(this),function(){var Payment;Payment=function(){function Payment(json){var _ref;this.paymentSystem=json.paymentSystem,this.paymentSystemName=json.paymentSystemName,this.group=json.group,this.installments=json.installments,this.installmentsInterestRate=json.installmentsInterestRate,this.installmentsValue=null!=(_ref=json.installmentsValue)?_ref:json.value,this.value=json.value,this.referenceValue=json.referenceValue,this.fields=json.fields,this.availableAccounts=json.availableAccounts,this.bin=json.bin,this.accountId=json.accountId}return Payment}(),vtex.checkout.Payment=Payment}.call(this),function(){var Installment,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Installment=function(){function Installment(json){this.toJSON=__bind(this.toJSON,this),this.update=__bind(this.update,this);var _this=this;this.number=ko.observable(),this.value=this.price=ko.observable(),this.interestRate=ko.observable(),this.total=ko.observable(),this.update(json),this.text=ko.computed(function(){return 1===_this.number()?i18n.t("paymentData.singleInstallment",{value:_.intAsCurrency(_this.value())}):null===_this.interestRate()?i18n.t("paymentData.installments",{installments:_this.number()}):_this.interestRate()>0?i18n.t("paymentData.installmentsWithInterest",{installments:_this.number(),value:_.intAsCurrency(_this.value()),interest:_.formatCurrency(_this.interestRate()/100)}):i18n.t("paymentData.installmentsWithInterestFree",{installments:_this.number(),value:_.intAsCurrency(_this.value())})}),this.textSimple=ko.computed(function(){return _.intAsCurrency(_this.value())})}return Installment.prototype.update=function(json){return this.number(json.count),this.value(json.value),this.interestRate(json.interestRate),this.total(json.total)},Installment.prototype.toJSON=function(){return{number:this.number(),value:this.value(),interestRate:this.interestRate(),total:this.total()}},Installment}(),vtex.checkout.Installment=Installment}.call(this),function(){var PaymentSystem,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};PaymentSystem=function(){function PaymentSystem(json){this.toJSON=__bind(this.toJSON,this),this.getInstallmentsForValue=__bind(this.getInstallmentsForValue,this),this.updateInstallmentsMap=__bind(this.updateInstallmentsMap,this),this.update=__bind(this.update,this),this.id=ko.observable(),this.name=ko.observable(),this.groupName=ko.observable(),this.group=ko.observable(),this.template=ko.observable(),this.installmentsMap={},this.requestedInstallmentValuesArray=[],this.selected=ko.observable(),this.regex=ko.observable(),this.mask=ko.observable(),this.cardCodeRegex=ko.observable(),this.cardCodeMask=ko.observable(),this.weights=ko.observable(),this.requiresAuthentication=ko.observable(!1),this.isCustom=ko.observable(),this.useBillingAddress=ko.observable(),this.useCardHolderName=ko.observable(),this.useCvv=ko.observable(),this.useExpirationDate=ko.observable(),this.validator={},this.payments=[],this.update(json)}return PaymentSystem.prototype.update=function(json){return ko.utils.extendObservable(this,_(json).omit("validator")),this.validator=json.validator,this.regex(json.validator.regex),this.mask(json.validator.mask),this.cardCodeRegex(json.validator.cardCodeRegex),this.cardCodeMask(json.validator.cardCodeMask),this.weights(json.validator.weights),this.useBillingAddress(json.validator.useBillingAddress),this.useCardHolderName(json.validator.useCardHolderName),this.useCvv(json.validator.useCvv),this.useExpirationDate(json.validator.useExpirationDate),this},PaymentSystem.prototype.updateInstallmentsMap=function(installmentOptionsArray){var bin,installmentOption,installmentsArray,_i,_len,_results;for(_results=[],_i=0,_len=installmentOptionsArray.length;_len>_i;_i++)installmentOption=installmentOptionsArray[_i],installmentsArray=_(installmentOption.installments).map(function(i){return new vtex.checkout.Installment(i)}),bin=installmentOption.bin||"default",this.installmentsMap[bin]||(this.installmentsMap[bin]={}),_results.push(this.installmentsMap[bin][installmentOption.value]=installmentsArray);return _results},PaymentSystem.prototype.getInstallmentsForValue=function(bin,value){var _ref,_ref1;return bin||(bin="default"),(null!=(_ref=this.installmentsMap[bin])?_ref[value]:void 0)?null!=(_ref1=this.installmentsMap[bin])?_ref1[value]:void 0:[]},PaymentSystem.prototype.toJSON=function(){return{paymentSystem:this.id(),stringId:this.id()+"",name:this.name(),requiresAuthentication:this.requiresAuthentication(),requiresDocument:this.requiresDocument(),isCustom:this.isCustom(),groupName:this.groupName(),validator:this.validator}},PaymentSystem}(),vtex.checkout.PaymentSystem=PaymentSystem}.call(this),function(){var GiftCardViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};GiftCardViewModel=function(){function GiftCardViewModel(json){var _ref,_this=this;null==json&&(json={}),this.dontUse=__bind(this.dontUse,this),this.use=__bind(this.use,this),this.toJSON=__bind(this.toJSON,this),this.update=__bind(this.update,this),this.id=null!=(_ref=json.id)?_ref:(-1*(new Date).getTime()).toString()+Math.random().toString(36).substr(2),this.redemptionCode=ko.observable(null),this.value=ko.observable(null),this.balance=ko.observable(null),this.name=ko.observable(null),this.inUse=ko.observable(null),this.isSpecialCard=ko.observable(null),this.caption=ko.observable(null),this.captionClass=ko.observable(null),this.provider=ko.observable(null),this.groupName=ko.observable(null),this.update(json),this.valueLabel=ko.computed(function(){return _.intAsCurrency(_this.value())}),this.balanceLabel=ko.computed(function(){return _.intAsCurrency(_this.balance())}),this.friendlyName=ko.computed(function(){return _this.caption()?_this.caption():_this.name()?i18n.t("global."+_this.name()):void 0}),radio("vtex.i18n.update").subscribe(function(){return _this.name.notifySubscribers()})}return GiftCardViewModel.prototype.update=function(json){var _ref,_ref1;return this.redemptionCode(json.redemptionCode),this.value(json.value),this.balance(json.balance),this.name(json.name),this.inUse(null!=(_ref=json.inUse)?_ref:!1),this.isSpecialCard(null!=(_ref1=json.isSpecialCard)?_ref1:!1),this.caption(json.caption),json.caption&&this.captionClass(_.spacesToHyphens(json.caption+"").toLowerCase()),this.provider(json.provider),this.groupName(json.groupName)},GiftCardViewModel.prototype.toJSON=function(){return{id:this.id,redemptionCode:this.redemptionCode(),value:this.value(),balance:this.balance(),name:this.name(),inUse:this.inUse(),isSpecialCard:this.isSpecialCard(),provider:this.provider()}},GiftCardViewModel.prototype.use=function(){return this.inUse(!0),window.paymentData.paymentGroups.giftCardPaymentGroup.submitGiftCards()},GiftCardViewModel.prototype.dontUse=function(){return this.inUse(!1),window.paymentData.paymentGroups.giftCardPaymentGroup.submitGiftCards()},GiftCardViewModel}(),vtex.checkout.GiftCardViewModel=GiftCardViewModel}.call(this),function(){var PaymentGroupViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};PaymentGroupViewModel=function(){function PaymentGroupViewModel(json,paymentSystems){this.getPayments=__bind(this.getPayments,this),this.updateInstallments=__bind(this.updateInstallments,this),this.updatePayments=__bind(this.updatePayments,this);var countryCode,_this=this;if(this.id=(-1*(new Date).getTime()).toString()+Math.random().toString(36).substr(2),this.template=ko.observable("genericPaymentGroup-template"),this.name=json.name,this.nameSlug=json.isCustom?_.sanitize(_.spacesToHyphens(json.name)).toLowerCase():"",this.className=this.nameSlug?"pg-"+this.nameSlug:"",this.description=json.description,this.groupName=ko.observable(json.groupName),radio("vtex.i18n.update").subscribe(function(){return _this.groupName.notifySubscribers()}),this.showAsTab=ko.observable(!0),this.hasAdvancedTab=ko.observable(!1),this.paymentSystems=ko.observableArray(paymentSystems),this.paidValue=ko.observable(),this.customStyle=ko.observable({}),this.templateCssClass=ko.observable(),countryCode=checkout.countryCode(),"PayPal"===this.name&&(this.templateCssClass("payPalPaymentGroup"+countryCode),this.template=ko.observable("payPalPaymentGroup-template")),"Koin Ps-Pago"===this.name&&(this.template=ko.observable("boletoKoinPosPagoPaymentGroup-template")),"Stelo"===this.name&&(this.template=ko.observable("steloPaymentGroup-template")),"Venda Direta Credito"===this.name&&(this.template=ko.observable("pinpadPaymentGroup-template")),"Mercado Pago"===this.name&&(this.template=ko.observable("mercadoPagoPaymentGroup-template")),"TodoPago"===this.name&&(this.template=ko.observable("todoPagoPaymentGroup-template")),"Safetypay"===this.name)switch(this.templateCssClass("safetyPayPaymentGroup"+countryCode),countryCode){case"MEX":case"CHL":case"DEU":case"ESP":this.template=ko.observable("safetyPayPaymentGroup1-template");break;case"COL":this.template=ko.observable("safetyPayPaymentGroupCOL-template");break;case"ECU":this.template=ko.observable("safetyPayPaymentGroupECU-template");break;case"PER":this.template=ko.observable("safetyPayPaymentGroupPER-template");break;default:this.template=ko.observable("safetyPayPaymentGroup-template")}if("Lotrica"===this.name)switch(this.templateCssClass("lotteryPaymentGroup"+countryCode),countryCode){case"ECU":case"MEX":case"CHL":case"COL":this.template=ko.observable("lotteryPaymentGroup1-template");break;case"DEU":case"PRT":this.template=ko.observable("lotteryPaymentGroup2-template");break;case"PER":this.template=ko.observable("lotteryPaymentGroupPER-template");break;default:this.template=ko.observable("lotteryPaymentGroup-template")}"Rede Pay"===this.name&&(this.template=ko.observable("redepayPaymentGroup-template")),"Credit Control"===this.name&&(this.template=ko.observable("creditControlPaymentGroup-template")),"CreditControl"===this.name&&(this.template=ko.observable("creditControlPaymentGroup-template")),"reusePayment"===this.name&&(this.template=ko.observable("reusePayment-template")),"PayMee"===this.name&&(this.template=ko.observable("payMeePaymentGroup-template")),"PicPay"===this.name&&(this.template=ko.observable("picPayPaymentGroup-template")),"FutPag"===this.name&&(this.template=ko.observable("futPagPaymentGroup-template")),"Livelo"===this.name&&(this.template=ko.observable("liveloPaymentGroup-template")),"iBuy"===this.name&&(this.template=ko.observable("iBuyPaymentGroup-template")),"PinCash"===this.name&&(this.template=ko.observable("pinCashPaymentGroup-template")),"LevPay"===this.name&&(this.template=ko.observable("levpayPaymentGroup-template")),"Pagomio"===this.name&&(this.template=ko.observable("pagomioPaymentGroup-template")),"Losango"===this.name&&(this.template=ko.observable("losangoPaymentGroup-template")),"LevPay"===this.name&&(this.hasAdvancedTab=ko.observable(!0)),this.localizedType=ko.computed(function(){var groupName;return groupName=_this.groupName(),i18n.t("paymentData.paymentGroup."+groupName.replace("PaymentGroup","")+".type")}),this.localizedLabel=ko.computed(function(){var groupName,translation,translationKey;return groupName=_this.groupName(),countryCode=checkout.countryCode(),translationKey="paymentData.paymentGroup."+groupName.replace("PaymentGroup","")+".name",translation="Safetypay"===_this.name?i18n.t(translationKey+countryCode,{defaultValue:i18n.t(translationKey)}):i18n.t(translationKey),translation===translationKey?_this.name:translation}),this.localizedDescription=ko.computed(function(){var groupName,translation,translationKey,_ref;return groupName=_this.groupName(),translationKey="paymentData.paymentGroup."+groupName.replace("PaymentGroup","")+".description",translation=i18n.t(translationKey),translation===translationKey?null!=(_ref=_this.description)?_ref:_this.name:translation}),this.paymentSystem=ko.observable(paymentSystems[0]),this.formatDate=function(date){var day,month,year;return year=date.getFullYear(),month=date.getMonth()+1,day=date.getDate(),10>month&&(month="0"+month),10>day&&(day="0"+day),"en"===window.vtex.i18n.getLocale()?month+"/"+day+"/"+year:day+"/"+month+"/"+year},this.dueDate=ko.observable(json.dueDate?new Date(json.dueDate):new Date),this.paymentDueDate=ko.computed(function(){return _this.formatDate(_this.dueDate())}),this.paymentDueHour=ko.computed(function(){var dueDate,minutes;return dueDate=_this.dueDate(),minutes=dueDate.getMinutes(),10>minutes&&(minutes="0"+minutes),dueDate.getHours()+"h"+minutes}),this.installments=ko.observableArray(),this.selectedInstallment=ko.computed(function(){return _.find(_this.installments(),function(i){return i.number()===_this._selectedInstallmentNumber()})}),this._selectedInstallmentNumber=ko.observable(),this.selectedInstallmentNumber=ko.computed({read:function(){return _this._selectedInstallmentNumber()},write:function(installmentNumber){var currentInstallmentNumber,newInstallmentIsDifferent;if(installmentNumber)return currentInstallmentNumber=_this._selectedInstallmentNumber.peek(),_this._selectedInstallmentNumber(installmentNumber),newInstallmentIsDifferent=null!=currentInstallmentNumber&&currentInstallmentNumber!==installmentNumber,null==currentInstallmentNumber||newInstallmentIsDifferent?$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/paymentUpdated.vtex"):void 0}}),this.maxInstallmentOptionFunction=function(installments){return installments?_.max(installments,function(i){return i.number()}):void 0},this.maxInstallmentOption=ko.computed(function(){return _this.maxInstallmentOptionFunction(_this.installments())}),this.installmentsCaption=ko.computed(function(){return null==_this._selectedInstallmentNumber()?i18n.t("paymentData.paymentGroup.installmentsCaption"):null}),this.setOptionDisable=function(option,item){return"undefined"==typeof item&&_this._selectedInstallmentNumber()?ko.applyBindingsToNode(option,{disable:!0},item):void 0}}return PaymentGroupViewModel.prototype.updatePayments=function(payments){var p,_i,_len,_results;for(_results=[],_i=0,_len=payments.length;_len>_i;_i++)p=payments[_i],this.paidValue(p.referenceValue),_results.push(this.updateInstallments(p.installments));return _results},PaymentGroupViewModel.prototype.updateInstallments=function(installmentNumber){var installments,oldInstallmentNumber,_ref;if(oldInstallmentNumber=null!=(_ref=this._selectedInstallmentNumber())?_ref:installmentNumber,installments=this.paymentSystem().getInstallmentsForValue("default",this.paidValue()),null==installments)throw new Error("No installments for current paid value",this.paidValue(),"on paymentSystem",this.paymentSystem().id());return oldInstallmentNumber&&this._selectedInstallmentNumber(oldInstallmentNumber),this.installments(installments),vtex.i18n.translateHtml(".steps-view")},PaymentGroupViewModel.prototype.getPayments=function(masked){var payment,selectedInstallment,total,_ref;return total=this.paidValue(),0===total?[]:(selectedInstallment=null!=(_ref=this.selectedInstallment())?_ref.toJSON():void 0,payment=new vtex.checkout.Payment({paymentSystem:this.paymentSystem().id(),paymentSystemName:this.paymentSystem().name(),group:this.paymentSystem().groupName(),value:selectedInstallment?null!=selectedInstallment?selectedInstallment.total:void 0:total,referenceValue:total,installments:this._selectedInstallmentNumber(),installmentsInterestRate:null!=selectedInstallment?selectedInstallment.interestRate:void 0,installmentsValue:null!=selectedInstallment?selectedInstallment.value:void 0}),[payment])},PaymentGroupViewModel.prototype.validate=function(){return[{result:!0}]},PaymentGroupViewModel.prototype.isValid=function(){return!0},PaymentGroupViewModel.prototype.afterRender=function(){},PaymentGroupViewModel}(),vtex.checkout.PaymentGroupViewModel=PaymentGroupViewModel}.call(this),function(){var IFramePaymentGroupViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};IFramePaymentGroupViewModel=function(_super){function IFramePaymentGroupViewModel(json,paymentSystems){this.iFrameSendCountriesTranslations=__bind(this.iFrameSendCountriesTranslations,this),this.iFrameSendPayments=__bind(this.iFrameSendPayments,this),this.iFrameSetVisibility=__bind(this.iFrameSetVisibility,this),this.iFrameSetActive=__bind(this.iFrameSetActive,this),this.iFramePreSubmit=__bind(this.iFramePreSubmit,this),this.iFrameAuthenticatedUser=__bind(this.iFrameAuthenticatedUser,this),this.iFrameSendOrderForm=__bind(this.iFrameSendOrderForm,this),this.sendIframe=__bind(this.sendIframe,this),this.getIFrame=__bind(this.getIFrame,this),this.newLocale=__bind(this.newLocale,this),this.createIFrame=__bind(this.createIFrame,this),this.removeIframeLoading=__bind(this.removeIframeLoading,this),this.sendPayments=__bind(this.sendPayments,this),this.doSubmit=__bind(this.doSubmit,this),this.preSubmit=__bind(this.preSubmit,this),this.preSubmitHook=__bind(this.preSubmitHook,this),this.afterRender=__bind(this.afterRender,this),this.sendOrderForm=__bind(this.sendOrderForm,this),this.getPayments=__bind(this.getPayments,this),this.updatePayments=__bind(this.updatePayments,this),this.onChangeActive=__bind(this.onChangeActive,this),this.setHeightHandler=__bind(this.setHeightHandler,this),this.setVisibility=__bind(this.setVisibility,this),this.submitButton=__bind(this.submitButton,this),this.setupComplete=__bind(this.setupComplete,this),this.unsubscribe=__bind(this.unsubscribe,this),this.subscribe=__bind(this.subscribe,this);var fallbackLocale,groupName,identifier,_this=this;IFramePaymentGroupViewModel.__super__.constructor.apply(this,arguments),groupName=json.groupName,identifier=this.getIdentifier(groupName),this.identifier=ko.observable(identifier),fallbackLocale=$("html").attr("lang"),this.iFrameOrigin=this.getIFrameOrigin(identifier),this.iFrameURL=this.getIFrameURL(this.iFrameOrigin,identifier,groupName,fallbackLocale),this.iFrameId="#iframe-placeholder-"+groupName,this.isIFrame=!0,this.isActive=!1,this.isVisible=!1,this.iFrameTimeout=null,this.hasPreSubmitHook=!0,this.submitPromise=null,this.template("iFrame-template"),this.isDebitCard=ko.observable("debitCard"===identifier),this.isCustom=ko.observable("creditCardCustom"===identifier),this.localizedLabel=ko.computed(function(){var translation,translationKey;return translationKey="paymentData.paymentGroup."+_this.identifier()+".name",translation=i18n.t(translationKey),translation===translationKey?_this.name:translation}),this.payments=[],this.isEditingSensitiveField=ko.observable(!1),this.subscribe()}return __extends(IFramePaymentGroupViewModel,_super),IFramePaymentGroupViewModel.prototype.subscribe=function(){var groupName;groupName=this.groupName(),radio("paymentData.isVisible").subscribe(this.setVisibility),radio("paymentData.paymentGroup.iFrame."+groupName+".setupComplete").subscribe(this.setupComplete),radio("paymentData.paymentGroup.iFrame."+groupName+".setIFrameHeight").subscribe(this.setHeightHandler),radio("paymentData.paymentGroup.iFrame."+groupName+".sendOrderForm").subscribe(this.sendOrderForm),radio("paymentData.paymentGroup.iFrame."+groupName+".submitButton").subscribe(this.submitButton),radio("paymentData.paymentGroup.iFrame."+groupName+".preSubmit").subscribe(this.preSubmit),radio("paymentData.paymentGroup.iFrame."+groupName+".doSubmit").subscribe(this.doSubmit),radio("paymentData.paymentGroup.iFrame."+groupName+".sendPayments").subscribe(this.sendPayments),radio("vtex.i18n.update").subscribe(this.newLocale)},IFramePaymentGroupViewModel.prototype.unsubscribe=function(){var groupName;groupName=this.groupName(),radio("paymentData.isVisible").unsubscribe(this.setVisibility),radio("paymentData.paymentGroup.iFrame."+groupName+".setIFrameHeight").unsubscribe(this.setHeightHandler),radio("paymentData.paymentGroup.iFrame."+groupName+".sendOrderForm").unsubscribe(this.sendOrderForm),radio("paymentData.paymentGroup.iFrame."+groupName+".submitButton").unsubscribe(this.submitButton),radio("paymentData.paymentGroup.iFrame."+groupName+".preSubmit").unsubscribe(this.preSubmit),radio("paymentData.paymentGroup.iFrame."+groupName+".doSubmit").unsubscribe(this.doSubmit),radio("paymentData.paymentGroup.iFrame."+groupName+".sendPayments").unsubscribe(this.sendPayments),radio("vtex.i18n.update").unsubscribe(this.newLocale)},IFramePaymentGroupViewModel.prototype.setupComplete=function(){return this.iFrameTimeout&&clearTimeout(this.iFrameTimeout),this.iFrameSetActive(this.isActive),this.iFrameSetVisibility(this.isVisible),this.removeIframeLoading(),this.newLocale(window.checkout.locale())},IFramePaymentGroupViewModel.prototype.submitButton=function(isActive){return this.isEditingSensitiveField(!isActive)},IFramePaymentGroupViewModel.prototype.setVisibility=function(isVisible){return this.isVisible=isVisible,this.iFrameSetVisibility(isVisible)},IFramePaymentGroupViewModel.prototype.setHeightHandler=function(height){var $iframe;return $iframe=this.getIFrame(),$iframe.css("height",height)},IFramePaymentGroupViewModel.prototype.onChangeActive=function(isActive){return this.isActive=isActive,this.isActive&&this.validate({giveFocus:!0,showErrorMessage:!1,applyErrorClass:!1}),this.iFrameSetVisibility(this.isVisible),this.iFrameSetActive(this.isActive)},IFramePaymentGroupViewModel.prototype.updatePayments=function(payments){return this.payments=payments},IFramePaymentGroupViewModel.prototype.getPayments=function(){return this.payments},IFramePaymentGroupViewModel.prototype.sendOrderForm=function(ev,orderForm){var orderFormObject;return null==orderForm&&(orderForm=window.vtexjs.checkout.orderForm),orderFormObject=JSON.parse(JSON.stringify(orderForm)),this.iFrameSendOrderForm(orderFormObject)},IFramePaymentGroupViewModel.prototype.afterRender=function(){return this.createIFrame(),"payPalPlus"===this.identifier()?this.setHeightHandler("442px"):void 0},IFramePaymentGroupViewModel.prototype.preSubmitHook=function(deferred,submitData){return this.submitPromise&&this.submitPromise.reject({reason:"abort"}),this.submitPromise=deferred,this.iFramePreSubmit()},IFramePaymentGroupViewModel.prototype.preSubmit=function(isDone){return this.submitPromise?isDone?this.submitPromise.resolve():this.submitPromise.reject():void 0},IFramePaymentGroupViewModel.prototype.doSubmit=function(paymentGroup,payments){return radio("checkout.paymentData.loading").broadcast(!0),radio("checkout.paymentData.submitIFramePayment").broadcast(paymentGroup,payments)},IFramePaymentGroupViewModel.prototype.sendPayments=function(payments,transactionResponse,extraData){return this.iFrameSendPayments(payments,transactionResponse,extraData)},IFramePaymentGroupViewModel.prototype.removeIframeLoading=function(){return $(".payment-iframe-loading").remove()},IFramePaymentGroupViewModel.prototype.createIFrame=function(){var iframe,onLoadFn,_this=this;return this.iFrameTimeout&&clearTimeout(this.iFrameTimeout),onLoadFn="radio('paymentData.paymentGroup.iFrame."+this.groupName()+".sendOrderForm').broadcast()",iframe="<iframe class='span12' src='"+this.iFrameURL+"' frameborder='0' onload=\""+onLoadFn+"\" style='height: 200px'></iframe>",$(this.iFrameId).html(iframe),this.iFrameTimeout=setTimeout(function(){$(_this.iFrameId).find("iframe").attr("src",""+_this.iFrameURL+"&retry=2")},2500),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/orderFormUpdated.vtex",this.sendOrderForm),$(window).on("authenticatedUser.vtexid",this.iFrameAuthenticatedUser)},IFramePaymentGroupViewModel.prototype.newLocale=function(locale){var countriesTranslations;return countriesTranslations=vtex.i18n[locale].countries,this.iFrameSendCountriesTranslations(locale,countriesTranslations)},IFramePaymentGroupViewModel.prototype.getIFrame=function(){return $(this.iFrameId+" iframe")},IFramePaymentGroupViewModel.prototype.sendIframe=function(event,args){var $iframe,e,_ref,_ref1;$iframe=this.getIFrame();try{return null!=(_ref=$iframe[0])&&null!=(_ref1=_ref.contentWindow)?_ref1.postMessage({event:event,arguments:args},this.iFrameOrigin):void 0}catch(_error){return e=_error,console.log(e)}},IFramePaymentGroupViewModel.prototype.iFrameSendOrderForm=function(orderForm){return this.sendIframe("https://io.vtex.com.br/checkout-ui/5.16.7/script/orderFormUpdated.vtex",[orderForm,this.isVisible])},IFramePaymentGroupViewModel.prototype.iFrameAuthenticatedUser=function(){return this.sendIframe("authenticatedUser.vtexid",[])},IFramePaymentGroupViewModel.prototype.iFramePreSubmit=function(){return this.sendIframe("https://io.vtex.com.br/checkout-ui/5.16.7/script/preSubmit.vtex",[])},IFramePaymentGroupViewModel.prototype.iFrameSetActive=function(isActive){return this.sendIframe("https://io.vtex.com.br/checkout-ui/5.16.7/script/setActive.vtex",[isActive])},IFramePaymentGroupViewModel.prototype.iFrameSetVisibility=function(isVisible){return this.sendIframe("https://io.vtex.com.br/checkout-ui/5.16.7/script/setVisibility.vtex",[isVisible])},IFramePaymentGroupViewModel.prototype.iFrameSendPayments=function(payments,transactionResponse,extraData){return this.sendIframe("https://io.vtex.com.br/checkout-ui/5.16.7/script/sendPayments.vtex",[payments,transactionResponse,extraData])},IFramePaymentGroupViewModel.prototype.iFrameSendCountriesTranslations=function(locale,countriesTranslations){return this.sendIframe("https://io.vtex.com.br/checkout-ui/5.16.7/script/countriesTranslations.vtex",[locale,countriesTranslations])},IFramePaymentGroupViewModel.prototype.getIdentifier=function(groupName){var identifier;switch(identifier=null,groupName){case"debitCardPaymentGroup":identifier="debitCard";break;case"PayPalPlusPaymentGroup":identifier="payPalPlus";break;case"OneBuyPaymentGroup":identifier="oneBuy";break;default:identifier=-1!==groupName.indexOf("customPrivate")?"creditCardCustom":"creditCard"}return identifier},IFramePaymentGroupViewModel.prototype.getIFrameOrigin=function(identifier){var devURL,ioURL;switch(devURL="http://"+vtex.accountName+".vtexlocal.com.br",ioURL="https://io.vtexpayments.com.br",identifier){case"oneBuy":return"https://h-api.onebuy.com";case"payPalPlus":return window.devPayPalPlus?devURL:ioURL;default:return window.devCardUI?devURL:ioURL}},IFramePaymentGroupViewModel.prototype.getIFrameURL=function(iFrameOrigin,identifier,groupName,fallbackLocale){var css,iFrameURL;switch(identifier){case"payPalPlus":iFrameURL=window.devPayPalPlus?iFrameOrigin+"/paypal-plus/":iFrameOrigin+"/paypal-plus/1.1.4/index.html";break;case"oneBuy":iFrameURL=iFrameOrigin+"/VTex";break;default:iFrameURL=window.devCardUI?iFrameOrigin+"/card-ui/":iFrameOrigin+"/card-ui/1.7.31/index.html"}return css=$("#checkout-custom-css").attr("href"),""+iFrameURL+"?paymentGroup="+groupName+"&fallbackLocale="+fallbackLocale+"&accountName="+vtex.accountName+"&css="+encodeURIComponent(css)+"&origin="+encodeURIComponent(location.origin)},IFramePaymentGroupViewModel}(vtex.checkout.PaymentGroupViewModel),vtex.checkout.IFramePaymentGroupViewModel=IFramePaymentGroupViewModel}.call(this),function(){var ExtensionPaymentGroupViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};ExtensionPaymentGroupViewModel=function(_super){function ExtensionPaymentGroupViewModel(json,paymentSystems){this.getData=__bind(this.getData,this),this.setState=__bind(this.setState,this),this.getPaymentSystemsInstallments=__bind(this.getPaymentSystemsInstallments,this),this.getPaymentSystems=__bind(this.getPaymentSystems,this),this.getInstallments=__bind(this.getInstallments,this),this._getPayments=__bind(this._getPayments,this),this.changeInstallment=__bind(this.changeInstallment,this),this.changePaymentSystem=__bind(this.changePaymentSystem,this),this.changeAvailability=__bind(this.changeAvailability,this),this.warn=__bind(this.warn,this),this.renderExtension=__bind(this.renderExtension,this),this.sendPayments=__bind(this.sendPayments,this),this.doSubmit=__bind(this.doSubmit,this),this.sendAuthorizationToFinish=__bind(this.sendAuthorizationToFinish,this),this.preSubmitHook=__bind(this.preSubmitHook,this),this.renderFunction=__bind(this.renderFunction,this),this.onOrderSuccess=__bind(this.onOrderSuccess,this),this.onOrderFail=__bind(this.onOrderFail,this),this.onChangeActive=__bind(this.onChangeActive,this),this.setVisibility=__bind(this.setVisibility,this),this.submitButton=__bind(this.submitButton,this),this.setupComplete=__bind(this.setupComplete,this),this.unsubscribe=__bind(this.unsubscribe,this),this.subscribe=__bind(this.subscribe,this);var customStyle,groupName,_this=this;ExtensionPaymentGroupViewModel.__super__.constructor.apply(this,arguments),groupName=json.groupName,this.selectedPaymentSystemId=json.stringId,this.appName=this.getAppName(),this.isIFrame=!1,this.rootElement=null,this.hasPreSubmitHook=!0,this.submitPromise=null,this.payments=[],this.state={isActive:!1,
isPaymentStepActive:!1,isPendingAuthorizationToFinish:!1,isFinishing:!1,orderSuccess:null,orderFail:null,transactionData:{}},this.template("extension-template"),this.isEditingSensitiveField=ko.observable(!1),this.available=ko.observable(!0),customStyle={},customStyle[this.getBaseClassNames()+"-icon"]=!0,this.customStyle=ko.observable(customStyle),this.labelElement=document.createElement("div"),this.localizedLabel=ko.computed(function(){var translation,translationKey;return _this.hasNameExtension()?(vtex.renderLoader.render(_this.getNameExtension(),_this.labelElement),_this.labelElement.innerText):(translationKey="paymentData.paymentGroup."+groupName+".name",translation=i18n.t(translationKey),translation===translationKey?_this.name:translation)}),this.subscribe()}return __extends(ExtensionPaymentGroupViewModel,_super),ExtensionPaymentGroupViewModel.prototype.getExtensionPath=function(){return"checkout/payments/"+this.groupName()},ExtensionPaymentGroupViewModel.prototype.getNameExtension=function(){return this.getExtensionPath()+"--name"},ExtensionPaymentGroupViewModel.prototype.getBaseClassNames=function(){var componentId;return componentId=vtex.renderRuntime.extensions[this.getExtensionPath()].component,componentId.slice(0,componentId.indexOf("@")+2).replace(/\./gi,"-").replace("@","-")+"-x"},ExtensionPaymentGroupViewModel.prototype.getAppName=function(){var componentId,result;return componentId=vtex.renderRuntime.extensions[this.getExtensionPath()].component,result=componentId.split("@"),result[0]},ExtensionPaymentGroupViewModel.prototype.hasNameExtension=function(){var _ref;return null!=(null!=(_ref=vtex.renderRuntime.extensions[this.getNameExtension()])?_ref.component:void 0)},ExtensionPaymentGroupViewModel.prototype.subscribe=function(){var groupName;groupName=this.groupName(),radio("paymentData.isVisible").subscribe(this.setVisibility),radio("paymentData.paymentGroup.iFrame."+groupName+".setupComplete").subscribe(this.setupComplete),radio("paymentData.paymentGroup.iFrame."+groupName+".setIFrameHeight").subscribe(this.setHeightHandler),radio("paymentData.paymentGroup.iFrame."+groupName+".sendOrderForm").subscribe(this.sendOrderForm),radio("paymentData.paymentGroup.iFrame."+groupName+".submitButton").subscribe(this.submitButton),radio("paymentData.paymentGroup.iFrame."+groupName+".preSubmit").subscribe(this.preSubmit),radio("paymentData.paymentGroup.iFrame."+groupName+".doSubmit").subscribe(this.doSubmit),radio("paymentData.paymentGroup.iFrame."+groupName+".sendPayments").subscribe(this.sendPayments),radio("vtex.i18n.update").subscribe(this.newLocale)},ExtensionPaymentGroupViewModel.prototype.unsubscribe=function(){var groupName;groupName=this.groupName(),radio("paymentData.isVisible").unsubscribe(this.setVisibility),radio("paymentData.paymentGroup.iFrame."+groupName+".setIFrameHeight").unsubscribe(this.setHeightHandler),radio("paymentData.paymentGroup.iFrame."+groupName+".sendOrderForm").unsubscribe(this.sendOrderForm),radio("paymentData.paymentGroup.iFrame."+groupName+".submitButton").unsubscribe(this.submitButton),radio("paymentData.paymentGroup.iFrame."+groupName+".preSubmit").unsubscribe(this.preSubmit),radio("paymentData.paymentGroup.iFrame."+groupName+".doSubmit").unsubscribe(this.doSubmit),radio("paymentData.paymentGroup.iFrame."+groupName+".sendPayments").unsubscribe(this.sendPayments),radio("vtex.i18n.update").unsubscribe(this.newLocale)},ExtensionPaymentGroupViewModel.prototype.setupComplete=function(){return this.newLocale(window.checkout.locale())},ExtensionPaymentGroupViewModel.prototype.submitButton=function(isActive){return this.isEditingSensitiveField(!isActive)},ExtensionPaymentGroupViewModel.prototype.setVisibility=function(isPaymentStepActive){return this.setState({isPaymentStepActive:isPaymentStepActive}),this.renderExtension()},ExtensionPaymentGroupViewModel.prototype.onChangeActive=function(isActive){return this.setState({isActive:isActive}),this.renderExtension()},ExtensionPaymentGroupViewModel.prototype.onOrderFail=function(reason){return this.setState({orderSuccess:!1,orderFail:reason,isFinishing:!1}),this.renderExtension(),this.setState({orderSucess:null,orderFail:null}),this.renderExtension()},ExtensionPaymentGroupViewModel.prototype.onOrderSuccess=function(){return this.setState({orderSuccess:!0,orderFail:null}),this.renderExtension()},ExtensionPaymentGroupViewModel.prototype.renderFunction=function(element){return this.rootElement=element,this.renderExtension()},ExtensionPaymentGroupViewModel.prototype.preSubmitHook=function(deferred){return this.submitPromise&&this.submitPromise.reject({reason:"abort"}),this.submitPromise=deferred,this.setState({isPendingAuthorizationToFinish:!0}),this.renderExtension()},ExtensionPaymentGroupViewModel.prototype.sendAuthorizationToFinish=function(authorized,paymentsFields){return authorized&&this.state.isActive?(this.submitPromise&&this.submitPromise.resolve(),this.setState({isPendingAuthorizationToFinish:!1,isFinishing:!0}),this.renderExtension(),this.doSubmit(paymentsFields)):(this.submitPromise&&this.submitPromise.reject(),this.setState({isPendingAuthorizationToFinish:!1}),this.renderExtension())},ExtensionPaymentGroupViewModel.prototype.doSubmit=function(paymentsFields){var payments,sensitiveData;return sensitiveData=!0,payments=this._getPayments(),paymentsFields&&(sensitiveData=!1,payments=_.map(payments,function(p,index){return p.fields=paymentsFields[index],p})),radio("checkout.paymentData.loading").broadcast(!0),radio("checkout.paymentData.submitIFramePayment").broadcast(this.groupName(),payments,sensitiveData)},ExtensionPaymentGroupViewModel.prototype.sendPayments=function(payments,transactionResponse,extraData){return this.setState({transactionData:{payments:payments,transactionResponse:transactionResponse,extraData:extraData}}),this.renderExtension()},ExtensionPaymentGroupViewModel.prototype.renderExtension=function(){return this.rootElement?vtex.renderLoader.render(this.getExtensionPath(),this.rootElement,_.extend({},this.state,this.getData(),{changeAvailability:this.changeAvailability,changePaymentSystem:this.changePaymentSystem,changeInstallment:this.changeInstallment,sendAuthorizationToFinish:this.sendAuthorizationToFinish})):void 0},ExtensionPaymentGroupViewModel.prototype.warn=function(){var _ref;return null!=(null!=(_ref=vtex.renderRuntime)?_ref.workspace:void 0)!=="master"?console.log.apply(console,arguments):void 0},ExtensionPaymentGroupViewModel.prototype.changeAvailability=function(params){return null===params.available?void this.warn(this.appName+': changeAvailability - Missing a required parameter "available"'):(this.showAsTab(params.available),this.available(params.available),radio("checkout.paymentData.paymentGroup.availability").broadcast(this.id,params.available))},ExtensionPaymentGroupViewModel.prototype.changePaymentSystem=function(params){var ps;if(!params.paymentSystem)return void this.warn(this.appName+': changePaymentSystem - Missing a required parameter "paymentSystem"');if(this.paymentSystem().id()!==parseInt(params.paymentSystem,10))return(ps=_.find(this.paymentSystems(),function(ps){return ps.id()===parseInt(params.paymentSystem,10)}))?(this.paymentSystem(ps),$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/paymentUpdated.vtex")):void this.warn(this.appName+(": changePaymentSystem - There is no paymentSystem "+params.paymentSystem+" available"))},ExtensionPaymentGroupViewModel.prototype.changeInstallment=function(params){var installment,installments;if(!params.installment)return void this.warn(this.appName+': changeInstallment - Missing a required parameter "installment"');if(this._selectedInstallmentNumber()!==params.installment)return installments=this.getInstallments(this.paymentSystem()),installment=_.find(installments,function(i){return i.number===params.installment}),installment?this.selectedInstallmentNumber(params.installment):void this.warn(this.appName+(": changeInstallment - There is no installment "+params.installment+" available"))},ExtensionPaymentGroupViewModel.prototype._getPayments=function(){return this.state.isActive?_.map(this.getPayments(),function(p){var newP;return newP=_.extend({},p),newP.id=newP.id+"",newP}):[]},ExtensionPaymentGroupViewModel.prototype.getInstallments=function(ps){var installments;return installments=ps.getInstallmentsForValue("default",this.paidValue()),_.map(installments,function(i){return i.toJSON()})},ExtensionPaymentGroupViewModel.prototype.getPaymentSystems=function(){var paymentSystems;return paymentSystems=this.paymentSystems(),_.map(paymentSystems,function(ps){return ps.toJSON()})},ExtensionPaymentGroupViewModel.prototype.getPaymentSystemsInstallments=function(){var _this=this;return _.reduce(this.paymentSystems(),function(acc,ps){return acc[ps.stringId()]=_this.getInstallments(ps),acc},{})},ExtensionPaymentGroupViewModel.prototype.setState=function(newState){return this.state=_.extend({},this.state,newState)},ExtensionPaymentGroupViewModel.prototype.getData=function(){return{payments:this._getPayments(),installments:this.getPaymentSystemsInstallments(),selectedPaymentSystem:this.paymentSystem().stringId(),paymentSystems:this.getPaymentSystems()}},ExtensionPaymentGroupViewModel}(vtex.checkout.PaymentGroupViewModel),vtex.checkout.ExtensionPaymentGroupViewModel=ExtensionPaymentGroupViewModel}.call(this),function(){var MultiplePaymentOptionsViewModel,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};MultiplePaymentOptionsViewModel=function(_super){function MultiplePaymentOptionsViewModel(json,paymentSystems){var selectedPaymentSystems,_this=this;MultiplePaymentOptionsViewModel.__super__.constructor.apply(this,arguments),this.template("multiplePaymentOptions-template"),selectedPaymentSystems=_.filter(this.paymentSystems(),function(ps){return ps.selected()}),this.selectedPaymentSystemId=ko.observable(selectedPaymentSystems[0]?selectedPaymentSystems[0].id():this.paymentSystems()[0].id()),this.paymentSystem=ko.computed(function(){return _.find(_this.paymentSystems(),function(paymentSystem){return paymentSystem.id()===parseInt(_this.selectedPaymentSystemId(),10)})}),this.selectedPaymentSystemId.subscribe(function(oldValue){return null!=oldValue&&window.paymentData.selectedPaymentGroupId()===_this.id?$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/paymentUpdated.vtex"):void 0},this,"beforeChange")}return __extends(MultiplePaymentOptionsViewModel,_super),MultiplePaymentOptionsViewModel}(vtex.checkout.PaymentGroupViewModel),vtex.checkout.MultiplePaymentOptionsViewModel=MultiplePaymentOptionsViewModel}.call(this),function(){var PagosWebPaymentGroupViewModel,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};PagosWebPaymentGroupViewModel=function(_super){function PagosWebPaymentGroupViewModel(json,paymentSystems){var _this=this;PagosWebPaymentGroupViewModel.__super__.constructor.apply(this,arguments),this.template("PagosWebPaymentGroup-template"),this.selectedPaymentSystemId=ko.observable(this.paymentSystems()[0].id()),this.localizedLabel=ko.observable(i18n.t("https://io.vtex.com.br/checkout-ui/5.16.7/script/paymentData.paymentGroup.pagosWeb.name")),this.description=ko.observable(i18n.t("paymentData.paymentGroup.pagosWeb.description")),this.paymentSystem=ko.computed(function(){return _.find(_this.paymentSystems(),function(paymentSystem){return paymentSystem.id()===parseInt(_this.selectedPaymentSystemId(),10)})}),this.selectedPaymentSystemId.subscribe(function(oldValue){return null!=oldValue&&window.paymentData.selectedPaymentGroupId()===_this.id?$(window).trigger("paymentUpdated.vtex"):void 0},this,"beforeChange")}return __extends(PagosWebPaymentGroupViewModel,_super),PagosWebPaymentGroupViewModel}(vtex.checkout.PaymentGroupViewModel),vtex.checkout.PagosWebPaymentGroupViewModel=PagosWebPaymentGroupViewModel}.call(this),function(){var SpecialGiftCardProviderGroupViewModel;SpecialGiftCardProviderGroupViewModel=function(){function SpecialGiftCardProviderGroupViewModel(parent,provider,giftCards){var name,slug,_this=this;name="VtexGiftCard"===provider.id?i18n.t("global.loyalty-program"):provider.id,slug=_.sanitize(_.spacesToHyphens(name)).toLowerCase(),this.parent=parent,this.caption=provider.caption||i18n.t("global.loyalty-program"),this.name=ko.observable(name),this.slug=ko.observable(slug),this.giftCards=ko.observableArray(giftCards),this.specialGiftCardsGroups=ko.computed(function(){var groups,groupsArray,key,specialGiftCardsGroup,value;groups=_.groupBy(_this.giftCards(),function(gc){return gc.groupName()}),groupsArray=[];for(key in groups)value=groups[key],specialGiftCardsGroup=new vtex.checkout.SpecialGiftCardGroupViewModel(self,key,value),groupsArray.push(specialGiftCardsGroup);return groupsArray})}return SpecialGiftCardProviderGroupViewModel}(),window.vtex.checkout.SpecialGiftCardProviderGroupViewModel=SpecialGiftCardProviderGroupViewModel}.call(this),function(){var SpecialGiftCardGroupViewModel;SpecialGiftCardGroupViewModel=function(){function SpecialGiftCardGroupViewModel(parent,name,giftCards){var firstGiftCardInUse,slug,_this=this;"VtexGiftCard"===name&&(name=i18n.t("global.loyalty-program")),slug=_.sanitize(_.spacesToHyphens(name)).toLowerCase(),this.parent=parent,this.name=ko.observable(name),this.slug=ko.observable(slug),this.isRadio=ko.observable(giftCards.length>1),this.giftCards=ko.observableArray(giftCards),firstGiftCardInUse=_.find(giftCards,function(gc){return gc.inUse()}),this.selectedRadioGiftCard=ko.observable(firstGiftCardInUse),this.selectedRadioGiftCard.subscribe(function(value){var giftCard,giftCardToBeUsed,_i,_len,_ref;for(_ref=_this.giftCards(),_i=0,_len=_ref.length;_len>_i;_i++)giftCard=_ref[_i],giftCard.id===value?giftCardToBeUsed=giftCard:giftCard.inUse(!1);return(null!=giftCardToBeUsed?giftCardToBeUsed.inUse.peek():void 0)?giftCardToBeUsed.dontUse():null!=giftCardToBeUsed?giftCardToBeUsed.use():void 0})}return SpecialGiftCardGroupViewModel}(),window.vtex.checkout.SpecialGiftCardGroupViewModel=SpecialGiftCardGroupViewModel}.call(this),function(){var GiftCardPaymentGroupViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};GiftCardPaymentGroupViewModel=function(_super){function GiftCardPaymentGroupViewModel(){this.getGiftCardsJSON=__bind(this.getGiftCardsJSON,this),this.updateGiftPaymentsTotal=__bind(this.updateGiftPaymentsTotal,this),this.remove=__bind(this.remove,this),this.update=__bind(this.update,this),this.login=__bind(this.login,this),this.getPayments=__bind(this.getPayments,this),this.submitGiftCards=__bind(this.submitGiftCards,this),this.addGiftCard=__bind(this.addGiftCard,this),this.cleanValidation=__bind(this.cleanValidation,this),this.validateGiftCardCode=__bind(this.validateGiftCardCode,this);var _this=this;GiftCardPaymentGroupViewModel.__super__.constructor.apply(this,arguments),this.showAsTab(!1),this.template("giftCardPaymentGroup-template"),this.availableGiftCards=ko.observableArray(),this.giftCardCode=ko.observable(),this.loadingGiftCard=ko.observable(!1),this.giftCards=ko.computed(function(){return _.filter(_this.availableGiftCards(),function(gc){return!gc.isSpecialCard()})}),this.specialGiftCards=ko.computed(function(){return _.filter(_this.availableGiftCards(),function(gc){return gc.isSpecialCard()})}),this.specialGiftCardsProviderGroups=ko.computed(function(){var fallbackProvider,groups,groupsArray,provider,providerObj,specialGiftCardsGroup,value;groups=_.groupBy(_this.specialGiftCards(),function(gc){return gc.provider()}),groupsArray=[];for(provider in groups)value=groups[provider],fallbackProvider={id:provider},providerObj=_.find(_this.giftCardProviders(),function(p){return p.id===provider})||fallbackProvider,specialGiftCardsGroup=new vtex.checkout.SpecialGiftCardProviderGroupViewModel(self,providerObj,value),groupsArray.push(specialGiftCardsGroup);return groupsArray}),this.showSpecialGiftCards=ko.computed(function(){return _.some(_this.specialGiftCards(),function(gc){return 0!==gc.balance()})}),this.usedGiftCards=ko.computed(function(){return _.filter(_this.availableGiftCards(),function(gc){return gc.inUse()})}),this.selectedProvider=ko.observable(),this.giftCardProviders=ko.computed(function(){var providers;return providers=window.checkoutConfig.giftCardsProviders(),_this.selectedProvider(providers[0]),providers}),this.shouldLogin=ko.computed(function(){var hasGiftCardWithBalanceZero;return hasGiftCardWithBalanceZero=_.find(_this.availableGiftCards(),function(gc){return 0===gc.balance()})})}return __extends(GiftCardPaymentGroupViewModel,_super),GiftCardPaymentGroupViewModel.prototype.giftCardOptionsText=function(gc){return null!=gc.caption?gc.caption:gc.id},GiftCardPaymentGroupViewModel.prototype.validateGiftCardCode=function(value,element){var totalPaidByGift,totalToPay,usedGC,validation,_this=this;return validation={result:!0,message:""},void 0===value||""===value?(validation.applyErrorClass=validation.showErrorMessage=!validation.result,validation.applySuccessClass=!validation.result,validation):(usedGC=_(this.availableGiftCards()).find(function(gc){return gc.redemptionCode()===_this.giftCardCode()}),usedGC&&(validation.result=!1,validation.message=i18n.t("paymentData.paymentGroup.giftCard.alreadyUsed")),totalPaidByGift=window.paymentData.giftPaymentsTotal(),totalToPay=window.paymentData.totalToPay(),totalPaidByGift>totalToPay&&(validation.result=!1,validation.message=i18n.t("paymentData.paymentGroup.giftCard.totalAlreadyPaid")),validation.applySuccessClass=validation.result,validation.applyErrorClass=validation.showErrorMessage=!validation.result,validation)},GiftCardPaymentGroupViewModel.prototype.cleanValidation=function(){return this.giftCardCode.validate?this.giftCardCode.validate({silent:!0}):void 0},GiftCardPaymentGroupViewModel.prototype.addGiftCard=function(){var gcArray,_this=this;if(this.giftCardCode()&&(this.giftCardCode(this.giftCardCode().replace(/\s/g,"")),this.giftCardCode.validate().result!==!1&&!_.find(this.availableGiftCards(),function(ugc){return ugc.redemptionCode()===_this.giftCardCode()})))return gcArray=this.availableGiftCards().concat([new vtex.checkout.GiftCardViewModel({redemptionCode:this.giftCardCode(),provider:this.selectedProvider().id,inUse:!0})]),this.submitGiftCards(gcArray)},GiftCardPaymentGroupViewModel.prototype.submitGiftCards=function(giftCardArray){return null==giftCardArray&&(giftCardArray=this.availableGiftCards()),this.loadingGiftCard(!0),radio("checkout.paymentData.giftcard.submit").broadcast(giftCardArray)},GiftCardPaymentGroupViewModel.prototype.getPayments=function(){var ps;return ps=this.paymentSystem(),_.map(this.usedGiftCards(),function(gc){return new vtex.checkout.Payment({paymentSystem:ps.id(),paymentSystemName:ps.name(),installments:1,group:ps.groupName(),value:gc.value(),referenceValue:gc.value(),fields:{redemptionCode:gc.redemptionCode(),provider:gc.provider(),giftCardId:gc.id}})})},GiftCardPaymentGroupViewModel.prototype.updatePayments=function(){},GiftCardPaymentGroupViewModel.prototype.updateInstallments=function(){},GiftCardPaymentGroupViewModel.prototype.login=function(){return vtexid.start({returnUrl:window.location.href,userEmail:window.clientProfileData.email(),locale:checkout.locale(),forceProviders:_.map(this.giftCardProviders(),function(p){return p.oauth})})},GiftCardPaymentGroupViewModel.prototype.update=function(json){var gc,_i,_len;for(this.loadingGiftCard(!1),this.giftCardCode(""),this.availableGiftCards.removeAll(),_i=0,_len=json.length;_len>_i;_i++)gc=json[_i],this.availableGiftCards.push(new vtex.checkout.GiftCardViewModel(gc));return this.updateGiftPaymentsTotal()},GiftCardPaymentGroupViewModel.prototype.remove=function(giftCardId){var normalGiftCard,others;return others=_.filter(this.availableGiftCards(),function(gc){return gc.id!==giftCardId}),normalGiftCard=_.find(others,function(gc){return!gc.isSpecialCard()}),normalGiftCard||window.paymentData.showGiftCard(!1),this.submitGiftCards(others)},GiftCardPaymentGroupViewModel.prototype.updateGiftPaymentsTotal=function(){var value;return value=_.reduce(this.getPayments(),function(memo,payment){return memo+payment.value},0),radio("checkout.paymentData.giftPaymentsTotal").broadcast(value)},GiftCardPaymentGroupViewModel.prototype.getGiftCardsJSON=function(){return _.map(this.availableGiftCards(),function(gc){return gc.toJSON()})},GiftCardPaymentGroupViewModel}(vtex.checkout.PaymentGroupViewModel),vtex.checkout.GiftCardPaymentGroupViewModel=GiftCardPaymentGroupViewModel}.call(this),function(){var BankInvoicePaymentGroupViewModel,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};BankInvoicePaymentGroupViewModel=function(_super){function BankInvoicePaymentGroupViewModel(json,paymentSystems){var _this=this;BankInvoicePaymentGroupViewModel.__super__.constructor.apply(this,arguments),this.template("bankInvoicePaymentGroup-template"),this.selectedPaymentSystemId=ko.observable(this.paymentSystems()[0].id()),this.paymentSystem=ko.computed(function(){return _.find(_this.paymentSystems(),function(paymentSystem){return paymentSystem.id()===parseInt(_this.selectedPaymentSystemId(),10)})}),this.selectedPaymentSystemId.subscribe(function(oldValue){return null!=oldValue&&window.paymentData.selectedPaymentGroupId()===_this.id?$(window).trigger("paymentUpdated.vtex"):void 0},this,"beforeChange")}return __extends(BankInvoicePaymentGroupViewModel,_super),BankInvoicePaymentGroupViewModel}(vtex.checkout.PaymentGroupViewModel),vtex.checkout.BankInvoicePaymentGroupViewModel=BankInvoicePaymentGroupViewModel}.call(this),function(){var PaymentDataViewModel,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};PaymentDataViewModel=function(){function PaymentDataViewModel(){this.adjustPayments=__bind(this.adjustPayments,this),this.update=__bind(this.update,this),this.updatePaymentGroups=__bind(this.updatePaymentGroups,this),this.updatePaymentSystems=__bind(this.updatePaymentSystems,this),this.getPaymentGroupClass=__bind(this.getPaymentGroupClass,this),this.getAnotherPaymentGroup=__bind(this.getAnotherPaymentGroup,this),this.changePaymentGroupAvailability=__bind(this.changePaymentGroupAvailability,this),this.togglePaymentMethodsVisibility=__bind(this.togglePaymentMethodsVisibility,this),this.updateIFramePayments=__bind(this.updateIFramePayments,this),this.paymentGroupHasPaymentSystemList=__bind(this.paymentGroupHasPaymentSystemList,this),this.submitIFramePayment=__bind(this.submitIFramePayment,this),this.submit=__bind(this.submit,this),this.cancel=__bind(this.cancel,this),this.afterRender=__bind(this.afterRender,this),this.isValid=__bind(this.isValid,this),this.validate=__bind(this.validate,this),this.paymentsArrayJSON=__bind(this.paymentsArrayJSON,this),this.updateInterestTotalizer=__bind(this.updateInterestTotalizer,this),this.paymentUpdatedHandler=__bind(this.paymentUpdatedHandler,this),this.sendAttachment=__bind(this.sendAttachment,this),this.submitGiftCard=__bind(this.submitGiftCard,this),this.getAllPaymentsAndGiftsForRnB=__bind(this.getAllPaymentsAndGiftsForRnB,this),this.getAllPayments=__bind(this.getAllPayments,this),this.clearValidationError=__bind(this.clearValidationError,this),this.isPaymentGroupAvailable=__bind(this.isPaymentGroupAvailable,this),this.setPaymentGroup=__bind(this.setPaymentGroup,this),this.selectPaymentGroup=__bind(this.selectPaymentGroup,this),this.isGiftCardPaymentGroup=__bind(this.isGiftCardPaymentGroup,this),this.isSelectedPaymentGroupEqualTo=__bind(this.isSelectedPaymentGroupEqualTo,this),this.enable=__bind(this.enable,this),this.showAuthentication=__bind(this.showAuthentication,this);var _this=this;this.stepId=this.attachmentId="paymentData",_.extend(vtex.checkout.PaymentDataViewModel.prototype,vtex.checkout.ObservableStep(this)),_.extend(vtex.checkout.PaymentDataViewModel.prototype,vtex.checkout.Attachment(this.stepId)),this.validationError=ko.observable(!1),this.showGiftCard=ko.observable(!1),this.hasGiftCard=ko.observable(!1),this.selectedPaymentGroupId=ko.observable(),this.giftPaymentsTotal=ko.observable(0),this.paymentSystems=ko.observableArray([]),this.giftCardMessages=ko.observableArray([]),this.isPaymentMethodsVisible=ko.observable(!1),this.isAdjustingPayments=ko.observable(!1),this.gatewayCallbackURL=ko.observable(API._getGatewayCallbackURL()),this.active=ko.observable(!1),this.enabled=ko.observable(!1),this.renderLoaded=ko.observable(!1),this.isEditingSensitiveField=ko.computed({read:function(){var _ref;return null!=(_ref=_this.selectedPaymentGroup())&&"function"==typeof _ref.isEditingSensitiveField?_ref.isEditingSensitiveField():void 0},deferEvaluation:!0}),this.paymentGroups={},this.paymentGroupsChanged=ko.observable(),this.paymentGroupArray=ko.computed(function(){return _this.paymentGroupsChanged(),_(_this.paymentGroups).values()}),this.selectedPaymentGroup=ko.computed(function(){var selected,_ref;return selected=null!=(_ref=_this.selectedPaymentGroupId())?_ref.toString():void 0,_.find(_this.paymentGroups,function(pg){return pg.id.toString()===selected})}),this.totalToPay=ko.computed(function(){return window.summary.total()}),this.totalToPayIncludingGifts=ko.computed(function(){return _this.totalToPay()-_this.giftPaymentsTotal()}),this.totalToPayIncludingGiftsLabel=ko.computed(function(){return _.intAsCurrency(_this.totalToPayIncludingGifts())}),this.countryClass=ko.computed(function(){return"payment-country-"+checkout.countryCode()}),this.totalToPayIncludingGifts.subscribe(function(newValue,oldValue){var _ref;if(newValue!==oldValue)return 0===newValue?_this.selectedPaymentGroupId(null):null!=(_ref=_this.selectedPaymentGroup())?_ref.paidValue(newValue):void 0}),this.totalIsFree=ko.computed(function(){return 0===_this.totalToPay()&&window.cart.unavailableItems().length!==window.cart.items().length}),this.totalIsPaidByGiftCards=ko.computed(function(){return _this.totalToPay()>0&&_this.totalToPay()<=_this.giftPaymentsTotal()}),this.showPaymentOptions=ko.computed(function(){return _this.active()&&!_this.totalIsFree()&&!_this.totalIsPaidByGiftCards()}),this.isArgentina=ko.computed(function(){return"ARG"===checkout.countryCode()}),this.ahora12Classes=ko.computed(function(){var date,weekday;return date=new Date,weekday=date.toLocaleDateString("es",{weekday:"long"}),"ahora12 ahora12-"+weekday}),radio("https://io.vtex.com.br/checkout-ui/5.16.7/script/checkout.paymentData.submit.fail").subscribe(function(reason){var selectedPaymentGroup;return _this.loading(!1),selectedPaymentGroup=_this.selectedPaymentGroup(),(null!=selectedPaymentGroup?selectedPaymentGroup.onOrderFail:void 0)?selectedPaymentGroup.onOrderFail(reason):void 0}),radio("checkout.paymentData.submit.success").subscribe(function(){var selectedPaymentGroup;return selectedPaymentGroup=_this.selectedPaymentGroup(),(null!=selectedPaymentGroup?selectedPaymentGroup.onOrderSuccess:void 0)?selectedPaymentGroup.onOrderSuccess():void 0}),radio("checkout.paymentData.giftcard.submit").subscribe(this.submitGiftCard),radio("checkout.paymentData.giftPaymentsTotal").subscribe(this.giftPaymentsTotal),radio("checkout.paymentData.loading").subscribe(this.loading),radio("checkout.paymentData.submitIFramePayment").subscribe(this.submitIFramePayment),radio("checkout.paymentData.updateIFramePayments").subscribe(this.updateIFramePayments),radio("checkout.paymentData.paymentGroup.availability").subscribe(this.changePaymentGroupAvailability),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/renderLoaderReady.vtex",function(){return _this.update(vtexjs.checkout.orderForm),_this.renderLoaded(!0),_this.active(_this.enabled()),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/orderFormUpdated.vtex",function(e,orderForm){return orderForm.paymentData?_this.update(orderForm):void 0})}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/paymentUpdated.vtex",_.debounce(this.paymentUpdatedHandler,100)),this.loading.subscribe(function(value){return radio("checkout.disableInputs").broadcast(value)}),this.debouncedLoading=_.debounce(this.loading,300)}return PaymentDataViewModel.prototype.showAuthentication=function(){var requiresAuthentication,selectedPaymentGroup,_ref;return selectedPaymentGroup=this.selectedPaymentGroup(),requiresAuthentication=null!=selectedPaymentGroup&&null!=(_ref=selectedPaymentGroup.paymentSystem())?_ref.requiresAuthentication():void 0,this.active()&&requiresAuthentication&&!checkout.loggedIn()&&"callCenterOperator"!==checkout.userType()?(vtexid.start({returnUrl:window.location.href,userEmail:window.clientProfileData.email(),locale:checkout.locale(),title:i18n.t("paymentData.requiresAuthentication")}),$(window).one("authenticatedUser.vtexid",function(){var xhr;return checkout.loading(!0),xhr=checkout.update(),xhr.always(function(){return checkout.loading(!1)})}),!0):void 0},PaymentDataViewModel.prototype.enable=function(){return this.visited(!0),this.active(this.renderLoaded()),this.enabled(!0),this.isValid({giveFocus:!0,showErrorMessage:!1,applyErrorClass:!1}),0===vtexjs.checkout.orderForm.paymentData.payments.length&&this.adjustPayments(vtexjs.checkout.orderForm.paymentData,vtexjs.checkout.orderForm.items),this.showAuthentication(),window.Mobile&&Mobile.SwipeCardReaderIsConnected(),radio("checkout.fixCart").broadcast()},PaymentDataViewModel.prototype.isSelectedPaymentGroupEqualTo=function(paymentGroup){var isEqual,selectedPaymentGroupId;return selectedPaymentGroupId=this.selectedPaymentGroupId(),isEqual=selectedPaymentGroupId===paymentGroup.id},PaymentDataViewModel.prototype.isGiftCardPaymentGroup=function(paymentGroup){return"giftCardPaymentGroup"===ko.utils.safeUnwrapObservable(paymentGroup.groupName)},PaymentDataViewModel.prototype.selectPaymentGroup=function(paymentGroup){var hasPreviousSelectedPayment;return hasPreviousSelectedPayment=null!=this.selectedPaymentGroupId(),this.isSelectedPaymentGroupEqualTo(paymentGroup)||this.isGiftCardPaymentGroup(paymentGroup)?void 0:(this.setPaymentGroup(paymentGroup),this.showAuthentication(),hasPreviousSelectedPayment&&!paymentGroup.isIFrame?this.sendAttachment():void 0)},PaymentDataViewModel.prototype.setPaymentGroup=function(paymentGroup){var previousSelectedPaymentGroup,total;return this.isPaymentGroupAvailable(paymentGroup.id)===!1?(paymentGroup=this.getAnotherPaymentGroup(paymentGroup.id),void this.selectPaymentGroup(paymentGroup)):(previousSelectedPaymentGroup=this.selectedPaymentGroup(),(null!=previousSelectedPaymentGroup?previousSelectedPaymentGroup.onChangeActive:void 0)&&previousSelectedPaymentGroup.onChangeActive(!1),this.selectedPaymentGroupId(paymentGroup.id),total=this.totalToPayIncludingGifts.peek(),paymentGroup.paidValue(total),paymentGroup.onChangeActive?paymentGroup.onChangeActive(!0):void 0)},PaymentDataViewModel.prototype.isPaymentGroupAvailable=function(paymentGroupId){var pg;return pg=_.find(this.paymentGroupArray(),function(pg){return pg.id===paymentGroupId}),pg.available?pg.available():!0},PaymentDataViewModel.prototype.clearValidationError=function(){return this.validationError(!1)},PaymentDataViewModel.prototype.getAllPayments=function(masked,includeGiftPayment){var giftPayments,payments,pg,pgPayments;return null==includeGiftPayment&&(includeGiftPayment=!0),payments=[],pg=ko.utils.safeUnwrapObservable(this.selectedPaymentGroup),pgPayments=(null!=pg?pg.getPayments(masked):void 0)||[],giftPayments=includeGiftPayment&&this.paymentGroups.giftCardPaymentGroup?this.paymentGroups.giftCardPaymentGroup.getPayments():[],
this.totalIsPaidByGiftCards()?payments=giftPayments:(payments=payments.concat(pgPayments?pgPayments:[]),payments=payments.concat(giftPayments?giftPayments:[])),ko.utils.safeUnwrapObservable(this.totalIsFree)?[]:payments},PaymentDataViewModel.prototype.getAllPaymentsAndGiftsForRnB=function(masked,includeGiftPayment){var giftCards,payments,pg,pgPayments;return pg=ko.utils.safeUnwrapObservable(this.selectedPaymentGroup),pgPayments=(null!=pg?pg.getPayments(!0):void 0)||[],payments=ko.utils.safeUnwrapObservable(this.totalIsFree)||ko.utils.safeUnwrapObservable(this.totalIsPaidByGiftCards)?[]:pgPayments,giftCards=includeGiftPayment&&this.paymentGroups.giftCardPaymentGroup?this.paymentGroups.giftCardPaymentGroup.getGiftCardsJSON():[],{payments:payments,giftCards:giftCards}},PaymentDataViewModel.prototype.submitGiftCard=function(giftCardsArray){var attachment,attachmentId;return attachmentId=window.paymentData.attachmentId,attachment=this.getAllPaymentsAndGiftsForRnB(!0,0===giftCardsArray.length?!0:!1),attachment||(attachment={}),attachment.giftCards=_.map(giftCardsArray,function(gc){return gc.toJSON()}),radio("checkout.giftcard.submit").broadcast(attachmentId,attachment)},PaymentDataViewModel.prototype.sendAttachment=function(){var attachment,attachmentId;return attachmentId="paymentData",attachment=this.getAllPaymentsAndGiftsForRnB(!0,!0),API.sendAttachment(attachmentId,attachment)},PaymentDataViewModel.prototype.paymentUpdatedHandler=function(){return this.active()&&!this.isAdjustingPayments()&&0!==window.cart.items.peek().length&&window.cart.unavailableItems.peek().length!==window.cart.items.peek().length?this.sendAttachment():void 0},PaymentDataViewModel.prototype.updateInterestTotalizer=function(){var interest,payment,payments,pg,_i,_len;if(pg=ko.utils.safeUnwrapObservable(this.selectedPaymentGroup),void 0===pg||null===pg)return void 0;for(payments=pg.getPayments(!0),interest=0,_i=0,_len=payments.length;_len>_i;_i++)payment=payments[_i],payment.value&&payment.referenceValue&&(interest+=payment.value-payment.referenceValue);return radio("checkout.totalizers.interest").broadcast(interest)},PaymentDataViewModel.prototype.paymentsArrayJSON=function(){return JSON.stringify(this.getAllPayments())},PaymentDataViewModel.prototype.validate=function(options){return this.selectedPaymentGroup()?this.selectedPaymentGroup().validate(options):[{result:!0}]},PaymentDataViewModel.prototype.isValid=function(options){var validationResults;return validationResults=this.validate(options||{giveFocus:!0}),validationResults.length>0&&_.all(validationResults,function(val){return val.result===!0})},PaymentDataViewModel.prototype.afterRender=function(){return vtex.i18n.translateHtml("#payment-data")},PaymentDataViewModel.prototype.cancel=function(){return window.location.href="https://io.vtex.com.br/account/orders"},PaymentDataViewModel.prototype.submit=function(){var giftCardIsEnough,payments,referenceValue,selectedPaymentGroup,value,waitForSubmit,_this=this;if(giftCardIsEnough=!this.totalIsFree()&&this.paymentGroups.giftCardPaymentGroup&&this.totalIsPaidByGiftCards())this.paymentGroups.giftCardPaymentGroup.cleanValidation();else if(!this.totalIsFree()&&!this.isValid())return void this.validationError(!0);if(this.validationError(!1),selectedPaymentGroup=this.selectedPaymentGroup(),this.active()){if(this.showAuthentication())return;payments=this.getAllPayments(),value=_.reduce(payments,function(memo,p){return memo+p.value},0),referenceValue=this.totalToPay(),(null!=selectedPaymentGroup?selectedPaymentGroup.hasPreSubmitHook:void 0)?(this.debouncedLoading(!0),waitForSubmit=$.Deferred(),selectedPaymentGroup.preSubmitHook(waitForSubmit),waitForSubmit.done(function(){return _this.debouncedLoading(!1)}),waitForSubmit.fail(function(err){_this.debouncedLoading(!1),"abort"===(null!=err?err.reason:void 0)})):(this.loading(!0),radio("checkout.paymentData.submit").broadcast(value,referenceValue,payments))}return!1},PaymentDataViewModel.prototype.submitIFramePayment=function(paymentGroup,pgPayments,sensitiveData){var giftPayments,payments,referenceValue,value;return null==sensitiveData&&(sensitiveData=!0),this.showAuthentication()?void 0:(payments=[],giftPayments=this.paymentGroups.giftCardPaymentGroup?this.paymentGroups.giftCardPaymentGroup.getPayments():[],this.totalIsPaidByGiftCards()?payments=giftPayments:(payments=payments.concat(pgPayments?pgPayments:[]),payments=payments.concat(giftPayments?giftPayments:[])),ko.utils.safeUnwrapObservable(this.totalIsFree)&&(payments=[]),value=_.reduce(payments,function(memo,p){return memo+p.value},0),referenceValue=this.totalToPay(),sensitiveData?radio("checkout.paymentData.submit").broadcast(value,referenceValue,payments,paymentGroup):radio("checkout.paymentData.submit").broadcast(value,referenceValue,payments))},PaymentDataViewModel.prototype.paymentGroupHasPaymentSystem=function(paymentGroup,paymentSystemId){return _.find(paymentGroup.paymentSystems(),function(ps){return ps.id()===paymentSystemId})},PaymentDataViewModel.prototype.paymentGroupHasPaymentSystemList=function(paymentGroup,paymentSystems){var _this=this;return paymentGroup&&_.every(paymentSystems,function(ps){return _this.paymentGroupHasPaymentSystem(paymentGroup,ps)})},PaymentDataViewModel.prototype.updateIFramePayments=function(payments){var giftCards,paymentSystems;return paymentSystems=_.map(payments,function(p){return parseInt(p.paymentSystem)}),this.paymentGroupHasPaymentSystemList(this.selectedPaymentGroup(),paymentSystems)?((ko.utils.safeUnwrapObservable(this.totalIsFree)||ko.utils.safeUnwrapObservable(this.totalIsPaidByGiftCards))&&(payments=[]),giftCards=[],this.paymentGroups.giftCardPaymentGroup&&(giftCards=this.paymentGroups.giftCardPaymentGroup.getGiftCardsJSON()),API.sendAttachment("paymentData",{payments:payments,giftCards:giftCards})):void 0},PaymentDataViewModel.prototype.togglePaymentMethodsVisibility=function(){return this.isPaymentMethodsVisible(!this.isPaymentMethodsVisible())},PaymentDataViewModel.prototype.changePaymentGroupAvailability=function(groupId,available){var fallbackPaymentGroup,selectedPaymentGroupId;return selectedPaymentGroupId=this.selectedPaymentGroupId(),groupId===selectedPaymentGroupId&&available===!1?(fallbackPaymentGroup=this.getAnotherPaymentGroup(selectedPaymentGroupId),this.selectPaymentGroup(fallbackPaymentGroup)):void 0},PaymentDataViewModel.prototype.getAnotherPaymentGroup=function(paymentGroupId){return _.find(this.paymentGroupArray(),function(pg){return pg.id!==paymentGroupId})},PaymentDataViewModel.prototype.getPaymentGroupClass=function(groupName){switch(groupName){case"creditCardPaymentGroup":case"debitCardPaymentGroup":case"PayPalPlusPaymentGroup":case"OneBuyPaymentGroup":return vtex.checkout.IFramePaymentGroupViewModel;case"giftCardPaymentGroup":return vtex.checkout.GiftCardPaymentGroupViewModel;case"debitPaymentGroup":case"PaymentHubPaymentGroup":case"PagosNetPaymentGroup":return vtex.checkout.MultiplePaymentOptionsViewModel;case"bankInvoicePaymentGroup":return vtex.checkout.BankInvoicePaymentGroupViewModel;case"PagosWebPaymentGroup":return vtex.checkout.PagosWebPaymentGroupViewModel;default:return this.hasExtensionToHandle(groupName)?vtex.checkout.ExtensionPaymentGroupViewModel:-1!==groupName.indexOf("customPrivate")?vtex.checkout.IFramePaymentGroupViewModel:vtex.checkout.PaymentGroupViewModel}},PaymentDataViewModel.prototype.hasExtensionToHandle=function(groupName){var extensionPath,_ref;return extensionPath="checkout/payments/"+groupName,null!=(null!=(_ref=vtex.renderRuntime)?_ref.extensions[extensionPath]:void 0)},PaymentDataViewModel.prototype.updatePaymentSystems=function(paymentData){var i,installmentsOptionsForPaymentSystem,newPaymentSystems,ps,psJson,_i,_len,_ref;for(newPaymentSystems=[],_ref=paymentData.paymentSystems,i=_i=0,_len=_ref.length;_len>_i;i=++_i)psJson=_ref[i],ps=_(this.paymentSystems()).find(function(eps){return eps.id()===parseInt(psJson.id)}),ps?(ps.update(psJson),newPaymentSystems.push(ps)):(ps=new vtex.checkout.PaymentSystem(psJson),newPaymentSystems.push(ps)),installmentsOptionsForPaymentSystem=_.filter(paymentData.installmentOptions,function(io){return ps.id()===parseInt(io.paymentSystem)}),ps.updateInstallmentsMap(installmentsOptionsForPaymentSystem);return this.paymentSystems(newPaymentSystems)},PaymentDataViewModel.prototype.updatePaymentGroups=function(paymentData){var GIFT_CARD_ID,PaymentGroupViewModelName,availableAccountsForPaymentGroup,groupName,i,isSelected,newPaymentGroups,paymentGroup,paymentSystemIdArray,paymentSystemsAvailable,paymentSystemsForGroup,paymentsForPaymentSystems,pg,ps,psJson,selectedPaymentSystem,_i,_j,_len,_len1,_ref,_ref1,_ref2,_ref3,_ref4;for(newPaymentGroups={},_ref=paymentData.paymentSystems,i=_i=0,_len=_ref.length;_len>_i;i=++_i){for(psJson=_ref[i],groupName=psJson.groupName,PaymentGroupViewModelName=this.getPaymentGroupClass(groupName),paymentSystemsForGroup=_.filter(this.paymentSystems(),function(ps){return ps.groupName()===groupName}),_j=0,_len1=paymentSystemsForGroup.length;_len1>_j;_j++)ps=paymentSystemsForGroup[_j],isSelected=_.any(paymentData.payments,function(payment){return parseInt(payment.paymentSystem)===ps.id()}),ps.selected(isSelected);if(this.paymentGroups[groupName])this.paymentGroups[groupName].paymentSystems(paymentSystemsForGroup),newPaymentGroups[groupName]=this.paymentGroups[groupName];else{if(newPaymentGroups[groupName])continue;newPaymentGroups[groupName]=new PaymentGroupViewModelName(psJson,paymentSystemsForGroup)}}radio("paymentData.isVisible").broadcast(!0),this.paymentGroups=newPaymentGroups,GIFT_CARD_ID=16,this.hasGiftCard(_.some(paymentData.paymentSystems,function(p){return p.id===GIFT_CARD_ID})),this.paymentGroups.giftCardPaymentGroup&&(this.paymentGroups.giftCardPaymentGroup.update(paymentData.giftCards||[]),this.showGiftCard((null!=(_ref1=this.paymentGroups.giftCardPaymentGroup)?_ref1.giftCards().length:void 0)>0)),_ref2=this.paymentGroups;for(groupName in _ref2)pg=_ref2[groupName],paymentSystemIdArray=_.map(pg.paymentSystems(),function(ps){return ps.id()}),availableAccountsForPaymentGroup=_.filter(paymentData.availableAccounts,function(a){var _ref3;return _ref3=parseInt(a.paymentSystem),__indexOf.call(paymentSystemIdArray,_ref3)>=0}),"function"==typeof pg.availableAccounts&&pg.availableAccounts(null!=availableAccountsForPaymentGroup?availableAccountsForPaymentGroup:[]),paymentsForPaymentSystems=_.filter(paymentData.payments,function(p){var _ref3;return _ref3=parseInt(p.paymentSystem),__indexOf.call(paymentSystemIdArray,_ref3)>=0}),pg.updatePayments(paymentsForPaymentSystems);if(this.paymentGroupsChanged.notifySubscribers(),paymentSystemsAvailable=paymentData.paymentSystems.length>0,paymentSystemsAvailable&&(selectedPaymentSystem=null!=(_ref3=paymentData.payments)&&null!=(_ref4=_ref3[0])?_ref4.paymentSystem:void 0,null==selectedPaymentSystem&&null==this.selectedPaymentGroupId()&&this.totalToPayIncludingGifts()>0&&(selectedPaymentSystem=paymentData.paymentSystems[0].id),selectedPaymentSystem)){if(ps=_.find(this.paymentSystems(),function(p){return p.id()===parseInt(selectedPaymentSystem)}),paymentGroup=this.paymentGroups[ps.groupName()],this.isSelectedPaymentGroupEqualTo(paymentGroup)||this.isGiftCardPaymentGroup(paymentGroup))return;return this.setPaymentGroup(paymentGroup),this.showAuthentication()}},PaymentDataViewModel.prototype.update=function(orderForm){var paymentData,validationResults,_ref,_ref1,_ref2,_ref3;if(orderForm){if(paymentData=null!=(_ref=orderForm.paymentData)?_ref:{},this.selectedAddressId=null!=(_ref1=orderForm.shippingData)&&null!=(_ref2=_ref1.address)?_ref2.addressId:void 0,!paymentData.paymentSystems)throw new Error("JSON enviado para PaymentData no contm paymentSystems");if(this.updatePaymentSystems(paymentData),this.adjustPayments(paymentData,orderForm.items))return;return this.updatePaymentGroups(paymentData),(null!=(_ref3=paymentData.payments)?_ref3.length:void 0)>0&&this.updateInterestTotalizer(),null!=paymentData.giftCardMessages&&this.giftCardMessages(paymentData.giftCardMessages),validationResults=this.validate({dontChangeDOM:!0}),$("#payment-data").trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/componentValidated.vtex",[validationResults])}},PaymentDataViewModel.prototype.adjustPayments=function(paymentData,items){var adjustmentsMade,adjustmentsMadeOnAvailableAccount,firstNonGiftPaymentSystem,groupName,installments,isCard,maxInstallment,noItemsAvailable,payment,paymentAttachment,paymentSystem,payments,totalPayedByGifts,totalToPay,_i,_len,_this=this;if(adjustmentsMade=!1,payments=paymentData.payments,totalToPay=this.totalToPay.peek(),noItemsAvailable=_.all(items,function(item){var _ref;return!("available"===(_ref=item.availability)||null===_ref||void 0===_ref)}))0!==payments.length&&(payments=[],adjustmentsMade=!0);else if(totalPayedByGifts=paymentData.giftCards&&paymentData.giftCards.length>0?_.reduce(paymentData.giftCards,function(total,gc){return gc.inUse?total+gc.value:total},0):0,1===payments.length&&payments[0].referenceValue+totalPayedByGifts!==totalToPay&&(payments[0].referenceValue=totalToPay,adjustmentsMade=!0),this.active()===!0)for(0===payments.length&&totalPayedByGifts!==totalToPay&&(firstNonGiftPaymentSystem=_.find(this.paymentSystems(),function(ps){return"giftCardPaymentGroup"!==ps.groupName()}),firstNonGiftPaymentSystem&&(payments.push({paymentSystem:parseInt(firstNonGiftPaymentSystem.id()),referenceValue:totalToPay-totalPayedByGifts}),adjustmentsMade=!0)),_i=0,_len=payments.length;_len>_i;_i++)if(payment=payments[_i],!payment.installments){if(paymentSystem=_.find(this.paymentSystems(),function(ps){return parseInt(ps.id())===parseInt(payment.paymentSystem)}),groupName=paymentSystem.groupName(),installments=paymentSystem.getInstallmentsForValue(payment.bin,payment.referenceValue),isCard="creditCardPaymentGroup"===groupName||"debitCardPaymentGroup"===groupName||-1!==groupName.indexOf("customPrivate")){if(null==installments)break;if(1!==installments.length)continue;payment.installments=installments[0].number()}else if("MercadoPagoPaymentGroup"===groupName)maxInstallment=_.max(installments,function(i){return i.number()}),payment.installments=null!=maxInstallment&&"function"==typeof maxInstallment.number?maxInstallment.number():void 0;else if(installments&&installments.length>0)payment.installments=installments[0].number();else{if(installments&&0===installments.length)continue;payment.installments=1}adjustmentsMade=!0,payment.accountId&&(adjustmentsMadeOnAvailableAccount=!0)}return adjustmentsMade&&(paymentAttachment={payments:payments,giftCards:paymentData.giftCards},null!=adjustmentsMadeOnAvailableAccount&&this.loading(!0),this.isAdjustingPayments(!0),API.sendAttachment("paymentData",paymentAttachment).always(function(){return _this.isAdjustingPayments(!1),null!=adjustmentsMadeOnAvailableAccount?_this.loading(!1):void 0})),adjustmentsMade},PaymentDataViewModel}(),vtex.checkout.PaymentDataViewModel=PaymentDataViewModel}.call(this),function(){var getEcommerceProp,getProductObjectData,getPurchaseObjectData,getTotalizerValue,_base,_base1;window.vtex||(window.vtex={}),(_base=window.vtex).checkout||(_base.checkout={}),(_base1=window.vtex.checkout).analytics||(_base1.analytics={}),getTotalizerValue=function(totalizers,totalizer){var foundTotalizer,value;return foundTotalizer=_.find(totalizers,function(t){return t.id===totalizer}),value=foundTotalizer&&null!=foundTotalizer.value?foundTotalizer.value/100:null},getProductObjectData=function(item){var _ref;return{id:item.id,name:item.name,category:_.reduce(item.productCategories,function(memo,category){return memo?memo+"/"+category:category},""),brand:null!=(_ref=item.additionalInfo)?_ref.brandName:void 0,variant:item.skuName,price:item.sellingPrice/100,quantity:item.quantity}},getPurchaseObjectData=function(order){return{id:order.orderId,affiliation:order.sellers&&order.sellers[0]?order.sellers[0].name:null,revenue:order.value/100,tax:getTotalizerValue(order.totalizers,"Tax"),shipping:getTotalizerValue(order.totalizers,"Shipping"),coupon:order.marketingData?order.marketingData.coupon:null}},getEcommerceProp=function(options,orderForm){var hash,step;switch(hash=options&&"step"===options.type?"#/"+options.hash:window.location.hash){case"#/cart":step=1;break;case"#/email":step=2;break;case"#/profile":step=3;break;case"#/shipping":step=4;break;case"#/payment":step=5;break;default:step=void 0}return{checkout:{actionField:{step:step},products:_.map(orderForm.items,function(item){return getProductObjectData(item)})}}},window.vtex.checkout.analytics.reportData=function(options){var orderForm,_ref;return orderForm=null!=(_ref=window.vtexjs.checkout.orderForm)?_ref:{},{salesChannel:function(){return orderForm.salesChannel},campaignName:function(){var _ref1;return null!=(_ref1=orderForm.marketingData)?_ref1.utmCampaign:void 0},campaignSource:function(){var _ref1;return null!=(_ref1=orderForm.marketingData)?_ref1.utmSource:void 0},campaignMedium:function(){var _ref1;return null!=(_ref1=orderForm.marketingData)?_ref1.utmMedium:void 0},internalCampaignName:function(){var _ref1;return null!=(_ref1=orderForm.marketingData)?_ref1.utmiCampaign:void 0},internalCampaignPage:function(){var _ref1;return null!=(_ref1=orderForm.marketingData)?_ref1.utmiPage:void 0},internalCampaignPart:function(){var _ref1;return null!=(_ref1=orderForm.marketingData)?_ref1.utmiPart:void 0},ecommerce:function(){return getEcommerceProp(options,orderForm)},visitorType:function(){return orderForm.loggedIn||!orderForm.canEditData&&!orderForm.loggedIn?"existing customer":orderForm.canEditData&&!orderForm.loggedIn?"new customer":void 0},visitorLoginState:function(){return orderForm.loggedIn?"authenticated customer":orderForm.canEditData||orderForm.loggedIn?void 0:"unauthenticated customer"},visitorContactInfo:function(){var _ref1,_ref2,_ref3;return[(null!=(_ref1=orderForm.clientProfileData)?_ref1.email:void 0)||window.clientProfileData.email(),null!=(_ref2=orderForm.clientProfileData)?_ref2.firstName:void 0,null!=(_ref3=orderForm.clientProfileData)?_ref3.lastName:void 0]},visitorDemographicInfo:function(){var city,complement,neighborhood,number,postalCode,state,street,_ref1,_ref10,_ref11,_ref12,_ref13,_ref14,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;return postalCode=null!=(_ref1=orderForm.shippingData)&&null!=(_ref2=_ref1.address)?_ref2.postalCode:void 0,street=null!=(_ref3=orderForm.shippingData)&&null!=(_ref4=_ref3.address)?_ref4.street:void 0,number=null!=(_ref5=orderForm.shippingData)&&null!=(_ref6=_ref5.address)?_ref6.number:void 0,neighborhood=null!=(_ref7=orderForm.shippingData)&&null!=(_ref8=_ref7.address)?_ref8.neighborhood:void 0,complement=null!=(_ref9=orderForm.shippingData)&&null!=(_ref10=_ref9.address)?_ref10.complement:void 0,city=null!=(_ref11=orderForm.shippingData)&&null!=(_ref12=_ref11.address)?_ref12.city:void 0,state=null!=(_ref13=orderForm.shippingData)&&null!=(_ref14=_ref13.address)?_ref14.state:void 0,[postalCode,street+", "+number+" - "+neighborhood+" - "+complement+" - "+city+" - "+state]},orderFormTax:function(){return getTotalizerValue(orderForm.totalizers,"Tax")},orderFormShipping:function(){return getTotalizerValue(orderForm.totalizers,"Shipping")},orderFormShippingMethod:function(){var _ref1;return _.uniq(_.map(null!=(_ref1=orderForm.shippingData)?_ref1.logisticsInfo:void 0,function(li){return li.selectedSla}))},orderFormPromoCode:function(){var _ref1;return null!=(_ref1=orderForm.marketingData)?_ref1.coupon:void 0},orderFormPaymentType:function(){var payment,paymentSystem,_ref1,_ref2;return payment=null!=(_ref1=orderForm.paymentData)?_ref1.payments[0]:void 0,paymentSystem=_.find(null!=(_ref2=orderForm.paymentData)?_ref2.paymentSystems:void 0,function(ps){return ps.id+""===(null!=payment?payment.paymentSystem:void 0)}),null!=paymentSystem?paymentSystem.name:void 0},orderFormTotal:function(){return orderForm.value},orderFormProducts:function(){var c,category,categoryId,categoryIdTree,categoryIds,categoryTree,item,seller,sellerName,_i,_j,_k,_len,_len1,_len2,_ref1,_ref2,_ref3,_ref4,_results;if(!orderForm.items)return[];for(_ref1=orderForm.items,_results=[],_i=0,_len=_ref1.length;_len>_i;_i++){for(item=_ref1[_i],categoryIds=item.productCategoryIds.split("/"),categoryIds=_.reject(categoryIds,function(c){return 0===c.length}),categoryId=categoryIds[categoryIds.length-1],category=item.productCategories[categoryId],categoryTree=[],categoryIdTree=[],_j=0,_len1=categoryIds.length;_len1>_j;_j++)c=categoryIds[_j],categoryIdTree.push(c),categoryTree.push(item.productCategories[c]);for(sellerName="",_ref2=orderForm.sellers,_k=0,_len2=_ref2.length;_len2>_k;_k++)seller=_ref2[_k],item.seller===seller.id&&(sellerName=seller.name);_results.push({id:item.productId,name:item.name,sku:item.id,skuRefId:item.skuRefId,skuName:item.skuName,seller:sellerName,sellerId:item.seller,brand:null!=(_ref3=item.additionalInfo)?_ref3.brandName:void 0,brandId:null!=(_ref4=item.additionalInfo)?_ref4.brandId:void 0,isGift:item.isGift,category:category,categoryId:categoryId,categoryTree:categoryTree,categoryIdTree:categoryIdTree,originalPrice:item.price/100,price:item.sellingPrice/100,sellingPrice:item.sellingPrice/100,tax:item.tax/100,quantity:item.quantity,components:item.components,measurementUnit:item.measurementUnit,unitMultiplier:item.unitMultiplier})}return _results}}},window.vtex.checkout.analytics.addToCart=function(items,currencyCode){return window.vtex.events.sendEvent("addToCart",{ecommerce:{currencyCode:currencyCode,add:{products:_.map(items,function(item){return getProductObjectData(item)})}}})},window.vtex.checkout.analytics.removeFromCart=function(items){return window.vtex.events.sendEvent("removeFromCart",{ecommerce:{remove:{products:_.map(items,function(item){return getProductObjectData(item)})}}})},window.vtex.checkout.analytics.checkout=function(step,option,cart){return window.vtex.events.sendEvent("checkout",{ecommerce:{checkout:{actionField:{step:step,option:option},products:_.map(cart,function(item){return getProductObjectData(item)})}}})},window.vtex.checkout.analytics.checkoutOption=function(step,option){return window.vtex.events.sendEvent("checkoutOption",{ecommerce:{checkout_option:{actionField:{step:step,option:option}}}})},window.vtex.checkout.analytics.purchaseOrder=function(order){return sendEvent("pageLoaded",{ecommerce:{purchase:{actionField:getPurchaseObjectData(order),products:_.map(order.items,function(item){return getProductObjectData(item)})}}})},window.vtex.checkout.analytics.purchase=function(orders){return _.map(orders,function(order){return purchaseOrder(order)})},window.vtex.checkout.analytics.addOrderFormEvents=function(){var _ref,_ref1,_ref2;return null!=(_ref=window.vtex.events)&&"function"==typeof _ref.addEvent&&_ref.addEvent("cartLoaded","cartLoaded",window.vtex.checkout.analytics.reportData()),null!=(_ref1=window.vtex.events)&&"function"==typeof _ref1.addEvent&&_ref1.addEvent("finishPayment","submit",window.vtex.checkout.analytics.reportData()),null!=(_ref2=window.vtex.events)&&"function"==typeof _ref2.addEvent?_ref2.addEvent("sendPayments","submit",window.vtex.checkout.analytics.reportData()):void 0},window.vtex.checkout.analytics.sendEvent=function(event,options){var result,sendReport;return result={},sendReport=function(options){var _ref;return _.each(window.vtex.checkout.analytics.reportData(options),function(value,key){return result[key]=value()}),null!=(_ref=window.vtex.events)&&"function"==typeof _ref.sendEvent?_ref.sendEvent(event,result):void 0},0===window.vtexjs.checkout._pendingRequestCounter?sendReport(options):$(window).one("https://io.vtex.com.br/checkout-ui/5.16.7/script/orderFormUpdated.vtex",sendReport)}}.call(this),function(){var Config,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Config=function(){function Config(start){null==start&&(start=!0),this.init=__bind(this.init,this),this.giftCardsProviders=ko.observableArray([{id:"VtexGiftCard",oauth:"vtex",caption:null}]),start&&this.init()}return Config.prototype.init=function(){var _this=this;return $.ajax({url:window.location.origin+"/api/checkout/pub/gift-cards/providers",type:"GET",contentType:"application/json; charset=utf-8",dataType:"json"}).success(function(data){return _this.giftCardsProviders(data)})},Config}(),window.vtex.checkout.Config=Config}.call(this),function(){$(window).on("message onmessage",function(e){var args,event,height,isActive,isDone,paymentGroup,payments,redirectUrl,title;switch(event=e.originalEvent.data.event,args=e.originalEvent.data.arguments,event){case"https://io.vtex.com.br/checkout-ui/5.16.7/script/updatePayments.vtex":return payments=args[0],radio("checkout.paymentData.updateIFramePayments").broadcast(payments);case"https://io.vtex.com.br/checkout-ui/5.16.7/script/removeCardAccount.vtex":return window.vtexjs.checkout.removeAccountId(args[0]);case"https://io.vtex.com.br/checkout-ui/5.16.7/script/setupComplete.vtex":return paymentGroup=args[0],radio("paymentData.paymentGroup.iFrame."+paymentGroup+".setupComplete").broadcast();case"https://io.vtex.com.br/checkout-ui/5.16.7/script/setIFrameHeight.vtex":return paymentGroup=args[0],height=args[1]+"px",radio("paymentData.paymentGroup.iFrame."+paymentGroup+".setIFrameHeight").broadcast(height);case"https://io.vtex.com.br/checkout-ui/5.16.7/script/submitButton.vtex":return paymentGroup=args[0],isActive=args[1],radio("paymentData.paymentGroup.iFrame."+paymentGroup+".submitButton").broadcast(isActive);case"https://io.vtex.com.br/checkout-ui/5.16.7/script/preSubmit.vtex":return paymentGroup=args[0],isDone=args[1],radio("paymentData.paymentGroup.iFrame."+paymentGroup+".preSubmit").broadcast(isDone);case"https://io.vtex.com.br/checkout-ui/5.16.7/script/startTransaction.vtex":return paymentGroup=args[0],payments=args[1],radio("paymentData.paymentGroup.iFrame."+paymentGroup+".doSubmit").broadcast(paymentGroup,payments);case"https://io.vtex.com.br/checkout-ui/5.16.7/script/paymentSuccess.vtex":return redirectUrl=args[0],window.location.replace(redirectUrl);case"https://io.vtex.com.br/checkout-ui/5.16.7/script/paymentFail.vtex":return redirectUrl=args[0],window.location.replace(redirectUrl);case"https://io.vtex.com.br/checkout-ui/5.16.7/script/requireAuthentication.vtex":return title=args[0]?args[0]:i18n.t("paymentData.requiresAuthentication"),vtexid.start({returnUrl:window.location.href,userEmail:window.clientProfileData.email(),locale:checkout.locale(),title:title}),$(window).one("authenticatedUser.vtexid",function(){var xhr;return checkout.loading(!0),xhr=checkout.update(),xhr.always(function(){return checkout.loading(!1)})})}})}.call(this),function(){var checkCartmanQuery,checkDomain,clientProfileData,dependencies,e,el,generateExtensionName,isCartmanDomain,logFirstMeaningfulPaint,orderFormPromise,paymentData,renderCartman,renderCheckoutButtons,shippingData,_i,_len,_ref,_ref1,_ref2;window.vtex.ko.validation.options.locale="pt-BR",window.vtex.ko.validation.options.fadeError=!0,window.vtex.i18n.setLocaleCallback("vtex.i18n.update"),window.vtex.i18n.setCountryCodeCallback("vtex.countryCode.update"),window.vtex.i18n.init();try{for(window.checkoutConfig=new vtex.checkout.Config,window.router=new vtex.checkout.Router,window.API=window.vtexjs.checkout,window.checkout=new vtex.checkout.CheckoutModel,window.cart=new vtex.checkout.CartViewModel(window.checkout),window.summary=new vtex.checkout.SummaryViewModel(window.checkout),window.clientProfileData=new vtex.checkout.ClientProfileDataViewModel,window.paymentData=new vtex.checkout.PaymentDataViewModel,window.checkout.loading(!0),ko.applyBindings(window.checkout,$(".pci-alert-topbar")[0]),ko.applyBindings(window.router,$("#orderform-title")[0]),ko.applyBindings(window.router,$("#orderform-sac-title")[0]),ko.applyBindings(window.router,$("#cart-title")[0]),ko.applyBindings(window.cart,$("#order-by")[0]),ko.applyBindings(window.checkout,$(".gift-list-alert.alert")[0]),ko.applyBindings(window.checkout,$(".loading.loading-bg")[0]),ko.applyBindings(window.checkout,$(".link-choose-more-products-wrapper")[0]),ko.applyBindings(window.checkout,$(".link-print-cart-wrapper")[0]),ko.applyBindings(window.checkout,$(".note.summary-note")[0]),ko.applyBindings(window.cart,$(".unavailable-modal")[0]),ko.applyBindings(window.cart,$(".cart-template-holder")[0]),ko.applyBindings(window.cart,$(".summary-cart-template-holder")[0]),ko.applyBindings(window.summary,$(".full-cart .summary-template-holder")[0]),_ref=$(".btn-place-order-wrapper"),_i=0,_len=_ref.length;_len>_i;_i++)el=_ref[_i],ko.applyBindings(window.summary,el);ko.applyBindings(window.summary,$(".mini-cart .summary-template-holder")[0]),ko.applyBindings(window.clientProfileData,$(".client-profile-data")[0]),ko.applyBindings(window.paymentData,$(".payment-submit-wrap")[0]),ko.applyBindings(window.paymentData,$(".payment-data")[0]),ko.applyBindings(window.router,$("#payment-confirmation-message-container")[0]),ko.applyBindings(window.router,$("#go-to-cart-button")[0]),window.router.state.subscribe(function(newValue){return"cart"===newValue?($("body").addClass("body-cart").removeClass("body-order-form"),$("div.container.container-main").addClass("container-cart").removeClass("container-order-form"),$("div.checkout-container.row-fluid").addClass("cart-active").removeClass("orderform-active"),$("div.cart-template.full-cart").addClass("active").removeClass("inactive"),$("div.orderform-template").removeClass("active").addClass("inactive")):($("body").removeClass("body-cart").addClass("body-order-form"),$("div.container.container-main").removeClass("container-cart").addClass("container-order-form"),$("div.checkout-container.row-fluid").removeClass("cart-active").addClass("orderform-active"),$("div.cart-template.full-cart").removeClass("active").addClass("inactive"),$("div.orderform-template").addClass("active").removeClass("inactive"))}),window.cart.hasItemsAndIsInCart.subscribe(function(newValue){return newValue?$(".cart-links.cart-links-bottom,.extensions-checkout-buttons-container").show():$(".cart-links.cart-links-bottom,.extensions-checkout-buttons-container").hide()}),window.paymentData.active.subscribe(function(newValue){return newValue?$(".payment-confirmation-wrap").show():$(".payment-confirmation-wrap").hide()})}catch(_error){e=_error,window.errorLogger&&window.errorLogger(e),window.splunkErrorLogger&&window.splunkErrorLogger(e),console.error&&console.error("Error initializing checkout:",e,e.stack)}clientProfileData=$.Deferred(),shippingData=$.Deferred(),paymentData=$.Deferred(),generateExtensionName=function(runtime,extension){return 8===runtime.renderMajor?"store.checkout/checkout-app/checkout-"+extension:"checkout/"+extension},renderCheckoutButtons=function(runtime){var BUTTONS_EXTENSION_POINT,buttonsExtensions,hasNoButtons;return BUTTONS_EXTENSION_POINT=generateExtensionName(runtime,"buttons"),buttonsExtensions=_.filter(_.keys(runtime.extensions),function(name){return 0===name.indexOf(BUTTONS_EXTENSION_POINT)}),hasNoButtons=buttonsExtensions.length<=1,hasNoButtons?void $(".extensions-checkout-buttons").hide():window.vtex.renderLoader.render(BUTTONS_EXTENSION_POINT,document.getElementById("render-checkout-buttons"))},checkDomain=function(domain){return-1!==window.location.href.search(domain)},isCartmanDomain=function(listDomains){var callcenterOperator,cartmanIsEnabled;return(callcenterOperator=window.vtexjs&&window.vtexjs.orderForm&&window.vtexjs.orderForm.userType)?!1:(cartmanIsEnabled=!1,listDomains.forEach(function(domain){return cartmanIsEnabled=cartmanIsEnabled||checkDomain(domain)}),cartmanIsEnabled)},checkCartmanQuery=function(query){return window.location&&window.location.href&&-1!==window.location.href.search(query)},renderCartman=function(runtime){var CARTMAN_EXTENSION,cartmanQuery,domains,query;return CARTMAN_EXTENSION=generateExtensionName(runtime,"cartman"),query="cartman=on",domains=["vtexlocal","myvtex","myvtexdev","vtexcommercebeta","vtexcommercestable"],cartmanQuery=checkCartmanQuery(query),cartmanQuery||isCartmanDomain(domains)?window.vtex.renderLoader.render(CARTMAN_EXTENSION,document.getElementById("render-cartman")):void 0},orderFormPromise=window.vtexjs.checkout.getOrderForm(),window.vtex.renderLoaderPromise.then(function(){return window.vtex.renderRuntime.error?(window.checkoutLogger&&window.checkoutLogger({name:window.vtex.renderRuntime.errorType,data:{}}),window.logSplunk&&window.logSplunk({level:"Critical",type:"Error",workflowType:"checkout-ui",workflowInstance:"render-error",event:{errorType:window.vtex.renderRuntime.errorType},account:window.vtex.accountName})):(renderCheckoutButtons(window.vtex.renderRuntime),
renderCartman(window.vtex.renderRuntime)),$(window).trigger("https://io.vtex.com.br/checkout-ui/5.16.7/script/renderLoaderReady.vtex")}),$("#client-profile-data").one("https://io.vtex.com.br/checkout-ui/5.16.7/script/componentValidated.vtex",clientProfileData.resolve),$("#shipping-data").one("https://io.vtex.com.br/checkout-ui/5.16.7/script/componentValidated.vtex",shippingData.resolve),dependencies=["cart/script/component/SelectGift","shipping/script/ShippingData","link!cart/style/style"],vtex.curl(vtex.curl.configuration,dependencies,function(SelectGift,ShippingData){return orderFormPromise.done(function(){return SelectGift.attachTo(".cart-select-gift-placeholder"),ShippingData.attachTo("#shipping-data",{API:API})})}),orderFormPromise.always(function(){var changingItemsOrder,shouldNotifyOrderFormLoaded,_ref1,_ref2;return changingItemsOrder=!1,shouldNotifyOrderFormLoaded=!0,(null!=(_ref1=API.orderForm)&&null!=(_ref2=_ref1.items)?_ref2.length:void 0)>20&&(window.checkout.loading(!0),changingItemsOrder=!0,API.changeItemsOrdination("add_time",!0).then(function(){return window.checkout.loading(!1),$("body").removeClass("loading")})),$(function(){var componentsValidated,componentsValidatedTimeout,componentsValidatedTimeoutHandler,defaultTitle,_ref3;return window.logSplunk&&shouldNotifyOrderFormLoaded&&(shouldNotifyOrderFormLoaded=!1,window.logSplunk({level:"Info",type:"Debug",workflowType:"checkout-ui",workflowInstance:"orderform-loaded",event:{},account:vtex.accountName})),null!=(_ref3=window.vtex.checkout.analytics)&&_ref3.sendEvent("cartLoaded"),window.vtex.i18n.translateHtml(),defaultTitle=i18n.t("title"),document.title=vtex.siteTitle?vtex.siteTitle+" - "+defaultTitle:defaultTitle,componentsValidatedTimeoutHandler=function(){return console.log("Houve um erro ao validar um dos componentes",window.router.validationResults)},componentsValidatedTimeout=setTimeout(componentsValidatedTimeoutHandler,1e4),componentsValidated=function(){return window.router.initializeRouter(),clearInterval(componentsValidatedTimeout),changingItemsOrder?void 0:(window.checkout.loading(!1),$("body").removeClass("loading"),logFirstMeaningfulPaint())},$.when(clientProfileData,shippingData).then(componentsValidated),setTimeout(function(){return vtex.checkout.cartFixed()},500)})}),logFirstMeaningfulPaint=function(){var event;return event={eventAction:"first-meaningful-paint",eventLabel:"paint",eventValue:"undefined"!=typeof performance&&null!==performance?performance.now():void 0},window.checkoutLogger&&window.checkoutLogger({name:"firstMeaningfulPaint",data:event}),window.logSplunk&&window.logSplunk({level:"Info",type:"kpi",workflowType:"checkout-ui",workflowInstance:"performance-metrics",event:event,account:vtex.accountName})},$(window).load(function(){var _ref1;return null!=(_ref1=window.vtex.checkout.analytics)?_ref1.addOrderFormEvents():void 0}),$(window).on("authenticatedUser.vtexid",function(){return window.checkout.loading(!0),window.checkout.update().always(function(){return window.checkout.loading(!1)})}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/omniShippingChanged.vtex",function(event,isOmniShippingValid){return $(".payment-data .payment-edit-link").toggle(isOmniShippingValid)}),$(window).on("https://io.vtex.com.br/checkout-ui/5.16.7/script/shippingRatePreviewLoading.vtex",function(event,isLoading){return $(".btn-place-order-wrapper .btn-success").toggleClass("disabled",isLoading)}),-1!==(null!=(_ref1=window.location)&&null!=(_ref2=_ref1.search)?_ref2.indexOf("development"):void 0)&&($("body").addClass("development"),window.development=!0)}.call(this);